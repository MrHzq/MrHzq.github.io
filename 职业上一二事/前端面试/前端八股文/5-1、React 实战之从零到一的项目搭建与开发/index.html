

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.jpg">
  <link rel="icon" href="/img/favicon.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="黄智强">
  <meta name="keywords" content="黄智强,个人博客,黄智强的博客,前端,理财,健康饮食,算命,养生,AIGC">
  
    <meta name="description" content="5-1、React 实战之从零到一的项目搭建与开发">
<meta property="og:type" content="article">
<meta property="og:title" content="5-1、React 实战之从零到一的项目搭建与开发">
<meta property="og:url" content="https://mrhzq.github.io/%E8%81%8C%E4%B8%9A%E4%B8%8A%E4%B8%80%E4%BA%8C%E4%BA%8B/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95/%E5%89%8D%E7%AB%AF%E5%85%AB%E8%82%A1%E6%96%87/5-1%E3%80%81React%20%E5%AE%9E%E6%88%98%E4%B9%8B%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="黄智强的博客">
<meta property="og:description" content="5-1、React 实战之从零到一的项目搭建与开发">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709800832052-29f9c9ae-8d1a-4e5b-b096-12a7eaeb1acb.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709801671722-35e3994b-8428-42e8-a42e-4b81f4e6c220.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709865374724-3308e724-6153-4659-9a14-4ad9a481217d.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709864722122-5ee6c7a8-c04c-4c5a-9164-26735da0450a.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709865405750-f1cd65db-f37d-43d6-b7d1-c0bb3116ad30.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709869629217-46034fbd-70fb-4a3b-bb46-578ce246b739.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709865726372-95566a99-b37e-496f-84f4-78f29a90a305.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709868478433-2a9dfe87-1aec-45bd-a796-615b05f1f964.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709869004893-0b7ba799-79d9-4c6a-a6dd-1968183a79f4.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709871900633-c34f6dcc-8fd2-42e3-a0dd-4b846888c6e1.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709872388150-06eb5392-2f85-462a-9cb0-aac3ae0b1dc8.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709885578000-a9ea41cb-410d-41b5-b64b-4241fb15572f.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709885612891-c9761074-1926-4d62-a088-4868d0d92847.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709886675241-b05080b8-6262-4256-bd1a-62a604916d2b.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709891445941-3eee6c78-5284-49d8-a120-f272c43f6e58.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709895001762-cece1a26-d55a-4632-b4f6-4194b9665299.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709895144355-f28819e9-5ec2-4e0d-b672-ee3a4a693ce6.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709905780255-ab58c2e3-a3ee-4755-a1cf-38c7d27a34f6.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709907989788-bffa1333-9f9f-43bd-87de-0a7103fa7ffe.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709986358134-eaa5ec99-b7ba-43b1-91d1-d0a894096169.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709986689318-e10a86c7-029a-4b63-b4c4-b89a01be1f3f.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709986995270-496c3d22-2c31-4dae-b595-71d35eab1115.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709988965134-32ee7252-b78f-48a3-b54b-a4341d13a5b3.jpeg">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709996553038-373492a4-3de1-4527-905c-b1c81779455b.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709996605391-dbc0a0f7-f1be-4d4e-8977-e9e4fb4201d8.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709998714466-58a11c81-bbcc-473a-be69-5f502fc27935.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710037354065-18fd812f-ffd2-4a8d-a365-a9bdb19945ce.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710037395779-8ca17af8-e5e1-452f-8979-d4725ee3644a.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710038767348-a75d55fb-4d7a-42a6-9ca3-8cbfdbe0e767.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710049853301-6701169c-cc19-4db5-9516-c96d592a8b12.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710049860220-a317f8e4-053f-402f-b6a1-c5770b5a5434.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710049867735-76295fbf-ca1b-45ff-b1cc-f279c158e3ea.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710052075990-5e411011-e619-4c9c-9069-2ea9383b4dfd.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710052747718-52d2e1d6-bcec-4099-a76e-80a86e03d225.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710053407431-31dc7351-f187-4517-b839-d3cdaa62a37a.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710053418337-d813c379-b507-49b5-b809-cfcbbd3e6c8a.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710053779932-c4ae8a47-9ab5-4e36-976b-2608a72e2e1e.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710055097023-438f5ca7-44e6-454c-80bc-44ef18870c0f.jpeg">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710059455864-b888bb47-acc7-4b59-a1a4-ea6fde4ff34a.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710059462271-8497c6f7-7a35-44d0-b0c0-eaa3e5b8b028.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710071756990-4507cdff-32ef-4109-a832-3ba4e35477f8.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710072895076-3496eca6-fc66-42fa-a94c-cfc63add6fb4.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710076254112-11e55663-583d-470c-b082-40ebc5292bfe.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710076322063-b154c016-2d09-4d0c-a54e-c380e2bd3d10.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710076310443-0eeaf24f-6b16-4cd0-be06-b9d181c8388c.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710076707645-b1bac10a-ad7c-47e1-be03-96c3822653b7.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710076716959-1c6e73fd-bf72-47dc-a7eb-c8c492a884a5.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710082698618-8b51e012-68fa-47cb-ba4b-342bbc4acc69.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710084691663-dc9ce24f-8ef3-4a25-994e-25d3735e32f3.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1710084719595-0e30c53c-ddc1-4390-974f-2f1f47881ac8.png">
<meta property="og:image" content="https://mrhzq.github.io/img/images/2024/1709990631939-8eb470df-242f-4e74-b0e1-3325dbcd3f0c.jpeg">
<meta property="article:published_time" content="2024-01-13T23:32:55.000Z">
<meta property="article:modified_time" content="2024-03-22T23:32:55.000Z">
<meta property="article:author" content="黄智强">
<meta property="article:tag" content="职业上一二事">
<meta property="article:tag" content="前端面试">
<meta property="article:tag" content="前端八股文">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://mrhzq.github.io/img/images/2024/1709800832052-29f9c9ae-8d1a-4e5b-b096-12a7eaeb1acb.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>5-1、React 实战之从零到一的项目搭建与开发 - 黄智强的博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"mrhzq.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":60,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":3},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":["8d444eea7721c65dc4af82b3d51c7d57","ac7285ab2138ab848cf5d71468ec7743"],"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?8d444eea7721c65dc4af82b3d51c7d57,ac7285ab2138ab848cf5d71468ec7743";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>黄智强的博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>文章</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>更多</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://fluid.s3.bitiful.net/bg/vdysjx.png?w=1920&fmt=webp') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="5-1、React 实战之从零到一的项目搭建与开发"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        黄智强
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-01-13 23:32" pubdate>
          2024年1月13日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          22k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          183 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">5-1、React 实战之从零到一的项目搭建与开发</h1>
            
              <p id="updated-time" class="note note-info" style="display: none">
                
                  
                    本文最后更新于 2024-03-22T23:32:55+00:00
                  
                  

                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="1、Mono-仓库搭建"><a href="#1、Mono-仓库搭建" class="headerlink" title="1、Mono 仓库搭建"></a>1、Mono 仓库搭建</h1><p>Mono：单一；repo：repository 仓库<br>Monorepo：指的是多个项目用一个仓库来管理<br><a target="_blank" rel="noopener" href="https://juejin.cn/post/7207743145999368229">为什么越来越多的项目选择 Monorepo？ - 掘金</a></p>
<p>本次采用<code>pnpm v7.30.3</code>来搭建，<code>node</code>版本为<code>v16.14.0</code></p>
<h2 id="搭建步骤如下"><a href="#搭建步骤如下" class="headerlink" title="搭建步骤如下"></a>搭建步骤如下</h2><p>所有带<strong>数字编号</strong>的都是要操作的步骤哦</p>
<h3 id="初始化工程"><a href="#初始化工程" class="headerlink" title="初始化工程"></a>初始化工程</h3><ol>
<li>初始化并生成一个<code>package.json</code>文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm init<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>创建<code>pnpm-workspace.yaml</code>文件，并填入如下内容：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch pnpm-workspace.<span class="hljs-property">yaml</span><br></code></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">packages:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;packages/**&quot;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>创建<code>packages</code>文件夹</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir packages<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>创建<code>apps、components、libs</code>三个文件夹</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir packages/apps packages/components packages/libs<br></code></pre></td></tr></table></figure>

<ol start="5">
<li>初始化<code>apps</code>下面的项目，<code>react-master</code>可任意取名</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">cd packages/apps &amp;&amp; mkdir react-master &amp;&amp; cd react-master &amp;&amp; pnpm init &amp;&amp; touch index.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="6">
<li>初始化<code>libs</code>下面的项目，<code>react-test-utils</code>可任意取名</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">cd ../../../ &amp;&amp; cd packages/libs &amp;&amp; mkdir react-test-utils &amp;&amp; cd react-test-utils &amp;&amp; pnpm init &amp;&amp; touch index.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="7">
<li>在<code>libs/react-test-utils/index.js</code>内写如下代码：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getName</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;this is react-test-utils&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h3 id="npm-包的安装"><a href="#npm-包的安装" class="headerlink" title="npm 包的安装"></a>npm 包的安装</h3><h4 id="项目全局安装"><a href="#项目全局安装" class="headerlink" title="项目全局安装"></a>项目全局安装</h4><p>这样安装的包三个项目都可以使用，核心命令<code>-w 或 --workspace</code><br>完整命令：<code>pnpm add XXX -w</code>，在<code>项目根路径</code>运行如下命令，将在当前文件创建<code>node_modules</code></p>
<ol start="8">
<li>全局安装<code>eslint</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add eslint -D -w<br></code></pre></td></tr></table></figure>

<h4 id="局部安装"><a href="#局部安装" class="headerlink" title="局部安装"></a>局部安装</h4><p>将对应的包安装到对应的项目中去，核心命令<code>--filter=packageName</code><br>完整命令：<code>pnpm add XXX --filter=packageName</code>，在<code>项目根路径</code>运行如下命令，将在<code>packageName</code>创建<code>node_modules</code></p>
<ol start="9">
<li>给<code>apps/test-pro</code>项目安装<code>lodash</code>（根目录运行）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add lodash --filter=react-master<br></code></pre></td></tr></table></figure>

<blockquote>
<p>PS：也可以 cd 到 test-pro 内，然后安装依赖 pnpm add lodash</p>
</blockquote>
<h4 id="内部安装"><a href="#内部安装" class="headerlink" title="内部安装"></a>内部安装</h4><p>使用 Mono 形式后，支持互相作为 npm 包进行安装引用，语法跟局部安装一样<br>完整命令：<code>pnpm add packageName1 --filter=packageName2</code>，解释：将<code>packageName1</code>作为 npm 包安装到<code>packageName2</code>中</p>
<ol start="10">
<li>将<code>libs/test-util</code>安装到<code>apps/test-pro</code>内（根目录运行）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add react-test-utils --filter=react-master<br></code></pre></td></tr></table></figure>

<p>以下是<code>apps/react-test-pro/package.json</code>，可以看到<code>react-test-utils</code>作为依赖成功被安装了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;react-master&quot;</span>,<br>  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;1.0.0&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;index.js&quot;</span>,<br>  <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;keywords&quot;</span>: [],<br>  <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;license&quot;</span>: <span class="hljs-string">&quot;ISC&quot;</span>,<br>  <span class="hljs-string">&quot;dependencies&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;lodash&quot;</span>: <span class="hljs-string">&quot;^4.17.21&quot;</span>,<br>    <span class="hljs-string">&quot;react-test-utils&quot;</span>: <span class="hljs-string">&quot;workspace:^1.0.0&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>PS：若内部包名与外部(npm 上)包名重复，优先安装外部的，所以内部包名最好取的唯一一点</p>
</blockquote>
<h3 id="安装基础环境-根目录下"><a href="#安装基础环境-根目录下" class="headerlink" title="安装基础环境(根目录下)"></a>安装基础环境(根目录下)</h3><h4 id="eslint-环境"><a href="#eslint-环境" class="headerlink" title="eslint 环境"></a>eslint 环境</h4><blockquote>
<p>eslint 检测代码错误的</p>
</blockquote>
<ol start="11">
<li>根目录，运行：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">npx eslint --init<br></code></pre></td></tr></table></figure>

<p><img src="/img/images/2024/1709800832052-29f9c9ae-8d1a-4e5b-b096-12a7eaeb1acb.png" srcset="/img/loading.gif" lazyload></p>
<ol start="12">
<li>根目录，手动安装（因为缺了 -w 所以上一步安装报警告）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add @typescript-eslint/eslint-plugin@latest @typescript-eslint/parser@latest -D -w<br></code></pre></td></tr></table></figure>

<h4 id="prettier-环境"><a href="#prettier-环境" class="headerlink" title="prettier 环境"></a>prettier 环境</h4><blockquote>
<p>prettier 处理代码风格的</p>
</blockquote>
<ol start="13">
<li>根目录，运行：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add prettier -D -w<br></code></pre></td></tr></table></figure>

<ol start="14">
<li>根目录，新建<code>.prettierrc.json</code>文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch .<span class="hljs-property">prettierrc</span>.<span class="hljs-property">json</span><br></code></pre></td></tr></table></figure>

<ol start="15">
<li>然后简单写如下配置，可以自行网上找更丰富的配置项</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>    <span class="hljs-string">&quot;printWidth&quot;</span>: <span class="hljs-number">80</span>,<br>    <span class="hljs-string">&quot;tabWidth&quot;</span>: <span class="hljs-number">2</span>,<br>    <span class="hljs-string">&quot;useTabs&quot;</span>: <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="16">
<li>安装对应的 vscode 插件，才能起作用哦<br><img src="/img/images/2024/1709801671722-35e3994b-8428-42e8-a42e-4b81f4e6c220.png" srcset="/img/loading.gif" lazyload></li>
<li>但<code>prettier</code>可能会和<code>eslint</code>其冲突，所以还要安装(根目录)：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add eslint-plugin-prettier eslint-config-prettier -D -w<br></code></pre></td></tr></table></figure>

<ol start="18">
<li>进入<code>.eslintrc.json</code>加上安装的插件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  ....<br><br>  <span class="hljs-string">&quot;plugins&quot;</span>: [<span class="hljs-string">&quot;@typescript-eslint&quot;</span>, <span class="hljs-string">&quot;prettier&quot;</span>],<br><br>  ....<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="安装-TypeScript"><a href="#安装-TypeScript" class="headerlink" title="安装 TypeScript"></a>安装 TypeScript</h3><blockquote>
<p>tsc、ts-loader、@babel&#x2F;preset-typescript 的区别与使用</p>
<p>1、tsc：TypeScript 的官方编译器，将 TS 代码转为 JS 代码，并进行类型检查、支持 TS 泛型、枚举等转为 JS<br>2、ts-loader：一个 webpack loader，它内部调用了 TypeScript 的官方编译器(tsc)，所以它两能共用 tsconfig.json<br>3、@babel&#x2F;preset-typescript： 只将 TS 代码转为 JS 代码，不进行类型检查，所以为了实现类型检查，就需要用 tsc 的配置</p>
<p>使用：一般项目，不使用 tsc 生成代码，只让它做类型检查。<br>项目中没 babel，就用 tsc + ts-loader；有 babel 就用 @babel&#x2F;preset-typescript + tsc(类型检查)</p>
</blockquote>
<ol start="19">
<li>去进入项目<code>packages/apps/react-master</code>，命令行运行，创建 tsconfig.json 配置</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">tsc --init<br></code></pre></td></tr></table></figure>

<p>会生成如下的配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br> <span class="hljs-string">&quot;compilerOptions&quot;</span>: &#123;<br>  <span class="hljs-comment">/* Visit https://aka.ms/tsconfig to read more about this file */</span><br><br>  <span class="hljs-comment">/* Projects */</span><br>  <span class="hljs-comment">// &quot;incremental&quot;: true,                              /* Save .tsbuildinfo files to allow for incremental compilation of projects. */</span><br>  <span class="hljs-comment">// &quot;composite&quot;: true,                                /* Enable constraints that allow a TypeScript project to be used with project references. */</span><br>  <span class="hljs-comment">// &quot;tsBuildInfoFile&quot;: &quot;./.tsbuildinfo&quot;,              /* Specify the path to .tsbuildinfo incremental compilation file. */</span><br>  <span class="hljs-comment">// &quot;disableSourceOfProjectReferenceRedirect&quot;: true,  /* Disable preferring source files instead of declaration files when referencing composite projects. */</span><br>  <span class="hljs-comment">// &quot;disableSolutionSearching&quot;: true,                 /* Opt a project out of multi-project reference checking when editing. */</span><br>  <span class="hljs-comment">// &quot;disableReferencedProjectLoad&quot;: true,             /* Reduce the number of projects loaded automatically by TypeScript. */</span><br><br>  <span class="hljs-comment">/* Language and Environment */</span><br>  <span class="hljs-string">&quot;target&quot;</span>: <span class="hljs-string">&quot;es2016&quot;</span> <span class="hljs-comment">/* Set the JavaScript language version for emitted JavaScript and include compatible library declarations. */</span>,<br>  <span class="hljs-comment">// &quot;lib&quot;: [],                                        /* Specify a set of bundled library declaration files that describe the target runtime environment. */</span><br>  <span class="hljs-comment">// &quot;jsx&quot;: &quot;preserve&quot;,                                /* Specify what JSX code is generated. */</span><br>  <span class="hljs-comment">// &quot;experimentalDecorators&quot;: true,                   /* Enable experimental support for legacy experimental decorators. */</span><br>  <span class="hljs-comment">// &quot;emitDecoratorMetadata&quot;: true,                    /* Emit design-type metadata for decorated declarations in source files. */</span><br>  <span class="hljs-comment">// &quot;jsxFactory&quot;: &quot;&quot;,                                 /* Specify the JSX factory function used when targeting React JSX emit, e.g. &#x27;React.createElement&#x27; or &#x27;h&#x27;. */</span><br>  <span class="hljs-comment">// &quot;jsxFragmentFactory&quot;: &quot;&quot;,                         /* Specify the JSX Fragment reference used for fragments when targeting React JSX emit e.g. &#x27;React.Fragment&#x27; or &#x27;Fragment&#x27;. */</span><br>  <span class="hljs-comment">// &quot;jsxImportSource&quot;: &quot;&quot;,                            /* Specify module specifier used to import the JSX factory functions when using &#x27;jsx: react-jsx*&#x27;. */</span><br>  <span class="hljs-comment">// &quot;reactNamespace&quot;: &quot;&quot;,                             /* Specify the object invoked for &#x27;createElement&#x27;. This only applies when targeting &#x27;react&#x27; JSX emit. */</span><br>  <span class="hljs-comment">// &quot;noLib&quot;: true,                                    /* Disable including any library files, including the default lib.d.ts. */</span><br>  <span class="hljs-comment">// &quot;useDefineForClassFields&quot;: true,                  /* Emit ECMAScript-standard-compliant class fields. */</span><br>  <span class="hljs-comment">// &quot;moduleDetection&quot;: &quot;auto&quot;,                        /* Control what method is used to detect module-format JS files. */</span><br><br>  <span class="hljs-comment">/* Modules */</span><br>  <span class="hljs-string">&quot;module&quot;</span>: <span class="hljs-string">&quot;commonjs&quot;</span> <span class="hljs-comment">/* Specify what module code is generated. */</span>,<br>  <span class="hljs-comment">// &quot;rootDir&quot;: &quot;./&quot;,                                  /* Specify the root folder within your source files. */</span><br>  <span class="hljs-comment">// &quot;moduleResolution&quot;: &quot;node10&quot;,                     /* Specify how TypeScript looks up a file from a given module specifier. */</span><br>  <span class="hljs-comment">// &quot;baseUrl&quot;: &quot;./&quot;,                                  /* Specify the base directory to resolve non-relative module names. */</span><br>  <span class="hljs-comment">// &quot;paths&quot;: &#123;&#125;,                                      /* Specify a set of entries that re-map imports to additional lookup locations. */</span><br>  <span class="hljs-comment">// &quot;rootDirs&quot;: [],                                   /* Allow multiple folders to be treated as one when resolving modules. */</span><br>  <span class="hljs-comment">// &quot;typeRoots&quot;: [],                                  /* Specify multiple folders that act like &#x27;./node_modules/@types&#x27;. */</span><br>  <span class="hljs-comment">// &quot;types&quot;: [],                                      /* Specify type package names to be included without being referenced in a source file. */</span><br>  <span class="hljs-comment">// &quot;allowUmdGlobalAccess&quot;: true,                     /* Allow accessing UMD globals from modules. */</span><br>  <span class="hljs-comment">// &quot;moduleSuffixes&quot;: [],                             /* List of file name suffixes to search when resolving a module. */</span><br>  <span class="hljs-comment">// &quot;allowImportingTsExtensions&quot;: true,               /* Allow imports to include TypeScript file extensions. Requires &#x27;--moduleResolution bundler&#x27; and either &#x27;--noEmit&#x27; or &#x27;--emitDeclarationOnly&#x27; to be set. */</span><br>  <span class="hljs-comment">// &quot;resolvePackageJsonExports&quot;: true,                /* Use the package.json &#x27;exports&#x27; field when resolving package imports. */</span><br>  <span class="hljs-comment">// &quot;resolvePackageJsonImports&quot;: true,                /* Use the package.json &#x27;imports&#x27; field when resolving imports. */</span><br>  <span class="hljs-comment">// &quot;customConditions&quot;: [],                           /* Conditions to set in addition to the resolver-specific defaults when resolving imports. */</span><br>  <span class="hljs-comment">// &quot;resolveJsonModule&quot;: true,                        /* Enable importing .json files. */</span><br>  <span class="hljs-comment">// &quot;allowArbitraryExtensions&quot;: true,                 /* Enable importing files with any extension, provided a declaration file is present. */</span><br>  <span class="hljs-comment">// &quot;noResolve&quot;: true,                                /* Disallow &#x27;import&#x27;s, &#x27;require&#x27;s or &#x27;&lt;reference&gt;&#x27;s from expanding the number of files TypeScript should add to a project. */</span><br><br>  <span class="hljs-comment">/* JavaScript Support */</span><br>  <span class="hljs-comment">// &quot;allowJs&quot;: true,                                  /* Allow JavaScript files to be a part of your program. Use the &#x27;checkJS&#x27; option to get errors from these files. */</span><br>  <span class="hljs-comment">// &quot;checkJs&quot;: true,                                  /* Enable error reporting in type-checked JavaScript files. */</span><br>  <span class="hljs-comment">// &quot;maxNodeModuleJsDepth&quot;: 1,                        /* Specify the maximum folder depth used for checking JavaScript files from &#x27;node_modules&#x27;. Only applicable with &#x27;allowJs&#x27;. */</span><br><br>  <span class="hljs-comment">/* Emit */</span><br>  <span class="hljs-comment">// &quot;declaration&quot;: true,                              /* Generate .d.ts files from TypeScript and JavaScript files in your project. */</span><br>  <span class="hljs-comment">// &quot;declarationMap&quot;: true,                           /* Create sourcemaps for d.ts files. */</span><br>  <span class="hljs-comment">// &quot;emitDeclarationOnly&quot;: true,                      /* Only output d.ts files and not JavaScript files. */</span><br>  <span class="hljs-comment">// &quot;sourceMap&quot;: true,                                /* Create source map files for emitted JavaScript files. */</span><br>  <span class="hljs-comment">// &quot;inlineSourceMap&quot;: true,                          /* Include sourcemap files inside the emitted JavaScript. */</span><br>  <span class="hljs-comment">// &quot;outFile&quot;: &quot;./&quot;,                                  /* Specify a file that bundles all outputs into one JavaScript file. If &#x27;declaration&#x27; is true, also designates a file that bundles all .d.ts output. */</span><br>  <span class="hljs-comment">// &quot;outDir&quot;: &quot;./&quot;,                                   /* Specify an output folder for all emitted files. */</span><br>  <span class="hljs-comment">// &quot;removeComments&quot;: true,                           /* Disable emitting comments. */</span><br>  <span class="hljs-comment">// &quot;noEmit&quot;: true,                                   /* Disable emitting files from a compilation. */</span><br>  <span class="hljs-comment">// &quot;importHelpers&quot;: true,                            /* Allow importing helper functions from tslib once per project, instead of including them per-file. */</span><br>  <span class="hljs-comment">// &quot;importsNotUsedAsValues&quot;: &quot;remove&quot;,               /* Specify emit/checking behavior for imports that are only used for types. */</span><br>  <span class="hljs-comment">// &quot;downlevelIteration&quot;: true,                       /* Emit more compliant, but verbose and less performant JavaScript for iteration. */</span><br>  <span class="hljs-comment">// &quot;sourceRoot&quot;: &quot;&quot;,                                 /* Specify the root path for debuggers to find the reference source code. */</span><br>  <span class="hljs-comment">// &quot;mapRoot&quot;: &quot;&quot;,                                    /* Specify the location where debugger should locate map files instead of generated locations. */</span><br>  <span class="hljs-comment">// &quot;inlineSources&quot;: true,                            /* Include source code in the sourcemaps inside the emitted JavaScript. */</span><br>  <span class="hljs-comment">// &quot;emitBOM&quot;: true,                                  /* Emit a UTF-8 Byte Order Mark (BOM) in the beginning of output files. */</span><br>  <span class="hljs-comment">// &quot;newLine&quot;: &quot;crlf&quot;,                                /* Set the newline character for emitting files. */</span><br>  <span class="hljs-comment">// &quot;stripInternal&quot;: true,                            /* Disable emitting declarations that have &#x27;@internal&#x27; in their JSDoc comments. */</span><br>  <span class="hljs-comment">// &quot;noEmitHelpers&quot;: true,                            /* Disable generating custom helper functions like &#x27;__extends&#x27; in compiled output. */</span><br>  <span class="hljs-comment">// &quot;noEmitOnError&quot;: true,                            /* Disable emitting files if any type checking errors are reported. */</span><br>  <span class="hljs-comment">// &quot;preserveConstEnums&quot;: true,                       /* Disable erasing &#x27;const enum&#x27; declarations in generated code. */</span><br>  <span class="hljs-comment">// &quot;declarationDir&quot;: &quot;./&quot;,                           /* Specify the output directory for generated declaration files. */</span><br>  <span class="hljs-comment">// &quot;preserveValueImports&quot;: true,                     /* Preserve unused imported values in the JavaScript output that would otherwise be removed. */</span><br><br>  <span class="hljs-comment">/* Interop Constraints */</span><br>  <span class="hljs-comment">// &quot;isolatedModules&quot;: true,                          /* Ensure that each file can be safely transpiled without relying on other imports. */</span><br>  <span class="hljs-comment">// &quot;verbatimModuleSyntax&quot;: true,                     /* Do not transform or elide any imports or exports not marked as type-only, ensuring they are written in the output file&#x27;s format based on the &#x27;module&#x27; setting. */</span><br>  <span class="hljs-comment">// &quot;allowSyntheticDefaultImports&quot;: true,             /* Allow &#x27;import x from y&#x27; when a module doesn&#x27;t have a default export. */</span><br>  <span class="hljs-string">&quot;esModuleInterop&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Emit additional JavaScript to ease support for importing CommonJS modules. This enables &#x27;allowSyntheticDefaultImports&#x27; for type compatibility. */</span>,<br>  <span class="hljs-comment">// &quot;preserveSymlinks&quot;: true,                         /* Disable resolving symlinks to their realpath. This correlates to the same flag in node. */</span><br>  <span class="hljs-string">&quot;forceConsistentCasingInFileNames&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Ensure that casing is correct in imports. */</span>,<br><br>  <span class="hljs-comment">/* Type Checking */</span><br>  <span class="hljs-string">&quot;strict&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Enable all strict type-checking options. */</span>,<br>  <span class="hljs-comment">// &quot;noImplicitAny&quot;: true,                            /* Enable error reporting for expressions and declarations with an implied &#x27;any&#x27; type. */</span><br>  <span class="hljs-comment">// &quot;strictNullChecks&quot;: true,                         /* When type checking, take into account &#x27;null&#x27; and &#x27;undefined&#x27;. */</span><br>  <span class="hljs-comment">// &quot;strictFunctionTypes&quot;: true,                      /* When assigning functions, check to ensure parameters and the return values are subtype-compatible. */</span><br>  <span class="hljs-comment">// &quot;strictBindCallApply&quot;: true,                      /* Check that the arguments for &#x27;bind&#x27;, &#x27;call&#x27;, and &#x27;apply&#x27; methods match the original function. */</span><br>  <span class="hljs-comment">// &quot;strictPropertyInitialization&quot;: true,             /* Check for class properties that are declared but not set in the constructor. */</span><br>  <span class="hljs-comment">// &quot;noImplicitThis&quot;: true,                           /* Enable error reporting when &#x27;this&#x27; is given the type &#x27;any&#x27;. */</span><br>  <span class="hljs-comment">// &quot;useUnknownInCatchVariables&quot;: true,               /* Default catch clause variables as &#x27;unknown&#x27; instead of &#x27;any&#x27;. */</span><br>  <span class="hljs-comment">// &quot;alwaysStrict&quot;: true,                             /* Ensure &#x27;use strict&#x27; is always emitted. */</span><br>  <span class="hljs-comment">// &quot;noUnusedLocals&quot;: true,                           /* Enable error reporting when local variables aren&#x27;t read. */</span><br>  <span class="hljs-comment">// &quot;noUnusedParameters&quot;: true,                       /* Raise an error when a function parameter isn&#x27;t read. */</span><br>  <span class="hljs-comment">// &quot;exactOptionalPropertyTypes&quot;: true,               /* Interpret optional property types as written, rather than adding &#x27;undefined&#x27;. */</span><br>  <span class="hljs-comment">// &quot;noImplicitReturns&quot;: true,                        /* Enable error reporting for codepaths that do not explicitly return in a function. */</span><br>  <span class="hljs-comment">// &quot;noFallthroughCasesInSwitch&quot;: true,               /* Enable error reporting for fallthrough cases in switch statements. */</span><br>  <span class="hljs-comment">// &quot;noUncheckedIndexedAccess&quot;: true,                 /* Add &#x27;undefined&#x27; to a type when accessed using an index. */</span><br>  <span class="hljs-comment">// &quot;noImplicitOverride&quot;: true,                       /* Ensure overriding members in derived classes are marked with an override modifier. */</span><br>  <span class="hljs-comment">// &quot;noPropertyAccessFromIndexSignature&quot;: true,       /* Enforces using indexed accessors for keys declared using an indexed type. */</span><br>  <span class="hljs-comment">// &quot;allowUnusedLabels&quot;: true,                        /* Disable error reporting for unused labels. */</span><br>  <span class="hljs-comment">// &quot;allowUnreachableCode&quot;: true,                     /* Disable error reporting for unreachable code. */</span><br><br>  <span class="hljs-comment">/* Completeness */</span><br>  <span class="hljs-comment">// &quot;skipDefaultLibCheck&quot;: true,                      /* Skip type checking .d.ts files that are included with TypeScript. */</span><br>  <span class="hljs-string">&quot;skipLibCheck&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Skip type checking all .d.ts files. */</span><br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="20">
<li>配置微调，调整完毕后如下：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br> <span class="hljs-string">&quot;compilerOptions&quot;</span>: &#123;<br>  <span class="hljs-comment">/* Visit https://aka.ms/tsconfig to read more about this file */</span><br><br>  <span class="hljs-comment">/* Projects */</span><br>  <span class="hljs-comment">// &quot;incremental&quot;: true,                              /* Save .tsbuildinfo files to allow for incremental compilation of projects. */</span><br>  <span class="hljs-comment">// &quot;composite&quot;: true,                                /* Enable constraints that allow a TypeScript project to be used with project references. */</span><br>  <span class="hljs-comment">// &quot;tsBuildInfoFile&quot;: &quot;./.tsbuildinfo&quot;,              /* Specify the path to .tsbuildinfo incremental compilation file. */</span><br>  <span class="hljs-comment">// &quot;disableSourceOfProjectReferenceRedirect&quot;: true,  /* Disable preferring source files instead of declaration files when referencing composite projects. */</span><br>  <span class="hljs-comment">// &quot;disableSolutionSearching&quot;: true,                 /* Opt a project out of multi-project reference checking when editing. */</span><br>  <span class="hljs-comment">// &quot;disableReferencedProjectLoad&quot;: true,             /* Reduce the number of projects loaded automatically by TypeScript. */</span><br><br>  <span class="hljs-comment">/* Language and Environment */</span><br>  <span class="hljs-string">&quot;target&quot;</span>: <span class="hljs-string">&quot;es2016&quot;</span> <span class="hljs-comment">/* Set the JavaScript language version for emitted JavaScript and include compatible library declarations. */</span>,<br>  <span class="hljs-string">&quot;lib&quot;</span>: [<br>   <span class="hljs-string">&quot;DOM&quot;</span>,<br>   <span class="hljs-string">&quot;DOM.Iterable&quot;</span>,<br>   <span class="hljs-string">&quot;ESNext&quot;</span><br>  ] <span class="hljs-comment">/* Specify a set of bundled library declaration files that describe the target runtime environment. */</span>,<br>  <span class="hljs-string">&quot;jsx&quot;</span>: <span class="hljs-string">&quot;react&quot;</span> <span class="hljs-comment">/* Specify what JSX code is generated. */</span>,<br>  <span class="hljs-string">&quot;experimentalDecorators&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Enable experimental support for legacy experimental decorators. */</span>,<br>  <span class="hljs-string">&quot;emitDecoratorMetadata&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Emit design-type metadata for decorated declarations in source files. */</span>,<br>  <span class="hljs-comment">// &quot;jsxFactory&quot;: &quot;&quot;,                                 /* Specify the JSX factory function used when targeting React JSX emit, e.g. &#x27;React.createElement&#x27; or &#x27;h&#x27;. */</span><br>  <span class="hljs-comment">// &quot;jsxFragmentFactory&quot;: &quot;&quot;,                         /* Specify the JSX Fragment reference used for fragments when targeting React JSX emit e.g. &#x27;React.Fragment&#x27; or &#x27;Fragment&#x27;. */</span><br>  <span class="hljs-comment">// &quot;jsxImportSource&quot;: &quot;&quot;,                            /* Specify module specifier used to import the JSX factory functions when using &#x27;jsx: react-jsx*&#x27;. */</span><br>  <span class="hljs-comment">// &quot;reactNamespace&quot;: &quot;&quot;,                             /* Specify the object invoked for &#x27;createElement&#x27;. This only applies when targeting &#x27;react&#x27; JSX emit. */</span><br>  <span class="hljs-comment">// &quot;noLib&quot;: true,                                    /* Disable including any library files, including the default lib.d.ts. */</span><br>  <span class="hljs-comment">// &quot;useDefineForClassFields&quot;: true,                  /* Emit ECMAScript-standard-compliant class fields. */</span><br>  <span class="hljs-comment">// &quot;moduleDetection&quot;: &quot;auto&quot;,                        /* Control what method is used to detect module-format JS files. */</span><br><br>  <span class="hljs-comment">/* Modules */</span><br>  <span class="hljs-string">&quot;module&quot;</span>: <span class="hljs-string">&quot;ESNext&quot;</span> <span class="hljs-comment">/* Specify what module code is generated. */</span>,<br>  <span class="hljs-comment">// &quot;rootDir&quot;: &quot;./&quot;,                                  /* Specify the root folder within your source files. */</span><br>  <span class="hljs-string">&quot;moduleResolution&quot;</span>: <span class="hljs-string">&quot;node&quot;</span> <span class="hljs-comment">/* Specify how TypeScript looks up a file from a given module specifier. */</span>,<br>  <span class="hljs-comment">// &quot;baseUrl&quot;: &quot;./&quot;,                                  /* Specify the base directory to resolve non-relative module names. */</span><br>  <span class="hljs-comment">// &quot;paths&quot;: &#123;&#125;,                                      /* Specify a set of entries that re-map imports to additional lookup locations. */</span><br>  <span class="hljs-comment">// &quot;rootDirs&quot;: [],                                   /* Allow multiple folders to be treated as one when resolving modules. */</span><br>  <span class="hljs-comment">// &quot;typeRoots&quot;: [],                                  /* Specify multiple folders that act like &#x27;./node_modules/@types&#x27;. */</span><br>  <span class="hljs-comment">// &quot;types&quot;: [],                                      /* Specify type package names to be included without being referenced in a source file. */</span><br>  <span class="hljs-comment">// &quot;allowUmdGlobalAccess&quot;: true,                     /* Allow accessing UMD globals from modules. */</span><br>  <span class="hljs-comment">// &quot;moduleSuffixes&quot;: [],                             /* List of file name suffixes to search when resolving a module. */</span><br>  <span class="hljs-comment">// &quot;allowImportingTsExtensions&quot;: true,               /* Allow imports to include TypeScript file extensions. Requires &#x27;--moduleResolution bundler&#x27; and either &#x27;--noEmit&#x27; or &#x27;--emitDeclarationOnly&#x27; to be set. */</span><br>  <span class="hljs-comment">// &quot;resolvePackageJsonExports&quot;: true,                /* Use the package.json &#x27;exports&#x27; field when resolving package imports. */</span><br>  <span class="hljs-comment">// &quot;resolvePackageJsonImports&quot;: true,                /* Use the package.json &#x27;imports&#x27; field when resolving imports. */</span><br>  <span class="hljs-comment">// &quot;customConditions&quot;: [],                           /* Conditions to set in addition to the resolver-specific defaults when resolving imports. */</span><br>  <span class="hljs-string">&quot;resolveJsonModule&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Enable importing .json files. */</span>,<br>  <span class="hljs-comment">// &quot;allowArbitraryExtensions&quot;: true,                 /* Enable importing files with any extension, provided a declaration file is present. */</span><br>  <span class="hljs-comment">// &quot;noResolve&quot;: true,                                /* Disallow &#x27;import&#x27;s, &#x27;require&#x27;s or &#x27;&lt;reference&gt;&#x27;s from expanding the number of files TypeScript should add to a project. */</span><br><br>  <span class="hljs-comment">/* JavaScript Support */</span><br>  <span class="hljs-string">&quot;allowJs&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Allow JavaScript files to be a part of your program. Use the &#x27;checkJS&#x27; option to get errors from these files. */</span>,<br>  <span class="hljs-comment">// &quot;checkJs&quot;: true,                                  /* Enable error reporting in type-checked JavaScript files. */</span><br>  <span class="hljs-comment">// &quot;maxNodeModuleJsDepth&quot;: 1,                        /* Specify the maximum folder depth used for checking JavaScript files from &#x27;node_modules&#x27;. Only applicable with &#x27;allowJs&#x27;. */</span><br><br>  <span class="hljs-comment">/* Emit */</span><br>  <span class="hljs-comment">// &quot;declaration&quot;: true,                              /* Generate .d.ts files from TypeScript and JavaScript files in your project. */</span><br>  <span class="hljs-comment">// &quot;declarationMap&quot;: true,                           /* Create sourcemaps for d.ts files. */</span><br>  <span class="hljs-comment">// &quot;emitDeclarationOnly&quot;: true,                      /* Only output d.ts files and not JavaScript files. */</span><br>  <span class="hljs-comment">// &quot;sourceMap&quot;: true,                                /* Create source map files for emitted JavaScript files. */</span><br>  <span class="hljs-comment">// &quot;inlineSourceMap&quot;: true,                          /* Include sourcemap files inside the emitted JavaScript. */</span><br>  <span class="hljs-comment">// &quot;outFile&quot;: &quot;./&quot;,                                  /* Specify a file that bundles all outputs into one JavaScript file. If &#x27;declaration&#x27; is true, also designates a file that bundles all .d.ts output. */</span><br>  <span class="hljs-comment">// &quot;outDir&quot;: &quot;./&quot;,                                   /* Specify an output folder for all emitted files. */</span><br>  <span class="hljs-comment">// &quot;removeComments&quot;: true,                           /* Disable emitting comments. */</span><br>  <span class="hljs-string">&quot;noEmit&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* 不输出文件，只做类型检查 */</span> <span class="hljs-comment">/* Disable emitting files from a compilation. */</span>,<br>  <span class="hljs-comment">// &quot;importHelpers&quot;: true,                            /* Allow importing helper functions from tslib once per project, instead of including them per-file. */</span><br>  <span class="hljs-comment">// &quot;importsNotUsedAsValues&quot;: &quot;remove&quot;,               /* Specify emit/checking behavior for imports that are only used for types. */</span><br>  <span class="hljs-comment">// &quot;downlevelIteration&quot;: true,                       /* Emit more compliant, but verbose and less performant JavaScript for iteration. */</span><br>  <span class="hljs-comment">// &quot;sourceRoot&quot;: &quot;&quot;,                                 /* Specify the root path for debuggers to find the reference source code. */</span><br>  <span class="hljs-comment">// &quot;mapRoot&quot;: &quot;&quot;,                                    /* Specify the location where debugger should locate map files instead of generated locations. */</span><br>  <span class="hljs-comment">// &quot;inlineSources&quot;: true,                            /* Include source code in the sourcemaps inside the emitted JavaScript. */</span><br>  <span class="hljs-comment">// &quot;emitBOM&quot;: true,                                  /* Emit a UTF-8 Byte Order Mark (BOM) in the beginning of output files. */</span><br>  <span class="hljs-comment">// &quot;newLine&quot;: &quot;crlf&quot;,                                /* Set the newline character for emitting files. */</span><br>  <span class="hljs-comment">// &quot;stripInternal&quot;: true,                            /* Disable emitting declarations that have &#x27;@internal&#x27; in their JSDoc comments. */</span><br>  <span class="hljs-comment">// &quot;noEmitHelpers&quot;: true,                            /* Disable generating custom helper functions like &#x27;__extends&#x27; in compiled output. */</span><br>  <span class="hljs-comment">// &quot;noEmitOnError&quot;: true,                            /* Disable emitting files if any type checking errors are reported. */</span><br>  <span class="hljs-comment">// &quot;preserveConstEnums&quot;: true,                       /* Disable erasing &#x27;const enum&#x27; declarations in generated code. */</span><br>  <span class="hljs-comment">// &quot;declarationDir&quot;: &quot;./&quot;,                           /* Specify the output directory for generated declaration files. */</span><br>  <span class="hljs-comment">// &quot;preserveValueImports&quot;: true,                     /* Preserve unused imported values in the JavaScript output that would otherwise be removed. */</span><br><br>  <span class="hljs-comment">/* Interop Constraints */</span><br>  <span class="hljs-string">&quot;isolatedModules&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Ensure that each file can be safely transpiled without relying on other imports. */</span>,<br>  <span class="hljs-comment">// &quot;verbatimModuleSyntax&quot;: true,                     /* Do not transform or elide any imports or exports not marked as type-only, ensuring they are written in the output file&#x27;s format based on the &#x27;module&#x27; setting. */</span><br>  <span class="hljs-string">&quot;allowSyntheticDefaultImports&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Allow &#x27;import x from y&#x27; when a module doesn&#x27;t have a default export. */</span>,<br>  <span class="hljs-string">&quot;esModuleInterop&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Emit additional JavaScript to ease support for importing CommonJS modules. This enables &#x27;allowSyntheticDefaultImports&#x27; for type compatibility. */</span>,<br>  <span class="hljs-comment">// &quot;preserveSymlinks&quot;: true,                         /* Disable resolving symlinks to their realpath. This correlates to the same flag in node. */</span><br>  <span class="hljs-string">&quot;forceConsistentCasingInFileNames&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Ensure that casing is correct in imports. */</span>,<br><br>  <span class="hljs-comment">/* Type Checking */</span><br>  <span class="hljs-string">&quot;strict&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Enable all strict type-checking options. */</span>,<br>  <span class="hljs-comment">// &quot;noImplicitAny&quot;: true,                            /* Enable error reporting for expressions and declarations with an implied &#x27;any&#x27; type. */</span><br>  <span class="hljs-comment">// &quot;strictNullChecks&quot;: true,                         /* When type checking, take into account &#x27;null&#x27; and &#x27;undefined&#x27;. */</span><br>  <span class="hljs-comment">// &quot;strictFunctionTypes&quot;: true,                      /* When assigning functions, check to ensure parameters and the return values are subtype-compatible. */</span><br>  <span class="hljs-comment">// &quot;strictBindCallApply&quot;: true,                      /* Check that the arguments for &#x27;bind&#x27;, &#x27;call&#x27;, and &#x27;apply&#x27; methods match the original function. */</span><br>  <span class="hljs-comment">// &quot;strictPropertyInitialization&quot;: true,             /* Check for class properties that are declared but not set in the constructor. */</span><br>  <span class="hljs-comment">// &quot;noImplicitThis&quot;: true,                           /* Enable error reporting when &#x27;this&#x27; is given the type &#x27;any&#x27;. */</span><br>  <span class="hljs-comment">// &quot;useUnknownInCatchVariables&quot;: true,               /* Default catch clause variables as &#x27;unknown&#x27; instead of &#x27;any&#x27;. */</span><br>  <span class="hljs-comment">// &quot;alwaysStrict&quot;: true,                             /* Ensure &#x27;use strict&#x27; is always emitted. */</span><br>  <span class="hljs-comment">// &quot;noUnusedLocals&quot;: true,                           /* Enable error reporting when local variables aren&#x27;t read. */</span><br>  <span class="hljs-comment">// &quot;noUnusedParameters&quot;: true,                       /* Raise an error when a function parameter isn&#x27;t read. */</span><br>  <span class="hljs-comment">// &quot;exactOptionalPropertyTypes&quot;: true,               /* Interpret optional property types as written, rather than adding &#x27;undefined&#x27;. */</span><br>  <span class="hljs-comment">// &quot;noImplicitReturns&quot;: true,                        /* Enable error reporting for codepaths that do not explicitly return in a function. */</span><br>  <span class="hljs-comment">// &quot;noFallthroughCasesInSwitch&quot;: true,               /* Enable error reporting for fallthrough cases in switch statements. */</span><br>  <span class="hljs-comment">// &quot;noUncheckedIndexedAccess&quot;: true,                 /* Add &#x27;undefined&#x27; to a type when accessed using an index. */</span><br>  <span class="hljs-comment">// &quot;noImplicitOverride&quot;: true,                       /* Ensure overriding members in derived classes are marked with an override modifier. */</span><br>  <span class="hljs-comment">// &quot;noPropertyAccessFromIndexSignature&quot;: true,       /* Enforces using indexed accessors for keys declared using an indexed type. */</span><br>  <span class="hljs-comment">// &quot;allowUnusedLabels&quot;: true,                        /* Disable error reporting for unused labels. */</span><br>  <span class="hljs-comment">// &quot;allowUnreachableCode&quot;: true,                     /* Disable error reporting for unreachable code. */</span><br><br>  <span class="hljs-comment">/* Completeness */</span><br>  <span class="hljs-comment">// &quot;skipDefaultLibCheck&quot;: true,                      /* Skip type checking .d.ts files that are included with TypeScript. */</span><br>  <span class="hljs-string">&quot;skipLibCheck&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">/* Skip type checking all .d.ts files. */</span><br> &#125;,<br> <span class="hljs-string">&quot;include&quot;</span>: [<span class="hljs-string">&quot;./src/**/*&quot;</span>],<br> <span class="hljs-string">&quot;exclude&quot;</span>: [<span class="hljs-string">&quot;node_modules&quot;</span>, <span class="hljs-string">&quot;dist&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="react-master-项目配置"><a href="#react-master-项目配置" class="headerlink" title="react-master 项目配置"></a>react-master 项目配置</h3><p>react-master 将作为 react 项目</p>
<h4 id="删除-新建一些东西"><a href="#删除-新建一些东西" class="headerlink" title="删除&#x2F;新建一些东西"></a>删除&#x2F;新建一些东西</h4><ol start="21">
<li>react-master 目录下，删除 index.js</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">rm index.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="22">
<li>react-master 目录下，删除 package.json 下多余的 <code>dependencies</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm remove lodash react-test-utils<br></code></pre></td></tr></table></figure>

<ol start="23">
<li>react-master 目录下，创建<code>src</code>与<code>index.tsx</code>：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src &amp;&amp; touch src/index.<span class="hljs-property">tsx</span><br></code></pre></td></tr></table></figure>

<h4 id="安装-Webpack、babel-等一系列环境"><a href="#安装-Webpack、babel-等一系列环境" class="headerlink" title="安装 Webpack、babel 等一系列环境"></a>安装 Webpack、babel 等一系列环境</h4><ol start="24">
<li>react-master 目录下，运行安装命令：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add webpack webpack-cli webpack-merge webpack-dev-server @babel/core @babel/preset-react @babel/preset-env @babel/preset-typescript babel-loader css-loader style-loader less less-loader postcss postcss-loader tailwindcss autoprefixer html-webpack-plugin css-minimizer-webpack-plugin terser-webpack-plugin mini-css-extract-plugin cross-env -D<br></code></pre></td></tr></table></figure>

<blockquote>
<p>安装的包归类：</p>
</blockquote>
<blockquote>
<p>1、webpack 类：webpack webpack-cli webpack-merge webpack-dev-server<br>2、babel 类：babel-loader 依赖 @babel&#x2F;core；解析 React 则要安装 @babel&#x2F;preset-react；解析 TS 则安装 @babel&#x2F;preset-typescript ；解析环境则安装 @babel&#x2F;preset-env<br>3、css 编译器：css-loader style-loader less less-loader<br>4、postcss postcss-loader<br>5、tailwindcss autoprefixer<br>6、html-webpack-plugin<br>7、css-minimizer-webpack-plugin terser-webpack-plugin mini-css-extract-plugin<br>8、cross-env</p>
</blockquote>
<p><strong>通义千问的详细解释：</strong></p>
<blockquote>
<p>以下是这些 NPM 包的功能和用途的简要归类解释：</p>
<ol>
<li><strong>pnpm</strong>:</li>
</ol>
<ul>
<li>pnpm 是一个高效的 JavaScript 包管理器，采用了硬链接和内容寻址存储的方式来优化磁盘空间和缓存性能，特别适合在大型项目和 Monorepo 中使用。</li>
</ul>
<ol start="2">
<li><strong>webpack</strong>:</li>
</ol>
<ul>
<li>webpack 是一款流行的模块打包工具，负责将项目中的 JavaScript、CSS、图片等资源组织在一起，通过 loaders 和 plugins 处理和转换源文件，最终生成优化过的 bundle 文件。</li>
</ul>
<ol start="3">
<li><strong>webpack-cli</strong>:</li>
</ol>
<ul>
<li>webpack-cli 是 webpack 的命令行接口，提供了一系列命令用于与 webpack 交互，执行构建、配置、打包等任务。</li>
</ul>
<ol start="4">
<li><strong>webpack-merge</strong>:</li>
</ol>
<ul>
<li>webpack-merge 是一个用于合并 webpack 配置对象的工具，便于在不同环境（如开发、生产）间共享基础配置并叠加特定环境的配置。</li>
</ul>
<ol start="5">
<li><strong>webpack-dev-server</strong>:</li>
</ol>
<ul>
<li>webpack-dev-server 是一个小型的静态文件服务器，配合 webpack 使用，可以实现热模块替换(HMR)、自动刷新等功能，用于快速开发调试。</li>
</ul>
<ol start="6">
<li><strong>@babel&#x2F;core</strong>:</li>
</ol>
<ul>
<li>Babel 核心包，用于转译 JavaScript 代码，支持 ES6+、JSX 等新的语言特性转换为旧版本 JavaScript。</li>
</ul>
<ol start="7">
<li><strong>@babel&#x2F;preset-react</strong>:</li>
</ol>
<ul>
<li>Babel 预设，用于将 React 的 JSX 语法转换为标准的 JavaScript。</li>
</ul>
<ol start="8">
<li><strong>@babel&#x2F;preset-env</strong>:</li>
</ol>
<ul>
<li>Babel 预设，根据目标环境自动应用兼容性 polyfill 和转换，使新版本 JavaScript 代码能在老版本浏览器运行。</li>
</ul>
<ol start="9">
<li><strong>@babel&#x2F;preset-typescript</strong>:</li>
</ol>
<ul>
<li>Babel 预设，用于编译 TypeScript 代码为 JavaScript。</li>
</ul>
<ol start="10">
<li><strong>babel-loader</strong>:</li>
</ol>
<ul>
<li>webpack 加载器，用于配合 Babel 将源代码通过 Babel 转换后再传递给 webpack 进行打包。</li>
</ul>
<ol start="11">
<li><strong>css-loader</strong>:</li>
</ol>
<ul>
<li>webpack 加载器，用于处理 CSS 文件，支持导入和导出 CSS 语句。</li>
</ul>
<ol start="12">
<li><strong>style-loader</strong>:</li>
</ol>
<ul>
<li>webpack 加载器，将 CSS 代码插入到 JavaScript 中，通过动态样式标签注入到 DOM 中，实现 CSS 的实时加载。</li>
</ul>
<ol start="13">
<li><strong>less</strong>:</li>
</ol>
<ul>
<li>Less 是一种 CSS 预处理器，提供变量、嵌套、混合等高级功能。</li>
</ul>
<ol start="14">
<li><strong>less-loader</strong>:</li>
</ol>
<ul>
<li>webpack 加载器，用于将 Less 文件编译成 CSS。</li>
</ul>
<ol start="15">
<li><strong>postcss</strong>:</li>
</ol>
<ul>
<li>PostCSS 是一个 CSS 处理工具，支持一系列插件对 CSS 进行扩展和转换。</li>
</ul>
<ol start="16">
<li><strong>postcss-loader</strong>:</li>
</ol>
<ul>
<li>webpack 加载器，用于在 webpack 流程中运行 PostCSS。</li>
</ul>
<ol start="17">
<li><strong>tailwindcss</strong>:</li>
</ol>
<ul>
<li>一个实用的 CSS 框架，提供了一整套原子级实用类，用于快速构建自定义响应式界面。</li>
</ul>
<ol start="18">
<li><strong>autoprefixer</strong>:</li>
</ol>
<ul>
<li>PostCSS 的一个插件，自动为 CSS 添加 vendor 前缀，确保跨浏览器兼容性。</li>
</ul>
<ol start="19">
<li><strong>html-webpack-plugin</strong>:</li>
</ol>
<ul>
<li>生成 HTML 文件并自动引入打包后的 JavaScript 和 CSS 文件。</li>
</ul>
<ol start="20">
<li><strong>css-minimizer-webpack-plugin</strong>:</li>
</ol>
<ul>
<li>用于压缩输出的 CSS 文件，减少文件大小。</li>
</ul>
<ol start="21">
<li><strong>terser-webpack-plugin</strong>:</li>
</ol>
<ul>
<li>用于压缩 JavaScript 文件，是一个替代 UglifyJS 的 webpack 插件，提供了更好的 ES6+ 代码压缩能力。</li>
</ul>
<ol start="22">
<li><strong>mini-css-extract-plugin</strong>:</li>
</ol>
<ul>
<li>从 JavaScript 文件中提取 CSS 代码到单独的 CSS 文件中，有利于 CSS 文件的缓存和分离样式与脚本。</li>
</ul>
<ol start="23">
<li><strong>cross-env</strong>:</li>
</ol>
<ul>
<li>设置跨平台的环境变量，使得在 Windows、Unix 等不同操作系统上的环境变量设置变得简单。</li>
</ul>
</blockquote>
<h4 id="安装-React-相关"><a href="#安装-React-相关" class="headerlink" title="安装 React 相关"></a>安装 React 相关</h4><ol start="25">
<li>react-master 目录下，运行安装命令：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add react react-dom react-router-dom @types/react @types/react-dom @types/react-router-dom<br></code></pre></td></tr></table></figure>

<h4 id="带来的思考：前端的方案"><a href="#带来的思考：前端的方案" class="headerlink" title="带来的思考：前端的方案"></a>带来的思考：前端的方案</h4><p>刚刚进行了<code>react-master</code>项目的配置，那从中可以思考下：前端的方案有哪些？</p>
<h5 id="构建方案"><a href="#构建方案" class="headerlink" title="构建方案"></a>构建方案</h5><p>构建关键词：bundle、chunk、module、channel</p>
<p><strong>module：</strong>构建的基本单元，从构建角度来说任何文件(.js&#x2F;.css&#x2F;.json 等)都是一个 Module，基于模块构建依赖关系<br><strong>chunk：</strong>一般指中间产物，代表一组模块的集合，会根据模块的依赖关系生成 chunks。chunks 之后会被打进一个&#x2F;多个 bundle 里面。比如通过代码分割（code splitting）功能来创建按需加载的代码块，会形成一个 chunks<br><strong>bundle：</strong>一般指最终产物，比如：mian.xxx.js，它可能是把所有文件(js&#x2F;css&#x2F;图片等)合在一起形成的，浏览器可以直接加载它来运行应用程序<br><strong>channel：</strong>一般跟 uri 挂钩，代表唯一的地址。</p>
<p>常用方案有：Bundled 与 Bundleless<br><strong>Bundled</strong>：打包的最终产物为一个 js，典型工具：Webpack、Rollup<br><strong>Bundleless</strong>：几乎不打包，利用 ESM 进行加载使用，典型工具：Vite、Snowpack</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> $ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;jquery&#x27;</span><br></code></pre></td></tr></table></figure>

<p>工具&#x2F;组件库还希望产物有目录结构，比如下面这种结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Button</span><br>  -index.<span class="hljs-property">js</span><br>  -index.<span class="hljs-property">css</span><br><span class="hljs-title class_">Card</span><br>  -index.<span class="hljs-property">js</span><br>  -index.<span class="hljs-property">css</span><br></code></pre></td></tr></table></figure>

<p>实际使用：<br>业务项目，采用 Webpack，构建 bundle 方案<br>组件库，采用 Rollup + 多入口，构建 bundleless 方案</p>
<h5 id="CSS-方案"><a href="#CSS-方案" class="headerlink" title="CSS 方案"></a>CSS 方案</h5><blockquote>
<p>比如：css 如何隔离的？</p>
</blockquote>
<h6 id="css-in-js-方案"><a href="#css-in-js-方案" class="headerlink" title="css in js 方案"></a>css in js 方案</h6><p>有个库：<a target="_blank" rel="noopener" href="https://emotion.sh/docs/introduction">@emotion</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; css &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@emotion&#x27;</span><br><br><span class="hljs-keyword">const</span> color = <span class="hljs-string">&#x27;white&#x27;</span><br><br><span class="hljs-title function_">render</span>(<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">css</span>`</span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">padding:</span> <span class="hljs-attr">32px</span>;</span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">margin-left:</span> <span class="hljs-attr">10px</span>;</span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">font-size:</span> <span class="hljs-attr">12px</span>;</span></span><br><span class="hljs-tag"><span class="language-xml">    `</span></span><br><span class="hljs-tag"><span class="language-xml">  &#125;&gt;</span></span><br><span class="language-xml">    hello world!</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>)<br></code></pre></td></tr></table></figure>

<h6 id="styled-component-方案"><a href="#styled-component-方案" class="headerlink" title="styled-component 方案"></a>styled-component 方案</h6><p>本质还是 css in js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> styled <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;styled-components&#x27;</span>;<br><br><span class="hljs-comment">// 定义一个简单的样式组件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Button</span> = styled.<span class="hljs-property">button</span><span class="hljs-string">`</span><br><span class="hljs-string">  background-color: <span class="hljs-subst">$&#123;props =&gt; props.primary ? <span class="hljs-string">&#x27;blue&#x27;</span> : <span class="hljs-string">&#x27;grey&#x27;</span>&#125;</span>;</span><br><span class="hljs-string">  color: white;</span><br><span class="hljs-string">  font-size: 1em;</span><br><span class="hljs-string">  padding: 0.5em 1em;</span><br><span class="hljs-string">  border: none;</span><br><span class="hljs-string">  border-radius: 3px;</span><br><span class="hljs-string">`</span>;<br><br><span class="hljs-comment">// 在 React 组件中使用</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">primary</span>=<span class="hljs-string">&#123;true&#125;</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h6 id="css-module-方案"><a href="#css-module-方案" class="headerlink" title="css module 方案"></a>css module 方案</h6><p>通过 Webpack 的 css-loader 配置，在编译阶段转换 CSS 类名，将其变为唯一的、局部作用域的类名。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">/* styles.module.css */</span><br>.<span class="hljs-property">title</span> &#123;<br>  <span class="hljs-attr">color</span>: silver;<br>&#125;<br><br>.<span class="hljs-property">description</span> &#123;<br>  <span class="hljs-attr">composes</span>: baseText <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./base.module.css&#x27;</span>;<br>  font-<span class="hljs-attr">size</span>: 14px;<br>&#125;<br><br><span class="hljs-comment">/* base.module.css */</span><br>:<span class="hljs-keyword">export</span> &#123;<br>  <span class="hljs-attr">baseText</span>: base-text;<br>&#125;<br><br>.<span class="hljs-property">base</span>-text &#123;<br>  <span class="hljs-attr">color</span>: black;<br>  font-<span class="hljs-attr">family</span>: <span class="hljs-title class_">Arial</span>, sans-serif;<br>&#125;<br><br><span class="hljs-comment">// Component.js</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./styles.module.css&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;styles.title&#125;</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;styles.description&#125;</span>&gt;</span>Description text<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>bem 规范：block-element_modifier css 命名规范化<br>block：块，功能的抽象，比如 .nav、.search<br>element：元素，块里面的实际元素，比如 .nav__item、.search__card<br>modifier：修饰符，表示状态、类型、外观的变化，比如 .nav__item–actived、.search__card–disabled</p>
</blockquote>
<h6 id="utility-css-方案"><a href="#utility-css-方案" class="headerlink" title="utility-css 方案"></a>utility-css 方案</h6><p>提供原子化类名，灵活、可复用、易于定制。（写多了就能记住了）<br>代表库：tailwindcss、windicss</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;flex flex-row items-center justify-between bg-gray-200 rounded-lg&quot;</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-xl font-bold&quot;</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span>&gt;</span>Button<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<h5 id="组件库方案"><a href="#组件库方案" class="headerlink" title="组件库方案"></a>组件库方案</h5><blockquote>
<p>一般用第三方组件库</p>
</blockquote>
<p>headless 组件库 vs styled 组件库<br>headless 组件库：只提供交互，样式完全自己写，适合公司内无设计规范并且和第三方组件库样式差别大的情况<br>styled 组件库：提供交互与样式，特殊样式需要自己去覆盖，适合有设计规范并且和第三方组件库样式差别不大</p>
<p>实际场景：公司设计与主流组件库差别大，可以选 headless ui + tailwindcss + css module</p>
<h5 id="状态方案"><a href="#状态方案" class="headerlink" title="状态方案"></a>状态方案</h5><p>Zustand、Solid、Redux、mobx</p>
<h5 id="微前端方案"><a href="#微前端方案" class="headerlink" title="微前端方案"></a>微前端方案</h5><p>iframe、Web Components、Module Federation(模块联邦)<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/WRxonsnQvA11V0zK2znyVw">微前端时代：打造高效、灵活的前端开发体系</a></p>
<h4 id="安装-headless-ui、图标库"><a href="#安装-headless-ui、图标库" class="headerlink" title="安装 headless ui、图标库"></a>安装 headless ui、图标库</h4><ol start="26">
<li>安装 headless ui、图标库</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add @headlessui/react @heroicons/react<br></code></pre></td></tr></table></figure>

<h4 id="手动配置-Webpack"><a href="#手动配置-Webpack" class="headerlink" title="手动配置 Webpack"></a>手动配置 Webpack</h4><p>我们会配置三个：<br>webpack.base.js：基础配置<br>webpack.dev.js：基于 webpack.base.js，处理开发环境配置<br>webpack.prod.js：基于 webpack.base.js，处理生产环境配置</p>
<ol start="27">
<li>react-master 目录下，创建这三个文件</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">mkdir scripts &amp;&amp; touch scripts/webpack.<span class="hljs-property">dev</span>.<span class="hljs-property">js</span> &amp;&amp; touch scripts/webpack.<span class="hljs-property">prod</span>.<span class="hljs-property">js</span> &amp;&amp; touch scripts/webpack.<span class="hljs-property">base</span>.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="28">
<li>更改 package.json，加上 build、start 命令</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;react-master&quot;</span>,<br>  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;1.0.0&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;index.js&quot;</span>,<br>  <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,<br>    <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;webpack --config scripts/webpack.prod.js&quot;</span>, <span class="hljs-comment">// +++++++</span><br>    <span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-string">&quot;webpack-dev-server --config scripts/webpack.dev.js&quot;</span> <span class="hljs-comment">// +++++++</span><br>  &#125;,<br>  ...<br>&#125;<br><br></code></pre></td></tr></table></figure>

<ol start="29">
<li>手写<code>webpack.base.js</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MiniCssExtractPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mini-css-extract-plugin&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;html-webpack-plugin&quot;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">isDev</span>) &#123;<br> <span class="hljs-keyword">return</span> &#123;<br>  <span class="hljs-comment">// 1、输入输出部分</span><br>  <span class="hljs-comment">// 输入，当你不知道是用 ./scr、../src、@/scr 时就使用 path 来处理，__dirname 当前目录</span><br>  <span class="hljs-attr">entry</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../src/index.tsx&quot;</span>),<br>  <span class="hljs-comment">// 输出</span><br>  <span class="hljs-attr">output</span>: &#123;<br>   <span class="hljs-comment">// 打包后文件的位置</span><br>   <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../dist&quot;</span>),<br>   <span class="hljs-comment">// 打包后 js 的名字，采用了占位符，[name] 代表入口文件的名字，[hash:8] 代表打包后文件的 hash 值，取前 8 位</span><br>   <span class="hljs-comment">// hash 每次打包后根据内容生成 hash 值（任一文件有变动则 hash 会变，颗粒度最大）</span><br>   <span class="hljs-comment">// contenthash 每次打包后根据内容生成 hash 值（当输出内容变化则 hash 会变，颗粒度最小）</span><br>   <span class="hljs-comment">// chunkhash 每次打包后根据 chunk 生成 hash 值（当代码块变化则 hash 会变，颗粒度居中）</span><br>   <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;static/js/[name]/[hash:8].js&quot;</span>,<br><br>   <span class="hljs-comment">// webpack 5 内置的，构建前清空 dist 目录</span><br>   <span class="hljs-comment">// webpack 4 没有，需安装 clean-webpack-plugin</span><br>   <span class="hljs-attr">clean</span>: <span class="hljs-literal">true</span>,<br><br>   <span class="hljs-comment">// 打包后静态资源的位置，相对于 output.path</span><br>   <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>  &#125;,<br><br>  <span class="hljs-comment">// 2、resolve 部分</span><br>  <span class="hljs-attr">resolve</span>: &#123;<br>   <span class="hljs-comment">// 用于在引入文件时，不需要写后缀名</span><br>   <span class="hljs-attr">extensions</span>: [<span class="hljs-string">&quot;.tsx&quot;</span>, <span class="hljs-string">&quot;.ts&quot;</span>, <span class="hljs-string">&quot;.jsx&quot;</span>, <span class="hljs-string">&quot;.js&quot;</span>], <span class="hljs-comment">// 优先级从左到右，会影响性能的</span><br>  &#125;,<br><br>  <span class="hljs-comment">// 3、loader 部分：</span><br>  <span class="hljs-attr">module</span>: &#123;<br>   <span class="hljs-comment">// loader 是 webpack 的核心，从入口文件起去解析 import from 的文件时，针对不同类型的文件进行不同处理</span><br>   <span class="hljs-comment">// 所以不同文件需要对应的解析器，去识别解析它，从而保证最后能形成一个 bundle</span><br>   <span class="hljs-attr">rules</span>: [<br>    &#123;<br>     <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(tsx|ts)$/</span>,<br>     <span class="hljs-attr">use</span>: &#123;<br>      <span class="hljs-comment">// 要使用 babel-loader 就需要有对应配置文件（.babelrc）</span><br>      <span class="hljs-attr">loader</span>: <span class="hljs-string">&quot;babel-loader&quot;</span>, <span class="hljs-comment">// 有了这个 loader，react 就已经可以跑起来了</span><br>     &#125;,<br>    &#125;,<br>    &#123;<br>     <span class="hljs-comment">// 为了避免三个 loader 重复处理，采用 oneOf 的实现匹配一个规则</span><br>     <span class="hljs-attr">oneOf</span>: [<br>      &#123;<br>       <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>, <span class="hljs-comment">// 匹配 css 文件</span><br>       <span class="hljs-attr">use</span>: [<br>        <span class="hljs-comment">// style-loader 用于将 css 放到元素内联样式上</span><br>        <span class="hljs-comment">// dev 环境使用 style-loader，方便热更新替换</span><br>        <span class="hljs-comment">// 生产环境使用 MiniCssExtractPlugin.loader 单独提取成 css 文件，方便缓存，还需要在下面的 plugin 中配置</span><br>        isDev ? <span class="hljs-string">&quot;style-loader&quot;</span> : <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>,<br>        <span class="hljs-string">&quot;css-loader&quot;</span>, <span class="hljs-comment">// 主要处理路径，给&lt;link&gt; 用</span><br>        <span class="hljs-string">&quot;postcss-loader&quot;</span>, <span class="hljs-comment">// 处理语法转换，postcss 就是 css 界的 babel，需要有对应配置文件（.postcssrc.js）</span><br>       ],<br>      &#125;,<br>      <span class="hljs-comment">// 定义规则：针对模块化的 css，统一采用 .module.css|.less 形式命名文件</span><br>      &#123;<br>       <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.module\.(css|less)$/</span>,<br>       <span class="hljs-attr">include</span>: [path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../src&quot;</span>)], <span class="hljs-comment">// 指定生效的目录</span><br>       <span class="hljs-attr">use</span>: [<br>        isDev ? <span class="hljs-string">&quot;style-loader&quot;</span> : <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>,<br>        &#123;<br>         <span class="hljs-comment">// 配置 css-loader 的 modules 模式</span><br>         <span class="hljs-attr">loader</span>: <span class="hljs-string">&quot;css-loader&quot;</span>,<br>         <span class="hljs-attr">options</span>: &#123;<br>          <span class="hljs-attr">modules</span>: &#123;<br>           <span class="hljs-comment">// 借用 css-module 实现我们的 BEM 命名规范</span><br><br>           <span class="hljs-comment">// localIdentName：会将 class 名替换成 [path][name]__[local]--[hash:base64:5]</span><br>           <span class="hljs-attr">localIdentName</span>: <span class="hljs-string">&quot;[path][name]__[local]--[hash:base64:5]&quot;</span>,<br>          &#125;,<br>         &#125;,<br>        &#125;,<br>        <span class="hljs-string">&quot;postcss-loader&quot;</span>,<br>        <span class="hljs-string">&quot;less-loader&quot;</span>,<br>       ],<br>      &#125;,<br>      &#123;<br>       <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.less$/</span>, <span class="hljs-comment">// 匹配 less 文件</span><br>       <span class="hljs-attr">use</span>: [<br>        isDev ? <span class="hljs-string">&quot;style-loader&quot;</span> : <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>,<br>        <span class="hljs-string">&quot;css-loader&quot;</span>,<br>        <span class="hljs-string">&quot;postcss-loader&quot;</span>,<br>        <span class="hljs-string">&quot;less-loader&quot;</span>,<br>       ],<br>      &#125;,<br>     ],<br>    &#125;,<br><br>    <span class="hljs-comment">// webpack5 以前要单独的 loader(file|url 等)，webpack5 已经内置了</span><br>    &#123;<br>     <span class="hljs-comment">// 图片处理</span><br>     <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(png|jpg|jpeg|gif|svg)$/</span>,<br>     <span class="hljs-attr">generator</span>: &#123;<br>      <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;static/images/[name].[contenthash:8][ext]&quot;</span>,<br>     &#125;,<br>    &#125;,<br>    &#123;<br>     <span class="hljs-comment">// 字体处理</span><br>     <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(woff2?|eot|ttf|otf)$/</span>,<br>     <span class="hljs-attr">generator</span>: &#123;<br>      <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;static/fonts/[name].[contenthash:8][ext]&quot;</span>,<br>     &#125;,<br>    &#125;,<br>    &#123;<br>     <span class="hljs-comment">// 音视频处理</span><br>     <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(mp4|map3|flv|wav)$/</span>,<br>     <span class="hljs-attr">generator</span>: &#123;<br>      <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;static/media/[name].[contenthash:8][ext]&quot;</span>,<br>     &#125;,<br>    &#125;,<br>   ],<br>  &#125;,<br><br>  <span class="hljs-attr">plugins</span>: [<br>   <span class="hljs-comment">// HtmlWebpackPlugin：将打包后的 js、css 注入到 html 文件中</span><br>   <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>    <span class="hljs-comment">// 指定模板文件位置</span><br>    <span class="hljs-attr">template</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../public/index.html&quot;</span>),<br>    <span class="hljs-comment">// 自动注入打包后的 js、css 文件</span><br>    <span class="hljs-attr">inject</span>: <span class="hljs-literal">true</span>,<br>   &#125;),<br><br>   <span class="hljs-comment">// 由于生产环境使用 MiniCssExtractPlugin.loader 单独提取成 css 文件，所以需要加对应的 plugin 配置</span><br>   <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>(&#123;<br>    <span class="hljs-comment">// 提取后的文件名 开发环境文件名不带 hash，生产环境文件名带 hash</span><br>    <span class="hljs-attr">filename</span>: isDev<br>     ? <span class="hljs-string">&quot;static/css/[name].css&quot;</span><br>     : <span class="hljs-string">&quot;static/css/[name].[contenthash:4].css&quot;</span>,<br>   &#125;),<br>  ],<br> &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="30">
<li>手动配置<code>babel</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx">touch .<span class="hljs-property">babelrc</span><br><br><span class="hljs-comment">// 并写入如下内容：</span><br>&#123;<br> <span class="hljs-string">&quot;presets&quot;</span>: [<br>  <span class="hljs-string">&quot;@babel/preset-react&quot;</span>, <span class="hljs-comment">// 解析 react</span><br>  <span class="hljs-string">&quot;@babel/preset-typescript&quot;</span> <span class="hljs-comment">// 解析 typescript</span><br> ]<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="31">
<li>手动配置<code>postcss</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx">touch .<span class="hljs-property">postcssrc</span>.<span class="hljs-property">js</span><br><br><span class="hljs-comment">// 并写入如下内容：</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br> <span class="hljs-attr">plugins</span>: [<br>  <span class="hljs-string">&quot;autoprefixer&quot;</span>, <span class="hljs-comment">// 自动添加浏览器前缀</span><br>  <span class="hljs-string">&quot;tailwindcss&quot;</span>,<br> ],<br>&#125;;<br><br></code></pre></td></tr></table></figure>

<ol start="32">
<li>手写<code>public/index.html</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx">mkdir public &amp;&amp; touch public/index.<span class="hljs-property">html</span><br><br><span class="hljs-comment">// 并写入如下内容：</span><br>&lt;!doctype html&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>React Master<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br><br></code></pre></td></tr></table></figure>

<ol start="32">
<li>手写<code>webpack.prod.js</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> &#123; merge &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack-merge&quot;</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">CssMinimizerPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;css-minimizer-webpack-plugin&quot;</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">TerserPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;terser-webpack-plugin&quot;</span>);<br><br><span class="hljs-keyword">const</span> baseConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./webpack.base&quot;</span>);<br><br><span class="hljs-comment">// 基于 webpack 的官方 merge 方法，将 baseConfig 和 prodConfig 合并</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">merge</span>(<span class="hljs-title function_">baseConfig</span>(), &#123;<br> <span class="hljs-comment">// 生产环境配置</span><br><br> <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;production&quot;</span>,<br><br> <span class="hljs-comment">// 优化配置</span><br> <span class="hljs-attr">optimization</span>: &#123;<br>  <span class="hljs-attr">minimizer</span>: [<br>   <span class="hljs-comment">// 压缩 css</span><br>   <span class="hljs-keyword">new</span> <span class="hljs-title class_">CssMinimizerPlugin</span>(),<br><br>   <span class="hljs-comment">// 压缩 js</span><br>   <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>(&#123;<br>    <span class="hljs-comment">// 开启多进程并行运行</span><br>    <span class="hljs-attr">parallel</span>: <span class="hljs-literal">true</span>,<br><br>    <span class="hljs-comment">// 压缩参数</span><br>    <span class="hljs-attr">terserOptions</span>: &#123;<br>     <span class="hljs-comment">// 开启压缩</span><br>     <span class="hljs-attr">compress</span>: &#123;<br>      <span class="hljs-attr">pure_funcs</span>: [<span class="hljs-string">&quot;console.log&quot;</span>, <span class="hljs-string">&quot;console.warn&quot;</span>], <span class="hljs-comment">// 移除 console</span><br>     &#125;,<br>    &#125;,<br>   &#125;),<br>  ],<br><br>  <span class="hljs-comment">// 代码分割配置(拆包)</span><br>  <span class="hljs-attr">splitChunks</span>: &#123;<br>   <span class="hljs-comment">// 缓存组</span><br>   <span class="hljs-attr">cacheGroups</span>: &#123;<br>    <span class="hljs-comment">// 第三方库: https://webpack.docschina.org/plugins/split-chunks-plugin/#splitchunkscachegroups</span><br>    <span class="hljs-attr">vendors</span>: &#123;<br>     <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;vendors&quot;</span>,<br>     <span class="hljs-attr">test</span>: <span class="hljs-regexp">/node_modules/</span>,<br>     <span class="hljs-comment">// 官方已经默认设置了比较合理的 minSize: 30000，minChunks: 1 等，所以我们不要额外去更改</span><br>    &#125;,<br>    <span class="hljs-comment">// 公共代码</span><br>    <span class="hljs-attr">commoms</span>: &#123;<br>     <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;commons&quot;</span>,<br>    &#125;,<br>   &#125;,<br>  &#125;,<br> &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>

<ol start="33">
<li>手撸入口页面，进入<code>react-master/src/index.tsx</code>，写如下代码</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDom</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./app&#x27;</span><br><br><span class="hljs-title class_">ReactDom</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;app&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Element</span>).<span class="hljs-title function_">render</span>(<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br>)<br></code></pre></td></tr></table></figure>

<ol start="34">
<li>创建<code>app.tsx</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsx">touch src/app.<span class="hljs-property">tsx</span><br><br><span class="hljs-comment">// 并写入如下内容：快捷键输入 tsrfc 回车</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;./app.css&quot;</span>;<br><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./app2.module.less&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">hello</span> $&#123;<span class="hljs-attr">styles.greenBGColor</span>&#125;`&#125;&gt;</span>App<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="35">
<li>创建<code>app.css</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx">touch src/app.<span class="hljs-property">css</span><br><br><span class="hljs-comment">// 并写入如下内容：</span><br>.<span class="hljs-property">hello</span> &#123;<br>  <span class="hljs-attr">color</span>: red<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="36">
<li>创建<code>app2.module.less</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx">touch src/app2.<span class="hljs-property">module</span>.<span class="hljs-property">less</span><br><br><span class="hljs-comment">// 并写入如下内容：</span><br>.<span class="hljs-property">greenBGColor</span> &#123;<br>    background-<span class="hljs-attr">color</span>: green;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="37">
<li>创建<code>golbal.d.ts</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx">touch src/golbal.<span class="hljs-property">d</span>.<span class="hljs-property">ts</span><br><br><span class="hljs-comment">// 并写入如下内容：</span><br>declare <span class="hljs-variable language_">module</span> <span class="hljs-string">&quot;*.module.less&quot;</span>;<br>declare <span class="hljs-variable language_">module</span> <span class="hljs-string">&quot;*.module.css&quot;</span>;<br></code></pre></td></tr></table></figure>

<ol start="38">
<li>运行打包</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">pnpm build<br></code></pre></td></tr></table></figure>

<ol start="39">
<li>打包成功后，可以看到对应的<code>dist</code>文件，然后在 dist&#x2F;index.html 里面改下路径</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;script defer=<span class="hljs-string">&quot;defer&quot;</span> src=<span class="hljs-string">&quot;/static/js/main/8aa22f5b.js&quot;</span>&gt;&lt;/script&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/static/css/main.2609.css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> /&gt;</span></span><br><br><span class="hljs-comment">// 改为这个，多加一个 .</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span>=<span class="hljs-string">&quot;defer&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./static/js/main/8aa22f5b.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./static/css/main.2609.css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>

<ol start="40">
<li>然后用浏览器打开<code>dist/index.html</code>，就能看到页面正常渲染了<img src="/img/images/2024/1709865374724-3308e724-6153-4659-9a14-4ad9a481217d.png" srcset="/img/loading.gif" lazyload></li>
<li>手写<code>webpack.dev.js</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> &#123; merge &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack-merge&quot;</span>);<br><br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><br><span class="hljs-keyword">const</span> baseConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./webpack.base&quot;</span>);<br><br><span class="hljs-comment">// 基于 webpack 的官方 merge 方法，将 baseConfig 和 devConfig 合并</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">merge</span>(<span class="hljs-title function_">baseConfig</span>(<span class="hljs-literal">true</span>), &#123;<br> <span class="hljs-comment">// 开发环境配置</span><br><br> <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;development&quot;</span>,<br><br> <span class="hljs-comment">// 源码调试：使用 source-map</span><br> <span class="hljs-attr">devtool</span>: <span class="hljs-string">&quot;eval-cheap-module-source-map&quot;</span>,<br><br> <span class="hljs-comment">// 开发服务器配置</span><br> <span class="hljs-attr">devServer</span>: &#123;<br>  <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>,<br>  <span class="hljs-attr">compress</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 关闭压缩，这样热更新会更快</span><br>  <span class="hljs-attr">hot</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启热更新</span><br>  <span class="hljs-attr">historyApiFallback</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 解决开发环境 history 路由 404 的问题</span><br>  <span class="hljs-attr">static</span>: &#123;<br>   <span class="hljs-comment">// 托管静态资源 public 文件夹</span><br>   <span class="hljs-attr">directory</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../public&quot;</span>),<br>  &#125;,<br> &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>

<ol start="42">
<li>本地启动运行</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">pnpm start<br></code></pre></td></tr></table></figure>

<p><img src="/img/images/2024/1709864722122-5ee6c7a8-c04c-4c5a-9164-26735da0450a.png" srcset="/img/loading.gif" lazyload></p>
<ol start="43">
<li>浏览器打开 <a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000/</a>，然后更改代码(背景色改为黄色)保存下，页面也会热更新<br><img src="/img/images/2024/1709865405750-f1cd65db-f37d-43d6-b7d1-c0bb3116ad30.png" srcset="/img/loading.gif" lazyload></li>
</ol>
<h4 id="tailwindcss-配置"><a href="#tailwindcss-配置" class="headerlink" title="tailwindcss 配置"></a>tailwindcss 配置</h4><ol start="44">
<li>安装 vscode 插件，便于代码提示<br><img src="/img/images/2024/1709869629217-46034fbd-70fb-4a3b-bb46-578ce246b739.png" srcset="/img/loading.gif" lazyload></li>
<li>初始化，生成<code>tailwind.config.js</code>文件</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">npx tailwindcss init<br></code></pre></td></tr></table></figure>

<ol start="46">
<li>更改完善<code>tailwind.config.js</code>文件，改为如下：</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">/** <span class="hljs-doctag">@type</span> &#123;<span class="hljs-type">import(&#x27;tailwindcss&#x27;).Config</span>&#125; */</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br> <span class="hljs-attr">content</span>: [<span class="hljs-string">&quot;./src/**/*.&#123;tsx,ts,jsx,js&#125;&quot;</span>],<br> <span class="hljs-attr">theme</span>: &#123;<br>  <span class="hljs-attr">extend</span>: &#123;&#125;,<br> &#125;,<br> <span class="hljs-attr">plugins</span>: [],<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="47">
<li>新增<code>index.less</code>，并完善</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx">touch src/index.<span class="hljs-property">less</span><br><br><br><span class="hljs-comment">// 并写入如下内容：</span><br><br><span class="hljs-comment">// 全局的东西</span><br><br><span class="hljs-comment">// tailwind 配置</span><br>@tailwind base;<br>@tailwind components;<br>@tailwind utilities;<br></code></pre></td></tr></table></figure>

<ol start="48">
<li>在<code>index.tsx</code>引入<code>index.less</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom/client&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./app&quot;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;./index.less&quot;</span>; <span class="hljs-comment">// ++++++</span><br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;app&quot;</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Element</span>).<span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);<br></code></pre></td></tr></table></figure>

<ol start="49">
<li>在<code>app.tsx</code>使用一些原子 css</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;./app.css&quot;</span>;<br><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./app2.module.less&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">hello</span> $&#123;<span class="hljs-attr">styles.greenBGColor</span>&#125; <span class="hljs-attr">flex</span> <span class="hljs-attr">justify-center</span>`&#125;&gt;</span> // +++++</span><br><span class="language-xml">   App</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br><br></code></pre></td></tr></table></figure>

<ol start="50">
<li>重新 start 下，效果如下：<br><img src="/img/images/2024/1709865726372-95566a99-b37e-496f-84f4-78f29a90a305.png" srcset="/img/loading.gif" lazyload></li>
</ol>
<h1 id="2、项目开发"><a href="#2、项目开发" class="headerlink" title="2、项目开发"></a>2、项目开发</h1><p>当仓库搭建完毕后，并且<code>react-master</code>项目的基础配置搞完后，就要进行页面开发了<br>本次的项目开发目标是模仿<strong>知乎首页</strong><br><img src="/img/images/2024/1709868478433-2a9dfe87-1aec-45bd-a796-615b05f1f964.png" srcset="/img/loading.gif" lazyload><br>功能与技术点：顶部菜单、搜索、搜索历史、阅读全文、悬底操作、无限滚动、骨架屏等</p>
<h2 id="开发之前"><a href="#开发之前" class="headerlink" title="开发之前"></a>开发之前</h2><p>利其器之 VSCode 插件：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7218369118788649020">React vscode 开发插件与代码补全提示 - 掘金</a></p>
<ol start="51">
<li><code>react-master</code>内，新建文件夹</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src/pages src/components src/router src/utils<br></code></pre></td></tr></table></figure>

<h2 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h2><p>知乎路由结构：<br><img src="/img/images/2024/1709869004893-0b7ba799-79d9-4c6a-a6dd-1968183a79f4.png" srcset="/img/loading.gif" lazyload></p>
<ol start="52">
<li>新建<code>router/index.tsx</code>，并完善</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch router/index.<span class="hljs-property">tsx</span><br><br><span class="hljs-comment">// 并写如下代码：</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Outlet</span>, <span class="hljs-title class_">RouteObject</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><br><span class="hljs-comment">// 自己扩展的类型</span><br><span class="hljs-keyword">export</span> interface extraBizObject &#123;<br> title?: string;<br> isShow?: boolean; <span class="hljs-comment">// 是否显示</span><br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">router</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RouteObject</span> &amp; extraBizObject&gt; = [<br> <span class="hljs-comment">// https://www.zhihu.com/</span><br> &#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>  <span class="hljs-attr">element</span>: (<br>   <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex gap-4 text-blue-500 underline&quot;</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#education&quot;</span>&gt;</span>知乎知学堂<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#explore&quot;</span>&gt;</span>发现<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#question&quot;</span>&gt;</span>等你来答<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     首页自身内容</span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex gap-4 text-blue-500 underline&quot;</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#command&quot;</span>&gt;</span>command<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#follow&quot;</span>&gt;</span>follow<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#hot&quot;</span>&gt;</span>hot<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#zvideo&quot;</span>&gt;</span>zvideo<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      首页二级菜单内容</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  ),<br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;首页&quot;</span>,<br>  <span class="hljs-attr">isShow</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">children</span>: [<br>   &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>command<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>   &#125;,<br><br>   &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;follow&quot;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>follow<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>   &#125;,<br><br>   &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;hot&quot;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>hot<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>   &#125;,<br><br>   &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;zvideo&quot;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>zvideo<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>   &#125;,<br>  ],<br> &#125;,<br> <span class="hljs-comment">// https://www.zhihu.com/education/learning</span><br> &#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/education&quot;</span>,<br>  <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>education<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;知乎知学堂&quot;</span>,<br>  <span class="hljs-attr">children</span>: [<br>   &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;learning&quot;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>learning<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>   &#125;,<br>  ],<br> &#125;,<br><br> <span class="hljs-comment">// https://www.zhihu.com/explore</span><br> &#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/explore&quot;</span>,<br>  <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>explore<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;发现&quot;</span>,<br> &#125;,<br><br> <span class="hljs-comment">// https://www.zhihu.com/question/waiting</span><br> &#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/question&quot;</span>,<br>  <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>question<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;等你来答&quot;</span>,<br>  <span class="hljs-attr">children</span>: [<br>   &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;waiting&quot;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>waiting<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>   &#125;,<br>  ],<br> &#125;,<br>];<br></code></pre></td></tr></table></figure>

<ol start="53">
<li>改造<code>app.tsx</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">HashRouter</span>, useRoutes &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; router &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./router&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;<br> name?: string;<br>&#125;;<br><br><span class="hljs-comment">// 放在 App 外面，防止每次渲染都重新生成</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Routers</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">useRoutes</span>(router);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">HashRouter</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">Routers</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">HashRouter</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="54">
<li>删除多余的<code>app.css、app2.module.less</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">rm src/app.<span class="hljs-property">css</span> src/app2.<span class="hljs-property">module</span>.<span class="hljs-property">less</span><br></code></pre></td></tr></table></figure>

<ol start="55">
<li>启动项目：<code>pnpm start</code>，效果如下，点击可以已经可以跳转到对应页面了<br><img src="/img/images/2024/1709871900633-c34f6dcc-8fd2-42e3-a0dd-4b846888c6e1.png" srcset="/img/loading.gif" lazyload></li>
</ol>
<h2 id="首页初始化"><a href="#首页初始化" class="headerlink" title="首页初始化"></a>首页初始化</h2><ol start="56">
<li>新建 首页 相关文件，并迁移路由文件里面的代码完成初始化</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src/pages/home &amp;&amp; touch src/pages/home/index.<span class="hljs-property">tsx</span><br><br><span class="hljs-comment">// 并写如下代码（只是将 router/index.tsx 里面的 / 对应的 element 复制过来）：</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Outlet</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex gap-4 text-blue-500 underline&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#education&quot;</span>&gt;</span>知乎知学堂<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#explore&quot;</span>&gt;</span>发现<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#question&quot;</span>&gt;</span>等你来答<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    首页 page 自身内容</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex gap-4 text-blue-500 underline&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#command&quot;</span>&gt;</span>command<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#follow&quot;</span>&gt;</span>follow<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#hot&quot;</span>&gt;</span>hot<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#zvideo&quot;</span>&gt;</span>zvideo<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     首页二级菜单内容</span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="57">
<li>更改路由文件，将首页的 element 改一下（不贴代码了，看变动吧）</li>
</ol>
<p><img src="/img/images/2024/1709872388150-06eb5392-2f85-462a-9cb0-aac3ae0b1dc8.png" srcset="/img/loading.gif" lazyload></p>
<ol start="58">
<li>看浏览器，确保页面还是正常的</li>
</ol>
<h2 id="公共部分之导航栏开发"><a href="#公共部分之导航栏开发" class="headerlink" title="公共部分之导航栏开发"></a>公共部分之导航栏开发</h2><ol start="59">
<li>新建导航对应文件，并写代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src/components/navigation &amp;&amp; touch src/components/navigation/index.<span class="hljs-property">tsx</span><br><br><span class="hljs-comment">// 写如下代码：</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-variable constant_">FC</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ZHRouter</span>, router &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../router&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BellIcon</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@heroicons/react/24/outline&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NavLink</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Search</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../search&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Logo</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; px-2&quot;</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">svg</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">viewBox</span>=<span class="hljs-string">&quot;0 0 64 30&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">fill</span>=<span class="hljs-string">&quot;#1772F6&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;64&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;30&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;css-1hlrcxk&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">   &gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M29.05 4.582H16.733V25.94h3.018l.403 2.572 4.081-2.572h4.815V4.582zm-5.207 18.69l-2.396 1.509-.235-1.508h-1.724V7.233h6.78v16.04h-2.425zM14.46 14.191H9.982c0-.471.033-.954.039-1.458v-5.5h5.106V5.935a1.352 1.352 0 0 0-.404-.957 1.378 1.378 0 0 0-.968-.396H5.783c.028-.088.056-.177.084-.255.274-.82 1.153-3.326 1.153-3.326a4.262 4.262 0 0 0-2.413.698c-.57.4-.912.682-1.371 1.946-.532 1.453-.997 2.856-1.31 3.693C1.444 8.674.28 11.025.28 11.025a5.85 5.85 0 0 0 2.52-.61c1.119-.593 1.679-1.502 2.054-2.883l.09-.3h2.334v5.5c0 .5-.045.982-.073 1.46h-4.12c-.71 0-1.39.278-1.893.775a2.638 2.638 0 0 0-.783 1.874h6.527a17.717 17.717 0 0 1-.778 3.649 16.796 16.796 0 0 1-3.012 5.273A33.104 33.104 0 0 1 0 28.74s3.13 1.175 5.425-.954c1.388-1.292 2.631-3.814 3.23-5.727a28.09 28.09 0 0 0 1.12-5.229h5.967v-1.37a1.254 1.254 0 0 0-.373-.899 1.279 1.279 0 0 0-.909-.37z&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M11.27 19.675l-2.312 1.491 5.038 7.458a6.905 6.905 0 0 0 .672-2.218 3.15 3.15 0 0 0-.28-2.168l-3.118-4.563zM51.449 15.195V5.842c4.181-.205 7.988-.405 9.438-.483l.851-.05c.387-.399.885-2.395.689-3.021-.073-.25-.213-.666-.638-.555a33.279 33.279 0 0 1-4.277.727c-2.766.321-3.97.404-7.804.682-6.718.487-12.709.72-12.709.72a2.518 2.518 0 0 0 .788 1.834 2.567 2.567 0 0 0 1.883.706c2.278-.095 5.598-.25 8.996-.41v9.203h-12.78c0 .703.281 1.377.783 1.874a2.69 2.69 0 0 0 1.892.777h10.105v7.075c0 .887-.464 1.192-1.231 1.214h-3.92a4.15 4.15 0 0 0 .837 1.544 4.2 4.2 0 0 0 1.403 1.067 6.215 6.215 0 0 0 2.71.277c1.36-.066 2.967-.826 2.967-3.57v-7.607h11.28c.342 0 .67-.135.91-.374.242-.239.378-.563.378-.902v-1.375H51.449z&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M42.614 8.873a2.304 2.304 0 0 0-1.508-.926 2.334 2.334 0 0 0-1.727.405l-.376.272 4.255 5.85 2.24-1.62-2.884-3.98zM57.35 8.68l-3.125 4.097 2.24 1.663 4.517-5.927-.375-.277a2.32 2.32 0 0 0-1.722-.452 2.327 2.327 0 0 0-1.536.896z&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;;<br><br>interface <span class="hljs-title class_">NavProps</span> &#123;<br> <span class="hljs-attr">navs</span>: <span class="hljs-title class_">ZHRouter</span>;<br>&#125;<br><br>type <span class="hljs-title class_">NavLinkRenderProps</span> = &#123;<br> isActive?: boolean;<br> isPending?: boolean;<br> isTransitioning?: boolean;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">NavTab</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">NavProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">&#123; navs &#125;</span>) =&gt;</span> &#123;<br> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getStyles</span> = (<span class="hljs-params">&#123; isActive &#125;: NavLinkRenderProps</span>) =&gt;<br>  <span class="hljs-string">&quot;hover:text-black mx-4 h-full py-3.5 transition-all &quot;</span> +<br>  (isActive<br>   ? <span class="hljs-string">&quot;font-extrabold text-black border-b-4 border-blue-600&quot;</span><br>   : <span class="hljs-string">&quot;text-gray-400&quot;</span>);<br><br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex mx-6 box-border&quot;</span>&gt;</span></span><br><span class="language-xml">   &#123;navs.map((item) =&gt; (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.path</span> + &quot;<span class="hljs-attr">__</span>&quot;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">to</span>=<span class="hljs-string">&#123;item.path</span> || &quot;/&quot;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;getStyles&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">     &#123;item.title&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span></span><br><span class="language-xml">   ))&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">MenuAlarm</span> = (<span class="hljs-params"></span>) =&gt; (<br> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex mr-10 gap-4&quot;</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex flex-col justify-center items-center&quot;</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">BellIcon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; h-5 w-5 text-gray-400 fill-gray-400&quot;</span> /&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; text-gray-400 text-xs&quot;</span>&gt;</span>消息<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex flex-col justify-center items-center&quot;</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">BellIcon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; h-5 w-5 text-gray-400 fill-gray-400&quot;</span> /&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; text-gray-400 text-xs&quot;</span>&gt;</span>私信<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Navigation</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; bg-white w-screen shadow-lg&quot;</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; max-w-6xl mx-auto my-0 flex justify-center w-full&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; h-14 flex justify-between items-center min-w-max w-full&quot;</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex items-center&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Logo</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">NavTab</span> <span class="hljs-attr">navs</span>=<span class="hljs-string">&#123;router&#125;</span> /&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">Search</span> /&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">MenuAlarm</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="60">
<li>更改<code>react-master/src/pages/home/index.tsx</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Outlet</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Navigation</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../components/navigation&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">Navigation</span> /&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="61">
<li>更改<code>react-master/src/pages/router/index.tsx</code></li>
</ol>
<p><img src="/img/images/2024/1709885578000-a9ea41cb-410d-41b5-b64b-4241fb15572f.png" srcset="/img/loading.gif" lazyload></p>
<ol start="62">
<li>新建搜索栏对应文件，并写代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src/components/search &amp;&amp; touch src/components/search/index.<span class="hljs-property">tsx</span><br><br><span class="hljs-comment">// 写如下代码：</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Search</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex items-center&quot;</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-98 h-8 border border-gray-100 px-4 rounded-full bg-gray-50&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;福建软考报名入口&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">   /&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-16 h-8 mx-4 text-sm bg-blue-500 text-white flex justify-center items-center rounded-full hover:bg-blue-800 transition-all&quot;</span>&gt;</span></span><br><span class="language-xml">    提问</span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="63">
<li>此时的页面效果如下</li>
</ol>
<p><img src="/img/images/2024/1709885612891-c9761074-1926-4d62-a088-4868d0d92847.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="完善首页"><a href="#完善首页" class="headerlink" title="完善首页"></a>完善首页</h2><ol start="64">
<li>完善首页代码，<code>react-master/src/pages/home/index.tsx</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Navigation</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../components/navigation&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Card</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../components/card&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Tabs</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./tabs&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">Navigation</span> /&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; mx-auto max-w-6xl flex my-2 px-20&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-2/3&quot;</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">Tabs</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex-1 w-1/3&quot;</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-full&quot;</span>&gt;</span>创作中心<span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-full&quot;</span>&gt;</span>推荐关注<span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-full&quot;</span>&gt;</span>其他功能<span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="65">
<li>新建<code>Card</code>组件，并写代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src/components/card &amp;&amp; touch src/components/card/index.<span class="hljs-property">tsx</span><br><br><span class="hljs-comment">// 写如下代码：</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">ReactNode</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;<br> className?: string;<br> children?: <span class="hljs-title class_">ReactNode</span>;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Card</span>(<span class="hljs-params">&#123; className, children &#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">   <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>` <span class="hljs-attr">bg-white</span> <span class="hljs-attr">border</span> <span class="hljs-attr">border-gray-200</span> <span class="hljs-attr">m-2</span> <span class="hljs-attr">rounded-sm</span> <span class="hljs-attr">shadow-md</span> $&#123;<span class="hljs-attr">className</span>&#125;`&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">  &gt;</span></span><br><span class="language-xml">   &#123;children&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="66">
<li>新建<code>tabs.tsx</code>，作为二级菜单<img src="/img/images/2024/1709886675241-b05080b8-6262-4256-bd1a-62a604916d2b.png" srcset="/img/loading.gif" lazyload></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch src/pages/home/tabs.<span class="hljs-property">tsx</span><br><br><span class="hljs-comment">// 写如下代码：</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NavLink</span>, <span class="hljs-title class_">Outlet</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;<br> className?: string;<br>&#125;;<br><br><span class="hljs-keyword">const</span> tabs = [<br> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;关注&quot;</span>,<br>  <span class="hljs-attr">to</span>: <span class="hljs-string">&quot;/follow&quot;</span>,<br> &#125;,<br> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;推荐&quot;</span>,<br>  <span class="hljs-attr">to</span>: <span class="hljs-string">&quot;/&quot;</span>,<br> &#125;,<br> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;热榜&quot;</span>,<br>  <span class="hljs-attr">to</span>: <span class="hljs-string">&quot;/hot&quot;</span>,<br> &#125;,<br> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;视频&quot;</span>,<br>  <span class="hljs-attr">to</span>: <span class="hljs-string">&quot;/zvideo&quot;</span>,<br> &#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Tabs</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-full&quot;</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex mx-6 box-border&quot;</span>&gt;</span></span><br><span class="language-xml">    &#123;tabs.map((item) =&gt; (</span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.to&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">to</span>=<span class="hljs-string">&#123;item.to&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;(&#123;</span> <span class="hljs-attr">isActive</span> &#125;) =&gt;</span></span><br><span class="language-xml">       &quot; whitespace-nowrap py-4 px-4 text-base transition-all &quot; +</span><br><span class="language-xml">       (isActive</span><br><span class="language-xml">        ? &quot;text-blue-600 font-bold&quot;</span><br><span class="language-xml">        : &quot;text-black hover:text-blue-700&quot;)</span><br><span class="language-xml">      &#125;</span><br><span class="language-xml">     &gt;</span><br><span class="language-xml">      &#123;item.name&#125;</span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span></span><br><span class="language-xml">    ))&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="67">
<li>目前页面效果如下</li>
</ol>
<p><img src="/img/images/2024/1709891445941-3eee6c78-5284-49d8-a120-f272c43f6e58.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="完善推荐列表"><a href="#完善推荐列表" class="headerlink" title="完善推荐列表"></a>完善推荐列表</h2><ol start="68">
<li>处理 mock 数据</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src/pages/home/commandList &amp;&amp; touch src/pages/home/commandList/mock.<span class="hljs-property">js</span><br><br><span class="hljs-comment">// 写入代码（数据太长了，去 github 上 copy 吧）：</span><br><br><span class="hljs-attr">https</span>:<span class="hljs-comment">//github.com/MrHzq/react-actual-combat/blob/main/packages/apps/react-master/src/pages/home/commandList/mock.js</span><br></code></pre></td></tr></table></figure>

<ol start="67">
<li>新建推荐列表页面 &amp;&amp; 路由更改</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch src/pages/home/commandList/index.<span class="hljs-property">tsx</span><br></code></pre></td></tr></table></figure>

<p><img src="/img/images/2024/1709895001762-cece1a26-d55a-4632-b4f6-4194b9665299.png" srcset="/img/loading.gif" lazyload></p>
<ol start="68">
<li>推荐列表页面代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-variable constant_">FC</span>, <span class="hljs-title class_">MouseEventHandler</span>, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; mockList &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./mock&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br>interface <span class="hljs-title class_">ICommandItem</span> &#123;<br> <span class="hljs-attr">key</span>: string;<br> <span class="hljs-attr">item</span>: any;<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">CommandData</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">ICommandItem</span>&gt; = <span class="hljs-function">(<span class="hljs-params">&#123; item &#125;</span>) =&gt;</span> &#123;<br> <span class="hljs-keyword">const</span> [selected, setSelected] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br> <span class="hljs-keyword">const</span> <span class="hljs-attr">handleClick</span>: <span class="hljs-title class_">MouseEventHandler</span>&lt;<span class="hljs-title class_">Element</span>&gt; = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  event.<span class="hljs-title function_">preventDefault</span>();<br>  <span class="hljs-title function_">setSelected</span>(!selected);<br> &#125;;<br><br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex flex-col items-start p-4 border-b&quot;</span>&gt;</span></span><br><span class="language-xml">   &#123;/* 标题部分 */&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex h-auto&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; font-bold text-lg leading-10&quot;</span>&gt;</span></span><br><span class="language-xml">     &#123;item?.target?.question?.title || item?.target?.title&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">   &#123;/* 文章卡片 */&#125;</span><br><span class="language-xml">   &#123;selected ? (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">__html:</span> <span class="hljs-attr">item</span>?<span class="hljs-attr">.target</span>?<span class="hljs-attr">.content</span> &#125;&#125; /&gt;</span></span><br><span class="language-xml">   ) : (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; cursor-pointer hover:text-gray-600 text-gray-800&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">     &#123;item?.target?.excerpt?.substring(0, 80) + &quot;...&quot;&#125;</span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; text-sm leading-7 text-blue-500 ml-2&quot;</span>&gt;</span></span><br><span class="language-xml">      阅读全文 <span class="hljs-symbol">&amp;gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">   )&#125;</span><br><span class="language-xml"></span><br><span class="language-xml">   &#123;/* 底部 bar */&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">flex</span> <span class="hljs-attr">justify-between</span> <span class="hljs-attr">items-center</span> <span class="hljs-attr">p-3</span> <span class="hljs-attr">bg-white</span> <span class="hljs-attr">w-full</span> $&#123;<span class="hljs-attr">selected</span> ? &quot; <span class="hljs-attr">bottom-0</span> <span class="hljs-attr">left-0</span> <span class="hljs-attr">shadow-sm</span> <span class="hljs-attr">border-t</span> <span class="hljs-attr">sticky</span>&quot; <span class="hljs-attr">:</span> &quot;&quot;&#125;`&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">   &gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex items-center flex-1&quot;</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;</span></span></span><br><span class="hljs-string"><span class="hljs-tag"><span class="language-xml">                        flex justify-center items-center h-8 px-4 bg-blue-100 text-sm text-blue-600 rounded-sm  cursor-pointer hover:bg-blue-200 transition-all&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     &gt;</span></span><br><span class="language-xml">      赞同 &#123;item?.target?.thanks_count || 0&#125;</span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex justify-center items-center h-8 px-4 bg-blue-100 text-sm text-blue-600 rounded-sm  cursor-pointer hover:bg-blue-200 transition-all ml-2&quot;</span>&gt;</span></span><br><span class="language-xml">      踩</span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex items-center flex-1 gap-8 text-gray-400 text-sm ml-8&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;item?.target?.comment_count&#125; 评论<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>收藏<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>举报<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    &#123;selected &amp;&amp; (</span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">span</span></span></span><br><span class="hljs-tag"><span class="language-xml">       <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; text-gray-500 text-sm cursor-pointer&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">       <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">       收起</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    )&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">CommandList</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex flex-col border-t&quot;</span>&gt;</span></span><br><span class="language-xml">   &#123;mockList.map((item, idx) =&gt; (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">CommandData</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id</span> + <span class="hljs-attr">idx</span>&#125; <span class="hljs-attr">item</span>=<span class="hljs-string">&#123;item&#125;</span> /&gt;</span></span><br><span class="language-xml">   ))&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="69">
<li>当前页面效果</li>
</ol>
<p><img src="/img/images/2024/1709895144355-f28819e9-5ec2-4e0d-b672-ee3a4a693ce6.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="3、继续页面开发"><a href="#3、继续页面开发" class="headerlink" title="3、继续页面开发"></a>3、继续页面开发</h1><p>第二大节【2、项目开发】中已经基本成型了，这次会补充、完善一些细节</p>
<h3 id="顶部导航吸顶，要求：滚动一点距离后才吸顶"><a href="#顶部导航吸顶，要求：滚动一点距离后才吸顶" class="headerlink" title="顶部导航吸顶，要求：滚动一点距离后才吸顶"></a>顶部导航吸顶，要求：滚动一点距离后才吸顶</h3><ol start="70">
<li>改动页面：<code>react-master/src/components/navigation/index.tsx</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-variable constant_">FC</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ZHRouter</span>, router &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../router&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BellIcon</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@heroicons/react/24/outline&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NavLink</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Search</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../search&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Tab</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../pages/home/tabs&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Logo</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; px-2&quot;</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">svg</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">viewBox</span>=<span class="hljs-string">&quot;0 0 64 30&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">fill</span>=<span class="hljs-string">&quot;#1772F6&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;64&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;30&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;css-1hlrcxk&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">   &gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M29.05 4.582H16.733V25.94h3.018l.403 2.572 4.081-2.572h4.815V4.582zm-5.207 18.69l-2.396 1.509-.235-1.508h-1.724V7.233h6.78v16.04h-2.425zM14.46 14.191H9.982c0-.471.033-.954.039-1.458v-5.5h5.106V5.935a1.352 1.352 0 0 0-.404-.957 1.378 1.378 0 0 0-.968-.396H5.783c.028-.088.056-.177.084-.255.274-.82 1.153-3.326 1.153-3.326a4.262 4.262 0 0 0-2.413.698c-.57.4-.912.682-1.371 1.946-.532 1.453-.997 2.856-1.31 3.693C1.444 8.674.28 11.025.28 11.025a5.85 5.85 0 0 0 2.52-.61c1.119-.593 1.679-1.502 2.054-2.883l.09-.3h2.334v5.5c0 .5-.045.982-.073 1.46h-4.12c-.71 0-1.39.278-1.893.775a2.638 2.638 0 0 0-.783 1.874h6.527a17.717 17.717 0 0 1-.778 3.649 16.796 16.796 0 0 1-3.012 5.273A33.104 33.104 0 0 1 0 28.74s3.13 1.175 5.425-.954c1.388-1.292 2.631-3.814 3.23-5.727a28.09 28.09 0 0 0 1.12-5.229h5.967v-1.37a1.254 1.254 0 0 0-.373-.899 1.279 1.279 0 0 0-.909-.37z&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M11.27 19.675l-2.312 1.491 5.038 7.458a6.905 6.905 0 0 0 .672-2.218 3.15 3.15 0 0 0-.28-2.168l-3.118-4.563zM51.449 15.195V5.842c4.181-.205 7.988-.405 9.438-.483l.851-.05c.387-.399.885-2.395.689-3.021-.073-.25-.213-.666-.638-.555a33.279 33.279 0 0 1-4.277.727c-2.766.321-3.97.404-7.804.682-6.718.487-12.709.72-12.709.72a2.518 2.518 0 0 0 .788 1.834 2.567 2.567 0 0 0 1.883.706c2.278-.095 5.598-.25 8.996-.41v9.203h-12.78c0 .703.281 1.377.783 1.874a2.69 2.69 0 0 0 1.892.777h10.105v7.075c0 .887-.464 1.192-1.231 1.214h-3.92a4.15 4.15 0 0 0 .837 1.544 4.2 4.2 0 0 0 1.403 1.067 6.215 6.215 0 0 0 2.71.277c1.36-.066 2.967-.826 2.967-3.57v-7.607h11.28c.342 0 .67-.135.91-.374.242-.239.378-.563.378-.902v-1.375H51.449z&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M42.614 8.873a2.304 2.304 0 0 0-1.508-.926 2.334 2.334 0 0 0-1.727.405l-.376.272 4.255 5.85 2.24-1.62-2.884-3.98zM57.35 8.68l-3.125 4.097 2.24 1.663 4.517-5.927-.375-.277a2.32 2.32 0 0 0-1.722-.452 2.327 2.327 0 0 0-1.536.896z&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;;<br><br>interface <span class="hljs-title class_">NavProps</span> &#123;<br> <span class="hljs-attr">navs</span>: <span class="hljs-title class_">ZHRouter</span>;<br>&#125;<br><br>type <span class="hljs-title class_">NavLinkRenderProps</span> = &#123;<br> isActive?: boolean;<br> isPending?: boolean;<br> isTransitioning?: boolean;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">NavTab</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">NavProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">&#123; navs &#125;</span>) =&gt;</span> &#123;<br> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getStyles</span> = (<span class="hljs-params">&#123; isActive &#125;: NavLinkRenderProps</span>) =&gt;<br>  <span class="hljs-string">&quot;hover:text-black mx-4 h-full py-3.5 transition-all &quot;</span> +<br>  (isActive<br>   ? <span class="hljs-string">&quot;font-extrabold text-black border-b-4 border-blue-600&quot;</span><br>   : <span class="hljs-string">&quot;text-gray-400&quot;</span>);<br><br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex mx-6 box-border&quot;</span>&gt;</span></span><br><span class="language-xml">   &#123;navs.map((item) =&gt; (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.path</span> + &quot;<span class="hljs-attr">__</span>&quot;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">to</span>=<span class="hljs-string">&#123;item.path</span> || &quot;/&quot;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;getStyles&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">     &#123;item.title&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span></span><br><span class="language-xml">   ))&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">MenuAlarm</span> = (<span class="hljs-params"></span>) =&gt; (<br> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;flex mr-10 gap-4&quot;</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex flex-col justify-center items-center&quot;</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">BellIcon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; h-5 w-5 text-gray-400 fill-gray-400&quot;</span> /&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; text-gray-400 text-xs&quot;</span>&gt;</span>消息<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex flex-col justify-center items-center&quot;</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">BellIcon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; h-5 w-5 text-gray-400 fill-gray-400&quot;</span> /&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; text-gray-400 text-xs&quot;</span>&gt;</span>私信<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>);<br><br>type <span class="hljs-title class_">Props</span> = &#123;<br> <span class="hljs-attr">className</span>: string;<br> <span class="hljs-attr">hide</span>: boolean;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Navigation</span>(<span class="hljs-params">&#123; className, hide &#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">   <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>` <span class="hljs-attr">bg-white</span> <span class="hljs-attr">w-screen</span> <span class="hljs-attr">shadow-lg</span> <span class="hljs-attr">overflow-hidden</span> $&#123;<span class="hljs-attr">className</span>&#125;`&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">  &gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; max-w-6xl mx-auto my-0 flex justify-center w-full&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>` <span class="hljs-attr">relative</span> <span class="hljs-attr">h-14</span> <span class="hljs-attr">flex</span> <span class="hljs-attr">flex-col</span> <span class="hljs-attr">justify-between</span> <span class="hljs-attr">items-center</span> <span class="hljs-attr">min-w-max</span> <span class="hljs-attr">w-full</span> <span class="hljs-attr">transition-all</span> <span class="hljs-attr">duration-300</span> $&#123;<span class="hljs-attr">hide</span> ? &quot;<span class="hljs-attr">top-0</span>&quot; <span class="hljs-attr">:</span> &quot;<span class="hljs-attr">-top-14</span>&quot;&#125;`&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">     &#123;/* 未吸顶时展示这个 */&#125;</span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-full h-14 flex justify-between items-center min-w-max&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex items-center&quot;</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">Logo</span> /&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">NavTab</span> <span class="hljs-attr">navs</span>=<span class="hljs-string">&#123;router&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Search</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MenuAlarm</span> /&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">     &#123;/* 吸顶时展示这个 */&#125;</span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-full h-14 flex justify-between items-center min-w-max&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex items-center&quot;</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">Logo</span> /&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">Tab</span> <span class="hljs-attr">activeStyle</span>=<span class="hljs-string">&quot;border-b-4 border-blue-600&quot;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Search</span> /&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="71">
<li>改动页面：<code>react-master/src/pages/home/index.tsx</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Navigation</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../components/navigation&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Card</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../components/card&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Tabs</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./tabs&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">const</span> [hide, setHide] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br><br> <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params">flag: boolean</span>) =&gt; &#123;<br>  <span class="hljs-title function_">setHide</span>(flag);<br> &#125;;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">Navigation</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; sticky top-0&quot;</span> <span class="hljs-attr">hide</span>=<span class="hljs-string">&#123;hide&#125;</span> /&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; mx-auto max-w-6xl flex my-2 px-20&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-2/3&quot;</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">Tabs</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleChange&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex-1 w-1/3&quot;</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-full&quot;</span>&gt;</span>创作中心<span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-full&quot;</span>&gt;</span>推荐关注<span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-full&quot;</span>&gt;</span>其他功能<span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="72">
<li>改动页面：<code>react-master/src/pages/home/tabs.tsx</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-variable constant_">FC</span>, useEffect, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NavLink</span>, <span class="hljs-title class_">Outlet</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> tabs = [<br> &#123;<br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;关注&quot;</span>,<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/follow&quot;</span>,<br> &#125;,<br> &#123;<br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;推荐&quot;</span>,<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/&quot;</span>,<br> &#125;,<br> &#123;<br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;热榜&quot;</span>,<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/hot&quot;</span>,<br> &#125;,<br> &#123;<br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;视频&quot;</span>,<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/zvideo&quot;</span>,<br> &#125;,<br>];<br><br>type <span class="hljs-title class_">TabProps</span> = &#123;<br> activeStyle?: string;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Tab</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">TabProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">&#123; activeStyle &#125;</span>) =&gt;</span> (<br> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex mx-6 box-border&quot;</span>&gt;</span></span><br><span class="language-xml">  &#123;tabs.map((item) =&gt; (</span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.path&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">to</span>=<span class="hljs-string">&#123;item.path&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;(&#123;</span> <span class="hljs-attr">isActive</span> &#125;) =&gt;</span></span><br><span class="language-xml">     &quot; whitespace-nowrap py-4 mx-4 text-base transition-all &quot; +</span><br><span class="language-xml">     (isActive</span><br><span class="language-xml">      ? &quot;text-blue-600 font-bold &quot; + activeStyle</span><br><span class="language-xml">      : &quot;text-black hover:text-blue-700&quot;)</span><br><span class="language-xml">    &#125;</span><br><span class="language-xml">   &gt;</span><br><span class="language-xml">    &#123;item.title&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span></span><br><span class="language-xml">  ))&#125;</span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>);<br><br>type <span class="hljs-title class_">Props</span> = &#123;<br> className?: string;<br> onChange?: <span class="hljs-function">(<span class="hljs-params">bool: boolean</span>) =&gt;</span> <span class="hljs-keyword">void</span>;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Tabs</span>(<span class="hljs-params">&#123; onChange &#125;: Props</span>) &#123;<br> <span class="hljs-keyword">const</span> scrollRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);<br><br> <span class="hljs-comment">// 当这个 ref 的 div 到顶后，则进行吸顶处理</span><br><br> <span class="hljs-comment">// 判断到顶</span><br> <span class="hljs-comment">// 1、getBoundingClientRect 获取到元素的位置信息，然后计算</span><br> <span class="hljs-comment">// 2、IntersectionObserver 监听元素进入可视区域</span><br> <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">intersectionObserver</span>: <span class="hljs-title class_">IntersectionObserver</span> | <span class="hljs-literal">undefined</span> =<br>   <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 当进入可视区域内时，执行一次，entries[0]?.isIntersecting 为 true</span><br>    <span class="hljs-comment">// 当离开可视区域内时，执行一次，entries[0]?.isIntersecting 为 false</span><br>    <span class="hljs-comment">// 所以当为 false 时处理吸顶</span><br>    onChange?.(entries[<span class="hljs-number">0</span>]?.<span class="hljs-property">isIntersecting</span>);<br>   &#125;);<br><br>  scrollRef.<span class="hljs-property">current</span> &amp;&amp; intersectionObserver.<span class="hljs-title function_">observe</span>(scrollRef.<span class="hljs-property">current</span>);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>   scrollRef.<span class="hljs-property">current</span> &amp;&amp; intersectionObserver!.<span class="hljs-title function_">unobserve</span>(scrollRef.<span class="hljs-property">current</span>);<br><br>   intersectionObserver = <span class="hljs-literal">undefined</span>;<br>  &#125;;<br> &#125;, []);<br><br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-full&quot;</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;scrollRef&#125;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">Tab</span> /&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="无限滚动"><a href="#无限滚动" class="headerlink" title="无限滚动"></a>无限滚动</h3><ol start="73">
<li>改动页面：<code>react-master/src/pages/home/commandList.tsx</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123;<br> <span class="hljs-variable constant_">FC</span>,<br> <span class="hljs-title class_">MouseEventHandler</span>,<br> useEffect,<br> useRef,<br> useState,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; mockList &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./mock&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br>interface <span class="hljs-title class_">ICommandItem</span> &#123;<br> <span class="hljs-attr">key</span>: string;<br> <span class="hljs-attr">item</span>: any;<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">CommandData</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">ICommandItem</span>&gt; = <span class="hljs-function">(<span class="hljs-params">&#123; item &#125;</span>) =&gt;</span> &#123;<br> <span class="hljs-keyword">const</span> [selected, setSelected] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br> <span class="hljs-keyword">const</span> <span class="hljs-attr">handleClick</span>: <span class="hljs-title class_">MouseEventHandler</span>&lt;<span class="hljs-title class_">Element</span>&gt; = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  event.<span class="hljs-title function_">preventDefault</span>();<br>  <span class="hljs-title function_">setSelected</span>(!selected);<br> &#125;;<br><br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex flex-col items-start p-4 border-b&quot;</span>&gt;</span></span><br><span class="language-xml">   &#123;/* 标题部分 */&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex h-auto&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; font-bold text-lg leading-10&quot;</span>&gt;</span></span><br><span class="language-xml">     &#123;item?.target?.question?.title || item?.target?.title&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">   &#123;/* 文章卡片 */&#125;</span><br><span class="language-xml">   &#123;selected ? (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">__html:</span> <span class="hljs-attr">item</span>?<span class="hljs-attr">.target</span>?<span class="hljs-attr">.content</span> &#125;&#125; /&gt;</span></span><br><span class="language-xml">   ) : (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; cursor-pointer hover:text-gray-600 text-gray-800&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">     &#123;item?.target?.excerpt?.substring(0, 80) + &quot;...&quot;&#125;</span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; text-sm leading-7 text-blue-500 ml-2&quot;</span>&gt;</span></span><br><span class="language-xml">      阅读全文 <span class="hljs-symbol">&amp;gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">   )&#125;</span><br><span class="language-xml"></span><br><span class="language-xml">   &#123;/* 底部 bar */&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">flex</span> <span class="hljs-attr">justify-between</span> <span class="hljs-attr">items-center</span> <span class="hljs-attr">p-3</span> <span class="hljs-attr">bg-white</span> <span class="hljs-attr">w-full</span> $&#123;<span class="hljs-attr">selected</span> ? &quot; <span class="hljs-attr">bottom-0</span> <span class="hljs-attr">left-0</span> <span class="hljs-attr">shadow-sm</span> <span class="hljs-attr">border-t</span> <span class="hljs-attr">sticky</span>&quot; <span class="hljs-attr">:</span> &quot;&quot;&#125;`&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">   &gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex items-center flex-1&quot;</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;</span></span></span><br><span class="hljs-string"><span class="hljs-tag"><span class="language-xml">                        flex justify-center items-center h-8 px-4 bg-blue-100 text-sm text-blue-600 rounded-sm  cursor-pointer hover:bg-blue-200 transition-all&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     &gt;</span></span><br><span class="language-xml">      赞同 &#123;item?.target?.thanks_count || 0&#125;</span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex justify-center items-center h-8 px-4 bg-blue-100 text-sm text-blue-600 rounded-sm  cursor-pointer hover:bg-blue-200 transition-all ml-2&quot;</span>&gt;</span></span><br><span class="language-xml">      踩</span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex items-center flex-1 gap-8 text-gray-400 text-sm ml-8&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;item?.target?.comment_count&#125; 评论<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>收藏<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>举报<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    &#123;selected &amp;&amp; (</span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">span</span></span></span><br><span class="hljs-tag"><span class="language-xml">       <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; text-gray-500 text-sm cursor-pointer&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">       <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">       收起</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    )&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchList</span> = (<span class="hljs-params"></span>) =&gt;<br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Array</span>&lt;any&gt;&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>   <span class="hljs-title function_">resolve</span>(mockList.<span class="hljs-title function_">slice</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>));<br>  &#125;, <span class="hljs-number">500</span>);<br> &#125;);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">CommandList</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">const</span> [list, setList] = <span class="hljs-title function_">useState</span>(mockList.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));<br><br> <span class="hljs-keyword">const</span> scrollRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);<br><br> <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">intersectionObserver</span>: <span class="hljs-title class_">IntersectionObserver</span> | <span class="hljs-literal">undefined</span> =<br>   <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 这个函数执行时，拿不到最新的 list</span><br>    <span class="hljs-keyword">const</span> isIntersecting = entries[<span class="hljs-number">0</span>]?.<span class="hljs-property">isIntersecting</span>;<br><br>    <span class="hljs-keyword">if</span> (isIntersecting) &#123;<br>     <span class="hljs-comment">// 加载更多数据</span><br>     <span class="hljs-title function_">fetchList</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: <span class="hljs-built_in">Array</span>&lt;any&gt;</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">setList</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> [...list, ...res]);<br><br>      <span class="hljs-comment">// setList([...list, ...res]); 这样写，list 不会更新</span><br>     &#125;);<br>    &#125;<br>   &#125;);<br><br>  scrollRef.<span class="hljs-property">current</span> &amp;&amp; intersectionObserver.<span class="hljs-title function_">observe</span>(scrollRef.<span class="hljs-property">current</span>);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>   scrollRef.<span class="hljs-property">current</span> &amp;&amp; intersectionObserver!.<span class="hljs-title function_">unobserve</span>(scrollRef.<span class="hljs-property">current</span>);<br>   intersectionObserver = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;<br>  &#125;;<br> &#125;, []);<br><br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex flex-col border-t&quot;</span>&gt;</span></span><br><span class="language-xml">   &#123;list.map((item, idx) =&gt; (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">CommandData</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id</span> + <span class="hljs-attr">idx</span>&#125; <span class="hljs-attr">item</span>=<span class="hljs-string">&#123;item&#125;</span> /&gt;</span></span><br><span class="language-xml">   ))&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;scrollRef&#125;</span>&gt;</span>loading......<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="use-API-封装"><a href="#use-API-封装" class="headerlink" title="use* API 封装"></a>use* API 封装</h3><p>React 的 useApi 有 useState 这种有返回值的，也有 useEffect 这种“生命周期”类的</p>
<h4 id="useRefInsObsEffect"><a href="#useRefInsObsEffect" class="headerlink" title="useRefInsObsEffect"></a>useRefInsObsEffect</h4><p>类似于 useEffect 的</p>
<ol start="74">
<li>新增<code>useRefInsObsEffect.ts</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch src/pages/home/commandList/useRefInsObsEffect.<span class="hljs-property">ts</span><br><br><span class="hljs-comment">// 写如下代码：</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">RefObject</span>, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useRefInsObsEffect</span>(<span class="hljs-params"></span><br><span class="hljs-params"> fn: (b: boolean) =&gt; <span class="hljs-keyword">void</span>,</span><br><span class="hljs-params"> scrollRef: RefObject&lt;HTMLDivElement&gt;,</span><br><span class="hljs-params"></span>) &#123;<br> <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">intersectionObserver</span>: <span class="hljs-title class_">IntersectionObserver</span> | <span class="hljs-literal">undefined</span> =<br>   <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">fn</span>(entries[<span class="hljs-number">0</span>]?.<span class="hljs-property">isIntersecting</span>);<br>   &#125;);<br><br>  scrollRef.<span class="hljs-property">current</span> &amp;&amp; intersectionObserver.<span class="hljs-title function_">observe</span>(scrollRef.<span class="hljs-property">current</span>);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>   scrollRef.<span class="hljs-property">current</span> &amp;&amp; intersectionObserver!.<span class="hljs-title function_">unobserve</span>(scrollRef.<span class="hljs-property">current</span>);<br>   intersectionObserver = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;<br>  &#125;;<br> &#125;, []);<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="75">
<li>更改<code>react-master/src/pages/home/commandList/index.tsx</code>（看变更吧）</li>
</ol>
<p><img src="/img/images/2024/1709905780255-ab58c2e3-a3ee-4755-a1cf-38c7d27a34f6.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="useRefInsObsState"><a href="#useRefInsObsState" class="headerlink" title="useRefInsObsState"></a>useRefInsObsState</h4><p>类似于 useState 的</p>
<ol start="76">
<li>新增<code>useRefInsObsState.ts</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">RefObject</span>, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useRefInsObsEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./useRefInsObsEffect&quot;</span>;<br><br><span class="hljs-keyword">import</span> &#123; mockList &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./mock&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchList</span> = (<span class="hljs-params"></span>) =&gt;<br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Array</span>&lt;any&gt;&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>   <span class="hljs-title function_">resolve</span>(mockList.<span class="hljs-title function_">slice</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>));<br>  &#125;, <span class="hljs-number">1000</span>);<br> &#125;);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useRefInsObsState</span>(<span class="hljs-params">scrollRef: RefObject&lt;HTMLDivElement&gt;</span>) &#123;<br> <span class="hljs-keyword">const</span> [list, setList] = <span class="hljs-title function_">useState</span>(mockList.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));<br><br> <span class="hljs-title function_">useRefInsObsEffect</span>(<span class="hljs-function">(<span class="hljs-params">isIntersecting</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (isIntersecting) &#123;<br>   <span class="hljs-comment">// 加载更多数据</span><br>   <span class="hljs-title function_">fetchList</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: <span class="hljs-built_in">Array</span>&lt;any&gt;</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">setList</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> [...list, ...res]);<br>   &#125;);<br>  &#125;<br> &#125;, scrollRef);<br><br> <span class="hljs-keyword">return</span> list;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="77">
<li>更改<code>react-master/src/pages/home/commandList/index.tsx</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-variable constant_">FC</span>, <span class="hljs-title class_">MouseEventHandler</span>, useRef, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useRefInsObsState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./useRefInsObsState&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br>interface <span class="hljs-title class_">ICommandItem</span> &#123;<br> <span class="hljs-attr">key</span>: string;<br> <span class="hljs-attr">item</span>: any;<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">CommandData</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">ICommandItem</span>&gt; = <span class="hljs-function">(<span class="hljs-params">&#123; item &#125;</span>) =&gt;</span> &#123;<br> <span class="hljs-keyword">const</span> [selected, setSelected] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br> <span class="hljs-keyword">const</span> <span class="hljs-attr">handleClick</span>: <span class="hljs-title class_">MouseEventHandler</span>&lt;<span class="hljs-title class_">Element</span>&gt; = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  event.<span class="hljs-title function_">preventDefault</span>();<br>  <span class="hljs-title function_">setSelected</span>(!selected);<br> &#125;;<br><br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex flex-col items-start p-4 border-b&quot;</span>&gt;</span></span><br><span class="language-xml">   &#123;/* 标题部分 */&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex h-auto&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; font-bold text-lg leading-10&quot;</span>&gt;</span></span><br><span class="language-xml">     &#123;item?.target?.question?.title || item?.target?.title&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">   &#123;/* 文章卡片 */&#125;</span><br><span class="language-xml">   &#123;selected ? (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">__html:</span> <span class="hljs-attr">item</span>?<span class="hljs-attr">.target</span>?<span class="hljs-attr">.content</span> &#125;&#125; /&gt;</span></span><br><span class="language-xml">   ) : (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">a</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; cursor-pointer hover:text-gray-600 text-gray-800&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">     &#123;item?.target?.excerpt?.substring(0, 80) + &quot;...&quot;&#125;</span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; text-sm leading-7 text-blue-500 ml-2&quot;</span>&gt;</span></span><br><span class="language-xml">      阅读全文 <span class="hljs-symbol">&amp;gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="language-xml">   )&#125;</span><br><span class="language-xml"></span><br><span class="language-xml">   &#123;/* 底部 bar */&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">flex</span> <span class="hljs-attr">justify-between</span> <span class="hljs-attr">items-center</span> <span class="hljs-attr">p-3</span> <span class="hljs-attr">bg-white</span> <span class="hljs-attr">w-full</span> $&#123;<span class="hljs-attr">selected</span> ? &quot; <span class="hljs-attr">bottom-0</span> <span class="hljs-attr">left-0</span> <span class="hljs-attr">shadow-sm</span> <span class="hljs-attr">border-t</span> <span class="hljs-attr">sticky</span>&quot; <span class="hljs-attr">:</span> &quot;&quot;&#125;`&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">   &gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex items-center flex-1&quot;</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;</span></span></span><br><span class="hljs-string"><span class="hljs-tag"><span class="language-xml">                        flex justify-center items-center h-8 px-4 bg-blue-100 text-sm text-blue-600 rounded-sm  cursor-pointer hover:bg-blue-200 transition-all&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     &gt;</span></span><br><span class="language-xml">      赞同 &#123;item?.target?.thanks_count || 0&#125;</span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex justify-center items-center h-8 px-4 bg-blue-100 text-sm text-blue-600 rounded-sm  cursor-pointer hover:bg-blue-200 transition-all ml-2&quot;</span>&gt;</span></span><br><span class="language-xml">      踩</span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex items-center flex-1 gap-8 text-gray-400 text-sm ml-8&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;item?.target?.comment_count&#125; 评论<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>收藏<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>举报<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    &#123;selected &amp;&amp; (</span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">span</span></span></span><br><span class="hljs-tag"><span class="language-xml">       <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; text-gray-500 text-sm cursor-pointer&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">       <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">       收起</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    )&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">CommandList</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">const</span> scrollRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);<br><br> <span class="hljs-keyword">const</span> list = <span class="hljs-title function_">useRefInsObsState</span>(scrollRef);<br><br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex flex-col border-t&quot;</span>&gt;</span></span><br><span class="language-xml">   &#123;list.map((item, idx) =&gt; (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">CommandData</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id</span> + <span class="hljs-attr">idx</span>&#125; <span class="hljs-attr">item</span>=<span class="hljs-string">&#123;item&#125;</span> /&gt;</span></span><br><span class="language-xml">   ))&#125;</span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;scrollRef&#125;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; h-auto&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">svg</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;656&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;108&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">viewBox</span>=<span class="hljs-string">&quot;0 0 656 108&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;w-full text-gray-100&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">     <span class="hljs-tag">&lt;<span class="hljs-name">path</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">d</span>=<span class="hljs-string">&quot;M0 0h656v108H0V0zm0 0h350v12H0V0zm20 32h238v12H20V32zM0 32h12v12H0V32zm0 32h540v12H0V64zm0 32h470v12H0V96z&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">fill</span>=<span class="hljs-string">&quot;currentColor&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">fill-rule</span>=<span class="hljs-string">&quot;evenodd&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="搜索历史记录功能"><a href="#搜索历史记录功能" class="headerlink" title="搜索历史记录功能"></a>搜索历史记录功能</h3><p>知乎原功能<img src="/img/images/2024/1709907989788-bffa1333-9f9f-43bd-87de-0a7103fa7ffe.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="极致的本地存储库封装"><a href="#极致的本地存储库封装" class="headerlink" title="极致的本地存储库封装"></a>极致的本地存储库封装</h4><ol start="78">
<li>新建文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src/utils/store &amp;&amp; touch src/utils/store/index.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="79">
<li>写入如下代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 一个本地存储库</span><br><span class="hljs-comment"> * 1. 初始化时可选择 localStorage、sessionStorage</span><br><span class="hljs-comment"> * 2. 若浏览器出现了异步问题、高频线程问题，也能解决</span><br><span class="hljs-comment"> * 3. 若本地存储有问题，可以降级处理</span><br><span class="hljs-comment"> * 4. 不用自己去解析 json，支持各种数组操作</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 如何讲一个小工具封装到极致（过度设计）</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">CreateStore</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span><br><span class="hljs-params"> unLocal = <span class="hljs-literal">false</span>,</span><br><span class="hljs-params"> maxLength = <span class="hljs-number">30</span>,</span><br><span class="hljs-params"> expireTime = <span class="hljs-literal">NaN</span>,</span><br><span class="hljs-params"></span>) &#123;<br> <span class="hljs-variable language_">this</span>.<span class="hljs-property">unLocal</span> = unLocal;<br> <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxLength</span> = maxLength;<br> <span class="hljs-variable language_">this</span>.<span class="hljs-property">expireTime</span> = expireTime;<br><br> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">observe</span>();<br>&#125;;<br><br><span class="hljs-title class_">CreateStore</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">observe</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br> <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>;<br> <span class="hljs-variable language_">this</span>.<span class="hljs-property">__mock__storage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(<br>  &#123;&#125;,<br>  &#123;<br>   <span class="hljs-title function_">get</span>(<span class="hljs-params">target, propKey, receiver</span>) &#123;<br>    <span class="hljs-keyword">let</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, propKey, receiver);<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">unLocal</span>) &#123;<br>     <span class="hljs-comment">// 存储在本地时，直接 getItem</span><br>     result = (context.<span class="hljs-property">getItem</span> &amp;&amp; context.<span class="hljs-title function_">getItem</span>(propKey)) || <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;<br><br>     <span class="hljs-comment">// if (result !== Reflect.get(target, propKey, receiver)) &#123;</span><br>     <span class="hljs-comment">//  throw new Error(&quot;数据不一致&quot;);</span><br>     <span class="hljs-comment">// &#125;</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> result;<br>   &#125;,<br>   <span class="hljs-title function_">set</span>(<span class="hljs-params">target, propKey, value, receiver</span>) &#123;<br>    <span class="hljs-keyword">let</span> _value = value;<br><br>    <span class="hljs-comment">// 数据处理</span><br>    <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span> &amp;&amp; value.<span class="hljs-property">length</span> &gt; context.<span class="hljs-property">maxLength</span>) &#123;<br>     _value = value.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, context.<span class="hljs-property">maxLength</span>); <span class="hljs-comment">// 截取数据，多余丢弃</span><br>    &#125;<br><br>    <span class="hljs-comment">// 当 unLocal 为 false 时，在合适的时间将数据存储到本地</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">unLocal</span>) &#123;<br>     context.<span class="hljs-property">setItem</span> &amp;&amp; context.<span class="hljs-title function_">setItem</span>(propKey, _value);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, propKey, value, receiver);<br>   &#125;,<br>  &#125;,<br> );<br>&#125;;<br><br><span class="hljs-title class_">CreateStore</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getItem</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">type</span>) &#123;<br> <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;请在浏览器环境下运行&quot;</span>);<br><br> <span class="hljs-comment">// 依赖反转：将操作抽象，不依赖于自己的实现，通过初始化时传入的storageMethod自行实现 getItem</span><br> <span class="hljs-keyword">const</span> data = <span class="hljs-variable language_">window</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageMethod</span>].<span class="hljs-title function_">getItem</span>(type);<br><br> <span class="hljs-keyword">let</span> dataJson;<br> <span class="hljs-keyword">try</span> &#123;<br>  dataJson = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);<br> &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(error);<br> &#125;<br><br> <span class="hljs-keyword">return</span> dataJson;<br>&#125;;<br><br><span class="hljs-title class_">CreateStore</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">setItem</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">type, data</span>) &#123;<br> <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;请在浏览器环境下运行&quot;</span>);<br><br> <span class="hljs-keyword">const</span> dataJson = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data);<br><br> <span class="hljs-comment">// 依赖反转：将操作抽象，不依赖于自己的实现，通过初始化时传入的storageMethod自行实现 setItem</span><br> <span class="hljs-variable language_">window</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">storageMethod</span>].<span class="hljs-title function_">setItem</span>(type, dataJson);<br>&#125;;<br><br><span class="hljs-title class_">CreateStore</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">set</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">type, data</span>) &#123;<br> <span class="hljs-variable language_">this</span>.<span class="hljs-property">__mock__storage</span>[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.key&#125;</span>__<span class="hljs-subst">$&#123;type&#125;</span>`</span>] = data;<br>&#125;;<br><br><span class="hljs-title class_">CreateStore</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">get</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">type</span>) &#123;<br> <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">__mock__storage</span>[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.key&#125;</span>__<span class="hljs-subst">$&#123;type&#125;</span>`</span>];<br>&#125;;<br><br><span class="hljs-comment">// 支持数组的方法</span><br>[<span class="hljs-string">&quot;pop&quot;</span>, <span class="hljs-string">&quot;push&quot;</span>, <span class="hljs-string">&quot;shift&quot;</span>, <span class="hljs-string">&quot;unshift&quot;</span>, <span class="hljs-string">&quot;reverse&quot;</span>, <span class="hljs-string">&quot;splice&quot;</span>].<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">method</span>) =&gt;</span> &#123;<br> <span class="hljs-title class_">CreateStore</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[method] = <span class="hljs-keyword">function</span> (<span class="hljs-params">type, ...rest</span>) &#123;<br>  <span class="hljs-comment">// 当没有数组时，要用数组方法，直接初始化一个空数组</span><br>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>(type)) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(type, []);<br><br>  <span class="hljs-keyword">if</span> ((!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>(type)) <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;必须为数组类型&quot;</span>);<br><br>  <span class="hljs-keyword">const</span> dataList = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>(type);<br>  <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[method].<span class="hljs-title function_">apply</span>(dataList, rest);<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(type, dataList);<br> &#125;;<br>&#125;);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">CreateLocalStorage</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">key, ...rest</span>) &#123;<br> <span class="hljs-title class_">CreateStore</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, rest);<br><br> <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageMethod</span> = <span class="hljs-string">&quot;localStorage&quot;</span>;<br> <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key;<br>&#125;;<br><br><span class="hljs-title class_">CreateLocalStorage</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">CreateStore</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br><span class="hljs-title class_">CreateLocalStorage</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">CreateLocalStorage</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">CreateSessionlStorage</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">key, ...rest</span>) &#123;<br> <span class="hljs-title class_">CreateStore</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, rest);<br><br> <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageMethod</span> = <span class="hljs-string">&quot;sessionlStorage&quot;</span>;<br> <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key;<br>&#125;;<br><br><span class="hljs-title class_">CreateSessionlStorage</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">CreateStore</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br><span class="hljs-title class_">CreateSessionlStorage</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">CreateSessionlStorage</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> localStore = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateLocalStorage</span>(<span class="hljs-string">&quot;local&quot;</span>);<br></code></pre></td></tr></table></figure>

<h5 id="思考：函数与-SDK-的区别"><a href="#思考：函数与-SDK-的区别" class="headerlink" title="思考：函数与 SDK 的区别"></a>思考：函数与 SDK 的区别</h5><p>SDK 一般采用类来写，它的扩展性更强。并且可以自行分层，逻辑隔离更清晰</p>
<h4 id="更改react-master-src-components-search-index-tsx"><a href="#更改react-master-src-components-search-index-tsx" class="headerlink" title="更改react-master/src/components/search/index.tsx"></a>更改<code>react-master/src/components/search/index.tsx</code></h4><p>搜索框支持历史记录、上下箭头选择历史记录</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123;<br> <span class="hljs-title class_">ChangeEventHandler</span>,<br> <span class="hljs-title class_">FocusEventHandler</span>,<br> <span class="hljs-title class_">Fragment</span>,<br> <span class="hljs-title class_">KeyboardEventHandler</span>,<br> useRef,<br> useState,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; localStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../utils/store/index.js&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Search</span>(<span class="hljs-params">&#123;&#125;: Props</span>) &#123;<br> <span class="hljs-keyword">const</span> inputRef = useRef&lt;<span class="hljs-title class_">HTMLInputElement</span>&gt;(<span class="hljs-literal">null</span>);<br><br> <span class="hljs-comment">// 下拉框的数据</span><br> <span class="hljs-keyword">const</span> [relatedList, setRelatedList] = useState&lt;string[]&gt;([]);<br><br> <span class="hljs-comment">// 是否展示下拉框</span><br> <span class="hljs-keyword">const</span> [isShow, setIsShow] = useState&lt;boolean&gt;(<span class="hljs-literal">false</span>);<br><br> <span class="hljs-comment">// 输入框内容</span><br> <span class="hljs-keyword">const</span> [inputValue, setInputValue] = useState&lt;string&gt;(<span class="hljs-string">&quot;&quot;</span>);<br><br> <span class="hljs-comment">// 当前选择的数据下标</span><br> <span class="hljs-keyword">const</span> [selectedIdx, setSelectedIdx] = useState&lt;number&gt;(-<span class="hljs-number">1</span>);<br><br> <span class="hljs-keyword">const</span> <span class="hljs-attr">handleFocus</span>: <span class="hljs-title class_">FocusEventHandler</span>&lt;<span class="hljs-title class_">HTMLInputElement</span>&gt; = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 获取历史记录数据</span><br>  <span class="hljs-title function_">setRelatedList</span>(<br>   <span class="hljs-comment">// @ts-ignore</span><br>   (localStore.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;searchHistoryList&quot;</span>) || [])<br>    .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">setArr: string[], item: string</span>) =&gt;</span> &#123;<br>     <span class="hljs-keyword">return</span> setArr.<span class="hljs-title function_">includes</span>(item) ? setArr : [...setArr, item];<br>    &#125;, [])<br>    .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item: string</span>) =&gt;</span> <span class="hljs-title class_">Boolean</span>(item))<br>    .<span class="hljs-title function_">filter</span>(<br>     <span class="hljs-function">(<span class="hljs-params">item: string</span>) =&gt;</span><br>      !e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> ||<br>      (e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> &amp;&amp; item.<span class="hljs-title function_">includes</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>)),<br>    )<br>    .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>),<br>  );<br><br>  <span class="hljs-title function_">setIsShow</span>(<span class="hljs-literal">true</span>);<br> &#125;;<br><br> <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleBlur</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-title function_">setIsShow</span>(<span class="hljs-literal">false</span>);<br> &#125;;<br><br> <span class="hljs-keyword">const</span> <span class="hljs-attr">handleChangge</span>: <span class="hljs-title class_">ChangeEventHandler</span>&lt;<span class="hljs-title class_">HTMLInputElement</span>&gt; = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>  <span class="hljs-title function_">setInputValue</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);<br>  <span class="hljs-title function_">setSelectedIdx</span>(-<span class="hljs-number">1</span>);<br>  <span class="hljs-title function_">handleFocus</span>(e <span class="hljs-keyword">as</span> any);<br> &#125;;<br><br> <span class="hljs-keyword">const</span> <span class="hljs-attr">handleKeyDown</span>: <span class="hljs-title class_">KeyboardEventHandler</span>&lt;<span class="hljs-title class_">HTMLInputElement</span>&gt; = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ handleKeyDown ] &gt;&quot;</span>);<br>  <span class="hljs-keyword">switch</span> (e.<span class="hljs-property">key</span>) &#123;<br>   <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;Enter&quot;</span>: &#123;<br>    <span class="hljs-comment">// 监听回车事件</span><br>    <span class="hljs-keyword">const</span> currentValue =<br>     selectedIdx !== -<span class="hljs-number">1</span> ? relatedList[selectedIdx] : inputValue;<br><br>    <span class="hljs-comment">// 将值放到输入框内</span><br>    <span class="hljs-title function_">setInputValue</span>(currentValue);<br><br>    <span class="hljs-comment">// @ts-ignore</span><br>    localStore.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">&quot;searchHistoryList&quot;</span>, currentValue);<br><br>    <span class="hljs-title function_">setIsShow</span>(<span class="hljs-literal">false</span>);<br><br>    <span class="hljs-keyword">break</span>;<br>   &#125;<br>   <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;ArrowUp&quot;</span>: &#123;<br>    <span class="hljs-comment">// 监听上箭头事件</span><br>    <span class="hljs-keyword">if</span> (relatedList.<span class="hljs-property">length</span>) &#123;<br>     <span class="hljs-keyword">if</span> (selectedIdx &lt; <span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-title function_">setSelectedIdx</span>(relatedList.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">setSelectedIdx</span>(<span class="hljs-function">(<span class="hljs-params">idx: number</span>) =&gt;</span> idx - <span class="hljs-number">1</span>);<br>     &#125;<br>    &#125;<br>    <span class="hljs-keyword">break</span>;<br>   &#125;<br>   <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;ArrowDown&quot;</span>: &#123;<br>    <span class="hljs-comment">// 监听下箭头事件</span><br>    <span class="hljs-keyword">if</span> (relatedList.<span class="hljs-property">length</span>) &#123;<br>     <span class="hljs-keyword">if</span> (selectedIdx === relatedList.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-title function_">setSelectedIdx</span>(<span class="hljs-number">0</span>);<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">setSelectedIdx</span>(<span class="hljs-function">(<span class="hljs-params">idx: number</span>) =&gt;</span> idx + <span class="hljs-number">1</span>);<br>     &#125;<br>    &#125;<br>    <span class="hljs-keyword">break</span>;<br>   &#125;<br><br>   <span class="hljs-attr">default</span>:<br>    <span class="hljs-keyword">break</span>;<br>  &#125;<br> &#125;;<br><br> <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSearchBtnClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> currentValue = inputValue || inputRef.<span class="hljs-property">current</span>?.<span class="hljs-property">placeholder</span>;<br><br>  <span class="hljs-comment">// 将值放到输入框内</span><br>  <span class="hljs-title function_">setInputValue</span>(currentValue!);<br><br>  <span class="hljs-comment">// @ts-ignore</span><br>  localStore.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">&quot;searchHistoryList&quot;</span>, currentValue);<br><br>  <span class="hljs-title function_">setIsShow</span>(<span class="hljs-literal">false</span>);<br> &#125;;<br><br> <span class="hljs-keyword">return</span> (<br>  <span class="hljs-comment">// Fragment 内置组件，用于在 JSX 中返回多个元素而不必包裹在一个额外的 HTML 元素中。</span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Fragment</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; flex items-center&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">onFocus</span>=<span class="hljs-string">&#123;handleFocus&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">onBlur</span>=<span class="hljs-string">&#123;handleBlur&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleChangge&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">onKeyDown</span>=<span class="hljs-string">&#123;handleKeyDown&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;inputValue&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-98 h-8 border border-gray-100 px-4 rounded-full bg-gray-50&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;福建软考报名入口&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-16 h-8 mx-4 text-sm bg-blue-500 text-white flex justify-center items-center rounded-full hover:bg-blue-800 transition-all&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleSearchBtnClick&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">     提问</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   &#123;relatedList?.length &amp;&amp; isShow ? (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;fixed top-16 w-96 z-10 bg-white border h-auto&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">     <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">left:</span> <span class="hljs-attr">inputRef.current</span>?<span class="hljs-attr">.getBoundingClientRect</span>()?<span class="hljs-attr">.x</span> &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">     &#123;relatedList.map((item, idx) =&gt; &#123;</span><br><span class="language-xml">      return (</span><br><span class="language-xml">       <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;idx&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">mb-2</span> <span class="hljs-attr">last:mb-0</span> <span class="hljs-attr">py-2</span> <span class="hljs-attr">px-4</span> <span class="hljs-attr">hover:bg-gray-100</span> <span class="hljs-attr">cursor-pointer</span> <span class="hljs-attr">flex</span> <span class="hljs-attr">justify-between</span> <span class="hljs-attr">hover:</span>*<span class="hljs-attr">:flex</span> $&#123;<span class="hljs-attr">idx</span> === <span class="hljs-string">selectedIdx</span> ? &quot;<span class="hljs-attr">bg-gray-100</span> <span class="hljs-attr">text-blue-400</span>&quot; <span class="hljs-attr">:</span> &quot;&quot;&#125;`&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">       &gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;item&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-gray-500 text-sm hidden&quot;</span>&gt;</span>X<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      );</span><br><span class="language-xml">     &#125;)&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">   ) : (</span><br><span class="language-xml">    <span class="hljs-tag">&lt;&gt;</span><span class="hljs-tag">&lt;/&gt;</span></span><br>   )&#125;<br>  &lt;/<span class="hljs-title class_">Fragment</span>&gt;<br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="4、组件库开发"><a href="#4、组件库开发" class="headerlink" title="4、组件库开发"></a>4、组件库开发</h1><blockquote>
<p>采用 Rollup 打包，产物为 umd、esm 两种</p>
</blockquote>
<ol start="80">
<li>新建组件库文件夹（进入<code>packages/components</code>内）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir react-x-components<br></code></pre></td></tr></table></figure>

<ol start="81">
<li>初始化该项目（进入<code>packages/component/react-x-components</code>内）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">cd react-x-components &amp;&amp; pnpm init<br></code></pre></td></tr></table></figure>

<ol start="82">
<li>创建两个组件文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src &amp;&amp; mkdir src/button &amp;&amp; touch src/button/index.<span class="hljs-property">tsx</span> &amp;&amp; mkdir src/card &amp;&amp; touch src/card/index.<span class="hljs-property">tsx</span><br></code></pre></td></tr></table></figure>

<ol start="83">
<li><code>src/button/index.tsx</code>写入代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;<br> <span class="hljs-attr">children</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>;<br> onClick?: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span>;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">&#123; children, onClick &#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><br><span class="hljs-tag"><span class="language-xml">   <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onClick&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">   <span class="hljs-attr">className</span>=<span class="hljs-string">&quot; w-16 h-8 mx-4 text-sm bg-blue-500 text-white flex justify-center items-center rounded-full hover:bg-blue-800 transition-all&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  &gt;</span></span><br><span class="language-xml">   &#123;children&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="84">
<li><code>src/card/index.tsx</code>写入代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br>type <span class="hljs-title class_">Props</span> = &#123;<br> className?: string;<br> children?: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Card</span>(<span class="hljs-params">&#123; className, children &#125;: Props</span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">   <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>` <span class="hljs-attr">bg-white</span> <span class="hljs-attr">border</span> <span class="hljs-attr">border-gray-200</span> <span class="hljs-attr">m-2</span> <span class="hljs-attr">rounded-sm</span> <span class="hljs-attr">shadow-md</span> $&#123;<span class="hljs-attr">className</span>&#125;`&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">  &gt;</span></span><br><span class="language-xml">   &#123;children&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br> );<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="手写-Rollup-配置"><a href="#手写-Rollup-配置" class="headerlink" title="手写 Rollup 配置"></a>手写 Rollup 配置</h2><ol start="85">
<li>安装对应依赖（<code>packages/components/react-x-components</code>下）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add rollup rollup-plugin-clear rollup-plugin-auto-add rollup-plugin-typescript2 @rollup/plugin-node-resolve @rollup/plugin-commonjs @rollup/plugin-alias rollup-plugin-peer-deps-external rollup-plugin-filesize rollup-plugin-postcss rollup-plugin-terser rollup-plugin-multi-input postcss typescript react @types/react -D<br></code></pre></td></tr></table></figure>

<ol start="86">
<li>创建对应文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir scripts &amp;&amp; touch scripts/rollup.<span class="hljs-property">config</span>.<span class="hljs-property">js</span> &amp;&amp; touch tsconfig.<span class="hljs-property">json</span> &amp;&amp; touch scripts/tsconfig.<span class="hljs-property">esm</span>.<span class="hljs-property">json</span> &amp;&amp; touch scripts/tsconfig.<span class="hljs-property">umd</span>.<span class="hljs-property">json</span><br></code></pre></td></tr></table></figure>

<ol start="87">
<li><code>tsconfig.json</code>写如下代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br> <span class="hljs-string">&quot;compilerOptions&quot;</span>: &#123;<br>  <span class="hljs-string">&quot;target&quot;</span>: <span class="hljs-string">&quot;ESNext&quot;</span>,<br>  <span class="hljs-string">&quot;useDefineForClassFields&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;lib&quot;</span>: [<span class="hljs-string">&quot;DOM&quot;</span>, <span class="hljs-string">&quot;DOM.Iterable&quot;</span>, <span class="hljs-string">&quot;ESNext&quot;</span>],<br>  <span class="hljs-string">&quot;outDir&quot;</span>: <span class="hljs-string">&quot;./lib&quot;</span>,<br>  <span class="hljs-string">&quot;allowJs&quot;</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-string">&quot;skipLibCheck&quot;</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-string">&quot;esModuleInterop&quot;</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-string">&quot;allowSyntheticDefaultImports&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;strict&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;forceConsistentCasingInFileNames&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;module&quot;</span>: <span class="hljs-string">&quot;ESNext&quot;</span>,<br>  <span class="hljs-string">&quot;moduleResolution&quot;</span>: <span class="hljs-string">&quot;Node&quot;</span>,<br>  <span class="hljs-string">&quot;resolveJsonModule&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;isolatedModules&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;noEmit&quot;</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-string">&quot;jsx&quot;</span>: <span class="hljs-string">&quot;react&quot;</span>, <span class="hljs-comment">// react18这里也可以改成react-jsx</span><br>  <span class="hljs-string">&quot;baseUrl&quot;</span>: <span class="hljs-string">&quot;./&quot;</span>,<br>  <span class="hljs-string">&quot;paths&quot;</span>: &#123;<br>   <span class="hljs-string">&quot;@/*&quot;</span>: [<span class="hljs-string">&quot;src/*&quot;</span>]<br>  &#125;,<br>  <span class="hljs-string">&quot;noImplicitAny&quot;</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 是否在表达式和声明上有隐含的any类型时报错</span><br> &#125;,<br> <span class="hljs-string">&quot;include&quot;</span>: [<span class="hljs-string">&quot;./src/**/*&quot;</span>],<br> <span class="hljs-string">&quot;exclude&quot;</span>: [<span class="hljs-string">&quot;node_modules&quot;</span>, <span class="hljs-string">&quot;**/dist&quot;</span>, <span class="hljs-string">&quot;**/esm&quot;</span>],<br> <span class="hljs-string">&quot;ts-node&quot;</span>: &#123;<br>  <span class="hljs-string">&quot;compilerOptions&quot;</span>: &#123;<br>   <span class="hljs-string">&quot;module&quot;</span>: <span class="hljs-string">&quot;CommonJS&quot;</span><br>  &#125;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="88">
<li><code>scripts/tsconfig.esm.json</code>写如下代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br> <span class="hljs-string">&quot;extends&quot;</span>: <span class="hljs-string">&quot;../tsconfig.json&quot;</span>,<br> <span class="hljs-string">&quot;ts-node&quot;</span>: &#123;<br>  <span class="hljs-string">&quot;transplieOnly&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;require&quot;</span>: [<span class="hljs-string">&quot;typescript-transform-paths/register&quot;</span>]<br> &#125;,<br> <span class="hljs-string">&quot;compilerOptions&quot;</span>: &#123;<br>  <span class="hljs-string">&quot;plugins&quot;</span>: [<br>   &#123; <span class="hljs-string">&quot;transform&quot;</span>: <span class="hljs-string">&quot;typescript-transform-paths&quot;</span> &#125;,<br>   &#123;<br>    <span class="hljs-string">&quot;transform&quot;</span>: <span class="hljs-string">&quot;typescript-transform-paths&quot;</span>,<br>    <span class="hljs-string">&quot;afterDeclarations&quot;</span>: <span class="hljs-literal">true</span><br>   &#125;<br>  ],<br>  <span class="hljs-string">&quot;declaration&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;jsx&quot;</span>: <span class="hljs-string">&quot;react&quot;</span>,<br>  <span class="hljs-string">&quot;jsxFactory&quot;</span>: <span class="hljs-string">&quot;React.createElement&quot;</span>,<br>  <span class="hljs-string">&quot;jsxFragmentFactory&quot;</span>: <span class="hljs-string">&quot;React.Fragment&quot;</span><br> &#125;,<br> <span class="hljs-string">&quot;include&quot;</span>: [<span class="hljs-string">&quot;../src&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="89">
<li><code>scripts/tsconfig.umd.json</code>写如下代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br> <span class="hljs-string">&quot;extends&quot;</span>: <span class="hljs-string">&quot;../tsconfig.json&quot;</span>,<br> <span class="hljs-string">&quot;compilerOptions&quot;</span>: &#123;<br>  <span class="hljs-string">&quot;jsx&quot;</span>: <span class="hljs-string">&quot;react&quot;</span>,<br>  <span class="hljs-string">&quot;jsxFactory&quot;</span>: <span class="hljs-string">&quot;React.createElement&quot;</span>,<br>  <span class="hljs-string">&quot;jsxFragmentFactory&quot;</span>: <span class="hljs-string">&quot;React.Fragment&quot;</span><br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="90">
<li>改造<code>package.json</code>加上<code>peerDependencies</code>告知当前组件库所依赖的包(组件库可不提供)</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;react-x-components&quot;</span>,<br>  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;1.0.0&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;index.js&quot;</span>,<br>  <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;keywords&quot;</span>: [],<br>  <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-string">&quot;license&quot;</span>: <span class="hljs-string">&quot;ISC&quot;</span>,<br>  <span class="hljs-string">&quot;devDependencies&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;@rollup/plugin-alias&quot;</span>: <span class="hljs-string">&quot;^5.1.0&quot;</span>,<br>    <span class="hljs-string">&quot;@rollup/plugin-commonjs&quot;</span>: <span class="hljs-string">&quot;^25.0.7&quot;</span>,<br>    <span class="hljs-string">&quot;@rollup/plugin-node-resolve&quot;</span>: <span class="hljs-string">&quot;^15.2.3&quot;</span>,<br>    <span class="hljs-string">&quot;@types/react&quot;</span>: <span class="hljs-string">&quot;^18.2.64&quot;</span>,<br>    <span class="hljs-string">&quot;postcss&quot;</span>: <span class="hljs-string">&quot;^8.4.35&quot;</span>,<br>    <span class="hljs-string">&quot;react&quot;</span>: <span class="hljs-string">&quot;^18.2.0&quot;</span>,<br>    <span class="hljs-string">&quot;rollup&quot;</span>: <span class="hljs-string">&quot;^4.12.1&quot;</span>,<br>    <span class="hljs-string">&quot;rollup-plugin-auto-add&quot;</span>: <span class="hljs-string">&quot;^0.0.6&quot;</span>,<br>    <span class="hljs-string">&quot;rollup-plugin-clear&quot;</span>: <span class="hljs-string">&quot;^2.0.7&quot;</span>,<br>    <span class="hljs-string">&quot;rollup-plugin-filesize&quot;</span>: <span class="hljs-string">&quot;^10.0.0&quot;</span>,<br>    <span class="hljs-string">&quot;rollup-plugin-multi-input&quot;</span>: <span class="hljs-string">&quot;^1.4.1&quot;</span>,<br>    <span class="hljs-string">&quot;rollup-plugin-peer-deps-external&quot;</span>: <span class="hljs-string">&quot;^2.2.4&quot;</span>,<br>    <span class="hljs-string">&quot;rollup-plugin-postcss&quot;</span>: <span class="hljs-string">&quot;^4.0.2&quot;</span>,<br>    <span class="hljs-string">&quot;rollup-plugin-terser&quot;</span>: <span class="hljs-string">&quot;^7.0.2&quot;</span>,<br>    <span class="hljs-string">&quot;rollup-plugin-typescript2&quot;</span>: <span class="hljs-string">&quot;^0.36.0&quot;</span>,<br>    <span class="hljs-string">&quot;typescript&quot;</span>: <span class="hljs-string">&quot;^5.4.2&quot;</span><br>  &#125;<br>  <span class="hljs-string">&quot;peerDependencies&quot;</span>: &#123; <span class="hljs-comment">// ++++++</span><br>    <span class="hljs-string">&quot;react&quot;</span>: <span class="hljs-string">&quot;^18.2.0&quot;</span>, <span class="hljs-comment">// ++++++</span><br>    <span class="hljs-string">&quot;react-dom&quot;</span>: <span class="hljs-string">&quot;^18.2.0&quot;</span> <span class="hljs-comment">// ++++++</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="91">
<li>手写配置代码<code>scripts/rollup.config.js</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> clear = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;rollup-plugin-clear&quot;</span>);<br><span class="hljs-keyword">const</span> autoAdd = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;rollup-plugin-auto-add&quot;</span>).<span class="hljs-property">default</span>;<br><span class="hljs-keyword">const</span> multiInput = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;rollup-plugin-multi-input&quot;</span>).<span class="hljs-property">default</span>;<br><span class="hljs-keyword">const</span> typescript = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;rollup-plugin-typescript2&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> peerDepExternal = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;rollup-plugin-peer-deps-external&quot;</span>);<br><span class="hljs-keyword">const</span> resolve = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@rollup/plugin-node-resolve&quot;</span>);<br><span class="hljs-keyword">const</span> commonjs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@rollup/plugin-commonjs&quot;</span>);<br><span class="hljs-keyword">const</span> alias = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@rollup/plugin-alias&quot;</span>);<br><span class="hljs-keyword">const</span> postcss = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;rollup-plugin-postcss&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; terser &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;rollup-plugin-terser&quot;</span>);<br><span class="hljs-keyword">const</span> filesize = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;rollup-plugin-filesize&quot;</span>);<br><br><span class="hljs-keyword">const</span> pkg = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../package.json&quot;</span>);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = [<br> <span class="hljs-comment">// 打包成 esm 的配置项</span><br> &#123;<br>  <span class="hljs-attr">input</span>: <span class="hljs-string">&quot;src/**/*&quot;</span>,<br>  <span class="hljs-attr">output</span>: [<br>   &#123;<br>    <span class="hljs-attr">dir</span>: <span class="hljs-string">&quot;esm&quot;</span>,<br>    <span class="hljs-attr">format</span>: <span class="hljs-string">&quot;esm&quot;</span>,<br>    <span class="hljs-attr">sourceMap</span>: <span class="hljs-literal">false</span>,<br>   &#125;,<br>  ],<br><br>  <span class="hljs-comment">// 打包时排除 peerDenpendencies 里面的依赖</span><br>  <span class="hljs-attr">enternal</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(pkg.<span class="hljs-property">peerDenpendencies</span> || &#123;&#125;),<br><br>  <span class="hljs-attr">plugins</span>: [<br>   <span class="hljs-comment">// 自动清除生成代码</span><br>   <span class="hljs-title function_">clear</span>(&#123; <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;esm&quot;</span> &#125;),<br><br>   <span class="hljs-comment">// 自动注入代码</span><br>   <span class="hljs-title function_">autoAdd</span>(&#123;<br>    <span class="hljs-comment">// 匹配这种 src/myComponent/index.tsx</span><br>    <span class="hljs-attr">include</span>: [<span class="hljs-regexp">/src\/(((?!\/).)+?)\/index\.tsx/gi</span>],<br>   &#125;),<br><br>   <span class="hljs-comment">// 多入口</span><br>   <span class="hljs-title function_">multiInput</span>(),<br><br>   <span class="hljs-comment">// 解析 ts</span><br>   <span class="hljs-title function_">typescript</span>(&#123;<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./tsconfig.esm.json&quot;</span>),<br>   &#125;),<br>   <span class="hljs-title function_">peerDepExternal</span>(),<br>   <span class="hljs-title function_">resolve</span>(), <span class="hljs-comment">// 处理 node_modules</span><br>   <span class="hljs-title function_">commonjs</span>(), <span class="hljs-comment">// 处理 commonjs</span><br>   <span class="hljs-title function_">filesize</span>(), <span class="hljs-comment">// 处理包体积</span><br>   <span class="hljs-title function_">postcss</span>(&#123;<br>    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">sourceMap</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">extensions</span>: [<span class="hljs-string">&quot;.less&quot;</span>, <span class="hljs-string">&quot;.css&quot;</span>],<br>    <span class="hljs-attr">use</span>: [<span class="hljs-string">&quot;less&quot;</span>],<br>   &#125;),<br>   <span class="hljs-comment">// 文件声明</span><br>   <span class="hljs-title function_">alias</span>(&#123;<br>    <span class="hljs-attr">entries</span>: &#123;<br>     <span class="hljs-string">&quot;@&quot;</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../src&quot;</span>),<br>    &#125;,<br>   &#125;),<br>  ],<br> &#125;,<br><br> <span class="hljs-comment">// 打包成 umd 的配置项</span><br> &#123;<br>  <span class="hljs-attr">input</span>: <span class="hljs-string">&quot;src/index.tsx&quot;</span>,<br>  <span class="hljs-attr">output</span>: [<br>   &#123;<br>    <span class="hljs-attr">dir</span>: <span class="hljs-string">&quot;dist&quot;</span>,<br>    <span class="hljs-attr">format</span>: <span class="hljs-string">&quot;umd&quot;</span>,<br>    <span class="hljs-attr">exports</span>: <span class="hljs-string">&quot;named&quot;</span>,<br>    <span class="hljs-attr">name</span>: pkg.<span class="hljs-property">name</span>,<br>    <span class="hljs-attr">sourceMap</span>: <span class="hljs-literal">true</span>,<br>   &#125;,<br>  ],<br><br>  <span class="hljs-comment">// 打包时排除 peerDenpendencies 里面的依赖</span><br>  <span class="hljs-attr">enternal</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(pkg.<span class="hljs-property">peerDenpendencies</span> || &#123;&#125;),<br><br>  <span class="hljs-attr">plugins</span>: [<br>   <span class="hljs-comment">// 自动清除生成代码</span><br>   <span class="hljs-title function_">clear</span>(&#123; <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;dist&quot;</span> &#125;),<br><br>   <span class="hljs-comment">// 自动注入代码</span><br>   <span class="hljs-title function_">autoAdd</span>(&#123;<br>    <span class="hljs-comment">// 匹配这种 src/myComponent/index.tsx</span><br>    <span class="hljs-attr">include</span>: [<span class="hljs-regexp">/src\/(((?!\/).)+?)\/index\.tsx/gi</span>],<br>   &#125;),<br><br>   <span class="hljs-comment">// 多入口</span><br>   <span class="hljs-title function_">multiInput</span>(),<br><br>   <span class="hljs-comment">// 解析 ts</span><br>   <span class="hljs-title function_">typescript</span>(&#123;<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;./tsconfig.dist.json&quot;</span>),<br>   &#125;),<br>   <span class="hljs-title function_">peerDepExternal</span>(),<br>   <span class="hljs-title function_">resolve</span>(), <span class="hljs-comment">// 处理 node_modules</span><br>   <span class="hljs-title function_">commonjs</span>(), <span class="hljs-comment">// 处理 commonjs</span><br>   <span class="hljs-title function_">filesize</span>(), <span class="hljs-comment">// 处理包体积</span><br>   <span class="hljs-title function_">postcss</span>(&#123;<br>    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">sourceMap</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">extensions</span>: [<span class="hljs-string">&quot;.less&quot;</span>, <span class="hljs-string">&quot;.css&quot;</span>],<br>    <span class="hljs-attr">use</span>: [<span class="hljs-string">&quot;less&quot;</span>],<br>   &#125;),<br>   <span class="hljs-comment">// 文件声明</span><br>   <span class="hljs-title function_">alias</span>(&#123;<br>    <span class="hljs-attr">entries</span>: &#123;<br>     <span class="hljs-string">&quot;@&quot;</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;../src&quot;</span>),<br>    &#125;,<br>   &#125;),<br>  ],<br> &#125;,<br>];<br></code></pre></td></tr></table></figure>

<ol start="92">
<li>改造<code>package.json</code>加上打包命令</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  ....<br><br>  <span class="hljs-attr">scripts</span>: &#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,<br>    <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;rollup --config ./scripts/rollup.config.js&quot;</span> <span class="hljs-comment">// ++++++</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="93">
<li>新建<code>index.tsx</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch src/index.<span class="hljs-property">tsx</span><br><br><span class="hljs-comment">// 写如下代码：</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./button&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Card</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./card&quot;</span>;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Button</span>, <span class="hljs-title class_">Card</span> &#125;;<br></code></pre></td></tr></table></figure>

<ol start="94">
<li>运行<code>pnpm build</code>，进行打包</li>
</ol>
<p><img src="/img/images/2024/1709986358134-eaa5ec99-b7ba-43b1-91d1-d0a894096169.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="改造一些，给内部项目使用"><a href="#改造一些，给内部项目使用" class="headerlink" title="改造一些，给内部项目使用"></a>改造一些，给内部项目使用</h2><ol start="95">
<li>改造<code>package.json</code>，看变更</li>
</ol>
<p><img src="/img/images/2024/1709986689318-e10a86c7-029a-4b63-b4c4-b89a01be1f3f.png" srcset="/img/loading.gif" lazyload></p>
<ol start="96">
<li>内部项目安装它，进入<code>apps/react-master</code>内，运行安装命令</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add @hzq/react-x-components<br></code></pre></td></tr></table></figure>

<ol start="97">
<li>在项目中引入并使用</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Button</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@hzq/react-x-components&quot;</span>;<br><br><span class="hljs-comment">// ....</span><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>提问111<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>效果如下：<br><img src="/img/images/2024/1709986995270-496c3d22-2c31-4dae-b595-71d35eab1115.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="组件使用流程讲解"><a href="#组件使用流程讲解" class="headerlink" title="组件使用流程讲解"></a>组件使用流程讲解</h2><p><img src="/img/images/2024/1709988965134-32ee7252-b78f-48a3-b54b-a4341d13a5b3.jpeg" srcset="/img/loading.gif" lazyload><br>若需要实时使用组件，则可以如下处理：<br>1、改造组件项目的<code>package.json</code>，然后运行<code>pnpm dev</code>这样就是边开发边打包，能达到“实时”</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  .......<br><br>  <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;src/index.tsx&quot;</span>, <span class="hljs-comment">// ++++++</span><br><br>  <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,<br>    <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;rollup --config ./scripts/rollup.config.js&quot;</span>,<br>    <span class="hljs-string">&quot;dev&quot;</span>: <span class="hljs-string">&quot;rollup --config ./scripts/rollup.config.js -w&quot;</span> <span class="hljs-comment">// ++++++</span><br>  &#125;,<br><br>  ......<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2、改造组件项目的<code>package.json</code>，这样直接使用组件源码，也能达到“实时”</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  .......<br><br>  <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;src/index.tsx&quot;</span>, <span class="hljs-comment">// ++++++</span><br><br>  .......<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="5、插件封装"><a href="#5、插件封装" class="headerlink" title="5、插件封装"></a>5、插件封装</h1><h2 id="微内核架构"><a href="#微内核架构" class="headerlink" title="微内核架构"></a>微内核架构</h2><blockquote>
<p>抽象不依赖实现</p>
</blockquote>
<p>提供一个内核（core&#x2F;engine），内核本身具有很强的扩展性，但内核不会因为有了一个扩展，就去修改内核自身<br>外部可通过插件（plugin）的形式往内核注入，然后内核去驱动插件的执行（plugins.run()）<br>前端界常见的有：Webpack、Babel 等</p>
<p>核心伪代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> events = &#123;&#125;;<br><br><span class="hljs-keyword">const</span> typeEnum = [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;mount&quot;</span>, <span class="hljs-string">&quot;distory&quot;</span>];<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Core</span> &#123;<br> context = &#123;&#125;;<br><br> defaultOpts = &#123;<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;beforeCreate&quot;</span>);<br>  &#125;,<br>  <span class="hljs-title function_">created</span>(<span class="hljs-params"></span>) &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;created&quot;</span>);<br>  &#125;,<br><br>  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params"></span>) &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;beforeMount&quot;</span>);<br>  &#125;,<br>  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mounted&quot;</span>);<br>  &#125;,<br><br>  <span class="hljs-title function_">beforeDistory</span>(<span class="hljs-params"></span>) &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;beforeDistory&quot;</span>);<br>  &#125;,<br>  <span class="hljs-title function_">distoryed</span>(<span class="hljs-params"></span>) &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;distoryed&quot;</span>);<br>  &#125;,<br> &#125;;<br><br> <span class="hljs-title function_">constructor</span>(<span class="hljs-params">opts</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span> = &#123; ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultOpts</span>, ...opts &#125;;<br> &#125;<br><br> <span class="hljs-title function_">addPlugin</span>(<span class="hljs-params">&#123; type, run &#125;</span>) &#123;<br>  events[type] = events[type] || [];<br>  events[type].<span class="hljs-title function_">push</span>(run);<br> &#125;<br><br> <span class="hljs-title function_">pluginsRun</span>(<span class="hljs-params">type</span>) &#123;<br>  events[type].<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>));<br> &#125;<br><br> <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-title function_">beforeCreate</span>(); <span class="hljs-comment">// 模拟生命周期</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pluginsRun</span>(<span class="hljs-string">&quot;create&quot;</span>);<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-title function_">created</span>(); <span class="hljs-comment">// 模拟生命周期</span><br><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-title function_">beforeMount</span>(); <span class="hljs-comment">// 模拟生命周期</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pluginsRun</span>(<span class="hljs-string">&quot;mount&quot;</span>);<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-title function_">mounted</span>(); <span class="hljs-comment">// 模拟生命周期</span><br> &#125;<br><br> <span class="hljs-title function_">end</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-title function_">beforeDistory</span>(); <span class="hljs-comment">// 模拟生命周期</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pluginsRun</span>(<span class="hljs-string">&quot;distory&quot;</span>);<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">opts</span>.<span class="hljs-title function_">distoryd</span>(); <span class="hljs-comment">// 模拟生命周期</span><br> &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Core</span>;<br><br><span class="hljs-comment">// 用户使用</span><br><span class="hljs-keyword">const</span> core = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Core</span>(&#123;<br> <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ this is my beforeCreate] &gt;&quot;</span>);<br> &#125;,<br> <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ this is my mounted] &gt;&quot;</span>);<br> &#125;,<br> <span class="hljs-comment">// ......</span><br>&#125;);<br><br>core.<span class="hljs-title function_">addPlugin</span>(&#123;<br> <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;create&quot;</span>,<br> <span class="hljs-title function_">run</span>(<span class="hljs-params">context</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ create run 1 ] &gt;&quot;</span>);<br>  context.<span class="hljs-property">xxxx</span> = <span class="hljs-string">&quot;xxxx&quot;</span>;<br> &#125;,<br>&#125;);<br><br>core.<span class="hljs-title function_">addPlugin</span>(&#123;<br> <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;create&quot;</span>,<br> <span class="hljs-title function_">run</span>(<span class="hljs-params">context</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ create run 2 ] &gt;&quot;</span>);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ create run 2 context ] &gt;&quot;</span>, context);<br>  context.<span class="hljs-property">yyyy</span> = <span class="hljs-string">&quot;yyyy&quot;</span>;<br> &#125;,<br>&#125;);<br><br>core.<span class="hljs-title function_">addPlugin</span>(&#123;<br> <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;mount&quot;</span>,<br> <span class="hljs-title function_">run</span>(<span class="hljs-params">context</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ mount context ] &gt;&quot;</span>, context);<br> &#125;,<br>&#125;);<br><br>core.<span class="hljs-title function_">start</span>();<br></code></pre></td></tr></table></figure>

<h2 id="Webpack：zipPlugin-插件封装（apps-react-master-下）"><a href="#Webpack：zipPlugin-插件封装（apps-react-master-下）" class="headerlink" title="Webpack：zipPlugin 插件封装（apps&#x2F;react-master 下）"></a>Webpack：zipPlugin 插件封装（apps&#x2F;react-master 下）</h2><blockquote>
<p>功能描述：将打包的东西压缩成一个包</p>
</blockquote>
<ol start="98">
<li>安装前置依赖</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add jszip webpack-sources -D<br></code></pre></td></tr></table></figure>

<ol start="99">
<li>新建对应文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch zipPlugin.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="100">
<li>编写代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">JSzip</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;jszip&quot;</span>); <span class="hljs-comment">// 引入jszip</span><br><br><span class="hljs-comment">// RawSource 是其中一种 “源码”(&quot;sources&quot;) 类型，</span><br><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">RawSource</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack-sources&quot;</span>);<br><br><span class="hljs-comment">// 自定义插件 官方文档：https://webpack.docschina.org/contribute/writing-a-plugin/#creating-a-plugin</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ZipPlugin</span> &#123;<br> <span class="hljs-keyword">static</span> defaultOptions = &#123;<br>  <span class="hljs-attr">outputFile</span>: <span class="hljs-string">&quot;dist.zip&quot;</span>,<br> &#125;;<br><br> <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = &#123; ...<span class="hljs-title class_">ZipPlugin</span>.<span class="hljs-property">defaultOptions</span>, ...options &#125;;<br> &#125;<br><br> <span class="hljs-comment">// 在插件函数的 prototype 上定义一个 `apply` 方法，以 compiler 为参数。</span><br> <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>  <span class="hljs-keyword">const</span> pluginName = <span class="hljs-title class_">ZipPlugin</span>.<span class="hljs-property">name</span>;<br><br>  compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tapAsync</span>(pluginName, <span class="hljs-function">(<span class="hljs-params">compilation, callback</span>) =&gt;</span> &#123;<br>   <span class="hljs-keyword">const</span> zip = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSzip</span>();<br><br>   <span class="hljs-comment">// 遍历所有资源</span><br>   <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(compilation.<span class="hljs-property">assets</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">filename</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> source = compilation.<span class="hljs-property">assets</span>[filename].<span class="hljs-title function_">source</span>();<br><br>    zip.<span class="hljs-title function_">file</span>(filename, source); <span class="hljs-comment">// 添加文件到 zip</span><br>   &#125;);<br><br>   <span class="hljs-comment">// generateAsync：生成 zip 文件</span><br>   zip.<span class="hljs-title function_">generateAsync</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;nodebuffer&quot;</span> &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">content</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 向 compilation 添加新的资源，这样 webpack 就会自动生成并输出到 outputFile 目录</span><br>    compilation.<span class="hljs-title function_">emitAsset</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">outputFile</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">RawSource</span>(content));<br>    <span class="hljs-title function_">callback</span>(); <span class="hljs-comment">// 告诉 webpack 插件已经完成</span><br>   &#125;);<br>  &#125;);<br> &#125;<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123; <span class="hljs-title class_">ZipPlugin</span> &#125;;<br></code></pre></td></tr></table></figure>

<ol start="101">
<li>更改<code>react-master/scripts/webpack.prod.js</code>（看变更）</li>
</ol>
<p><img src="/img/images/2024/1709996553038-373492a4-3de1-4527-905c-b1c81779455b.png" srcset="/img/loading.gif" lazyload></p>
<ol start="102">
<li>运行<code>pnpm build</code>，生成的<code>dist</code>里面就会有个<code>dist.zip</code>，解压后就是整个<code>dist</code></li>
</ol>
<p><img src="/img/images/2024/1709996605391-dbc0a0f7-f1be-4d4e-8977-e9e4fb4201d8.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="Babel：consolePlugin-插件封装（apps-react-master-下）"><a href="#Babel：consolePlugin-插件封装（apps-react-master-下）" class="headerlink" title="Babel：consolePlugin 插件封装（apps&#x2F;react-master 下）"></a>Babel：consolePlugin 插件封装（apps&#x2F;react-master 下）</h2><blockquote>
<p>功能描述：在调试模式下，将 console.log() 丰富，支持打印具体位置：行数、列数</p>
</blockquote>
<ol start="103">
<li>安装前置依赖</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add @babel/generator -D<br></code></pre></td></tr></table></figure>

<ol start="104">
<li>新建对应文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch consolePlugin.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="105">
<li>编写代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> generator = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/generator&quot;</span>).<span class="hljs-property">default</span>;<br><br><span class="hljs-comment">// Babel 自定义插件官方文档：https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md#toc-writing-your-first-babel-plugin</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">consolePlugin</span>(<span class="hljs-params">&#123; types &#125;</span>) &#123;<br> <span class="hljs-keyword">return</span> &#123;<br>  <span class="hljs-attr">visitor</span>: &#123;<br>   <span class="hljs-title class_">CallExpression</span>(path) &#123;<br>    <span class="hljs-keyword">const</span> name = <span class="hljs-title function_">generator</span>(path.<span class="hljs-property">node</span>.<span class="hljs-property">callee</span>).<span class="hljs-property">code</span>;<br><br>    <span class="hljs-keyword">if</span> ([<span class="hljs-string">&quot;console.log&quot;</span>, <span class="hljs-string">&quot;console.info&quot;</span>, <span class="hljs-string">&quot;console.error&quot;</span>].<span class="hljs-title function_">includes</span>(name)) &#123;<br>     <span class="hljs-keyword">const</span> &#123; line, column &#125; = path.<span class="hljs-property">node</span>.<span class="hljs-property">loc</span>.<span class="hljs-property">start</span>;<br>     path.<span class="hljs-property">node</span>.<span class="hljs-property">arguments</span>.<span class="hljs-title function_">unshift</span>(<br>      types.<span class="hljs-title function_">stringLiteral</span>(<span class="hljs-string">`fliepath: <span class="hljs-subst">$&#123;line&#125;</span>:<span class="hljs-subst">$&#123;column&#125;</span>`</span>),<br>     );<br>    &#125;<br>   &#125;,<br>  &#125;,<br> &#125;;<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = consolePlugin;<br></code></pre></td></tr></table></figure>

<ol start="106">
<li>使用插件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br> <span class="hljs-string">&quot;presets&quot;</span>: [<br>  <span class="hljs-string">&quot;@babel/preset-react&quot;</span>, <span class="hljs-comment">// 解析 react</span><br>  <span class="hljs-string">&quot;@babel/preset-typescript&quot;</span> <span class="hljs-comment">// 解析 typescript</span><br> ],<br> <span class="hljs-string">&quot;plugins&quot;</span>: [<span class="hljs-string">&quot;./consolePlugin.js&quot;</span>] <span class="hljs-comment">// ++++++</span><br>&#125;<br><br></code></pre></td></tr></table></figure>

<ol start="107">
<li>重新启动项目<code>pnpm start</code>，写一个<code>console.log(xx)</code>并打印出来，可以看有行数、列数了</li>
</ol>
<p><img src="/img/images/2024/1709998714466-58a11c81-bbcc-473a-be69-5f502fc27935.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="Postcss-插件：themePlugin（apps-react-master-下）"><a href="#Postcss-插件：themePlugin（apps-react-master-下）" class="headerlink" title="Postcss 插件：themePlugin（apps&#x2F;react-master 下）"></a>Postcss 插件：themePlugin（apps&#x2F;react-master 下）</h2><blockquote>
<p>主要功能：实现网站主题色切换</p>
</blockquote>
<h3 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h3><p>先展示基于<code>tailwindcss</code>实现的最朴实的颜色切换</p>
<ol start="108">
<li>更改<code>tailwind.config.js</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/** <span class="hljs-doctag">@type</span> &#123;<span class="hljs-type">import(&#x27;tailwindcss&#x27;).Config</span>&#125; */</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br> <span class="hljs-attr">content</span>: [<span class="hljs-string">&quot;./src/**/*.&#123;tsx,ts,jsx,js&#125;&quot;</span>],<br> <span class="hljs-attr">theme</span>: &#123;<br>  <span class="hljs-attr">extend</span>: &#123;&#125;,<br>  <span class="hljs-attr">colors</span>: &#123; <span class="hljs-comment">// +++ 下面的为新增的 +++</span><br>   <span class="hljs-comment">// 将默认的颜色改为变量</span><br>   <span class="hljs-attr">white</span>: <span class="hljs-string">&quot;var(--color-white)&quot;</span>,<br>   <span class="hljs-attr">black</span>: <span class="hljs-string">&quot;var(--color-black)&quot;</span>,<br>   <span class="hljs-attr">gray</span>: &#123;<br>    <span class="hljs-number">50</span>: <span class="hljs-string">&quot;var(--color-gray-50)&quot;</span>,<br>    <span class="hljs-number">100</span>: <span class="hljs-string">&quot;var(--color-gray-100)&quot;</span>,<br>    <span class="hljs-number">200</span>: <span class="hljs-string">&quot;var(--color-gray-200)&quot;</span>,<br>    <span class="hljs-number">300</span>: <span class="hljs-string">&quot;var(--color-gray-300)&quot;</span>,<br>    <span class="hljs-number">400</span>: <span class="hljs-string">&quot;var(--color-gray-400)&quot;</span>,<br>    <span class="hljs-number">500</span>: <span class="hljs-string">&quot;var(--color-gray-500)&quot;</span>,<br>    <span class="hljs-number">600</span>: <span class="hljs-string">&quot;var(--color-gray-600)&quot;</span>,<br>    <span class="hljs-number">700</span>: <span class="hljs-string">&quot;var(--color-gray-700)&quot;</span>,<br>    <span class="hljs-number">800</span>: <span class="hljs-string">&quot;var(--color-gray-800)&quot;</span>,<br>    <span class="hljs-number">900</span>: <span class="hljs-string">&quot;var(--color-gray-900)&quot;</span>,<br>    <span class="hljs-number">950</span>: <span class="hljs-string">&quot;var(--color-gray-950)&quot;</span>,<br>   &#125;,<br>  &#125;,<br> &#125;,<br> <span class="hljs-attr">plugins</span>: [],<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="109">
<li>更改<code>index.less</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 全局的东西</span><br><br><span class="hljs-comment">// tailwind 配置</span><br>@tailwind base;<br>@tailwind components;<br>@tailwind utilities;<br><br><span class="hljs-comment">// 明亮模式</span><br>html &#123;<br> --color-<span class="hljs-attr">white</span>: #fff;<br> --color-<span class="hljs-attr">black</span>: #<span class="hljs-number">000</span>;<br> --color-gray-<span class="hljs-number">50</span>: #f9fafb;<br> --color-gray-<span class="hljs-number">100</span>: #f3f4f6;<br> --color-gray-<span class="hljs-number">200</span>: #e5e7eb;<br> --color-gray-<span class="hljs-number">300</span>: #d1d5db;<br> --color-gray-<span class="hljs-number">400</span>: #9ca3af;<br> --color-gray-<span class="hljs-number">500</span>: #6b7280;<br> --color-gray-<span class="hljs-number">600</span>: #4b5563;<br> --color-gray-<span class="hljs-number">700</span>: #<span class="hljs-number">374151</span>;<br> --color-gray-<span class="hljs-number">800</span>: #1f2937;<br> --color-gray-<span class="hljs-number">900</span>: #<span class="hljs-number">111827</span>;<br> --color-gray-<span class="hljs-number">950</span>: #<span class="hljs-number">030712</span>;<br>&#125;<br><br><span class="hljs-comment">// 深色模式</span><br>html[data-theme=<span class="hljs-string">&quot;dark&quot;</span>] &#123;<br> --color-<span class="hljs-attr">white</span>: #<span class="hljs-number">000</span>;<br> --color-<span class="hljs-attr">black</span>: #fff;<br> --color-gray-<span class="hljs-number">950</span>: #f9fafb;<br> --color-gray-<span class="hljs-number">900</span>: #f3f4f6;<br> --color-gray-<span class="hljs-number">800</span>: #e5e7eb;<br> --color-gray-<span class="hljs-number">700</span>: #d1d5db;<br> --color-gray-<span class="hljs-number">600</span>: #9ca3af;<br> --color-gray-<span class="hljs-number">500</span>: #6b7280;<br> --color-gray-<span class="hljs-number">400</span>: #4b5563;<br> --color-gray-<span class="hljs-number">300</span>: #<span class="hljs-number">374151</span>;<br> --color-gray-<span class="hljs-number">200</span>: #1f2937;<br> --color-gray-<span class="hljs-number">100</span>: #<span class="hljs-number">111827</span>;<br> --color-gray-<span class="hljs-number">50</span>: #<span class="hljs-number">030712</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="110">
<li>更改<code>react-master/src/components/navigation/index.tsx</code>，增加一个主题切换操作，看 <a target="_blank" rel="noopener" href="https://github.com/MrHzq/react-actual-combat/commit/75beaa5197a3783f80d6ec56bbedbd7c33b2846b">mr</a></li>
<li>切换之前</li>
</ol>
<p><img src="/img/images/2024/1710037354065-18fd812f-ffd2-4a8d-a365-a9bdb19945ce.png" srcset="/img/loading.gif" lazyload></p>
<ol start="112">
<li>切换之后</li>
</ol>
<p><img src="/img/images/2024/1710037395779-8ca17af8-e5e1-452f-8979-d4725ee3644a.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="基于插件"><a href="#基于插件" class="headerlink" title="基于插件"></a>基于插件</h3><p>基本功能完成后，会发现我们的主题变量需要手动去维护，当主题多了就麻烦了，现在就可以写插件来处理</p>
<blockquote>
<p>色卡：主题需要设计时提供一系列对应的颜色值，明亮、暗黑、xx 一套</p>
</blockquote>
<p>在前端可以这样去维护：</p>
<ol start="113">
<li>新建色卡文件，就是之前<code>index.less</code>里面写 css 代码，改成 js 代码而已</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch themeGroup.<span class="hljs-property">js</span><br><br><span class="hljs-comment">// 写如下代码</span><br><span class="hljs-keyword">const</span> themeGroup = &#123;<br> <span class="hljs-attr">light</span>: &#123;<br>  <span class="hljs-string">&quot;--color-white&quot;</span>: <span class="hljs-string">&quot;#fff&quot;</span>,<br>  <span class="hljs-string">&quot;--color-black&quot;</span>: <span class="hljs-string">&quot;#000&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-50&quot;</span>: <span class="hljs-string">&quot;#f9fafb&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-100&quot;</span>: <span class="hljs-string">&quot;#f3f4f6&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-200&quot;</span>: <span class="hljs-string">&quot;#e5e7eb&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-300&quot;</span>: <span class="hljs-string">&quot;#d1d5db&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-400&quot;</span>: <span class="hljs-string">&quot;#9ca3af&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-500&quot;</span>: <span class="hljs-string">&quot;#6b7280&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-600&quot;</span>: <span class="hljs-string">&quot;#4b5563&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-700&quot;</span>: <span class="hljs-string">&quot;#374151&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-800&quot;</span>: <span class="hljs-string">&quot;#1f2937&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-900&quot;</span>: <span class="hljs-string">&quot;#111827&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-950&quot;</span>: <span class="hljs-string">&quot;#030712&quot;</span>,<br> &#125;,<br> <span class="hljs-attr">dark</span>: &#123;<br>  <span class="hljs-string">&quot;--color-white&quot;</span>: <span class="hljs-string">&quot;#000&quot;</span>,<br>  <span class="hljs-string">&quot;--color-black&quot;</span>: <span class="hljs-string">&quot;#fff&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-950&quot;</span>: <span class="hljs-string">&quot;#f9fafb&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-900&quot;</span>: <span class="hljs-string">&quot;#f3f4f6&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-800&quot;</span>: <span class="hljs-string">&quot;#e5e7eb&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-700&quot;</span>: <span class="hljs-string">&quot;#d1d5db&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-600&quot;</span>: <span class="hljs-string">&quot;#9ca3af&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-500&quot;</span>: <span class="hljs-string">&quot;#6b7280&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-400&quot;</span>: <span class="hljs-string">&quot;#4b5563&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-300&quot;</span>: <span class="hljs-string">&quot;#374151&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-200&quot;</span>: <span class="hljs-string">&quot;#1f2937&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-100&quot;</span>: <span class="hljs-string">&quot;#111827&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-50&quot;</span>: <span class="hljs-string">&quot;#030712&quot;</span>,<br> &#125;,<br> <span class="hljs-attr">green</span>: &#123;<br>  <span class="hljs-string">&quot;--color-white&quot;</span>: <span class="hljs-string">&quot;#14532d&quot;</span>,<br>  <span class="hljs-string">&quot;--color-black&quot;</span>: <span class="hljs-string">&quot;#f0fdf4&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-50&quot;</span>: <span class="hljs-string">&quot;#f0fdf4&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-100&quot;</span>: <span class="hljs-string">&quot;#dcfce7&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-200&quot;</span>: <span class="hljs-string">&quot;#bbf7d0&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-300&quot;</span>: <span class="hljs-string">&quot;#86efac&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-400&quot;</span>: <span class="hljs-string">&quot;#4ade80&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-500&quot;</span>: <span class="hljs-string">&quot;#22c55e&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-600&quot;</span>: <span class="hljs-string">&quot;#16a34a&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-700&quot;</span>: <span class="hljs-string">&quot;#15803d&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-800&quot;</span>: <span class="hljs-string">&quot;#166534&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-900&quot;</span>: <span class="hljs-string">&quot;#14532d&quot;</span>,<br>  <span class="hljs-string">&quot;--color-gray-950&quot;</span>: <span class="hljs-string">&quot;#052e16&quot;</span>,<br> &#125;,<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123; themeGroup, <span class="hljs-attr">defaultTheme</span>: <span class="hljs-string">&quot;green&quot;</span> &#125;;<br></code></pre></td></tr></table></figure>

<ol start="114">
<li>删除<code>index.less</code>里面的颜色配置</li>
<li>更改<code>tailwind.config.js</code>，将<code>var</code>改为<code>hzqTheme</code>，最后实现效果是将<code>color:hzqTheme(--color-white)</code>通过插件变为<code>color:#fff</code>，这样就完成了插件的功能</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/** <span class="hljs-doctag">@type</span> &#123;<span class="hljs-type">import(&#x27;tailwindcss&#x27;).Config</span>&#125; */</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br> <span class="hljs-attr">content</span>: [<span class="hljs-string">&quot;./src/**/*.&#123;tsx,ts,jsx,js&#125;&quot;</span>],<br> <span class="hljs-attr">theme</span>: &#123;<br>  <span class="hljs-attr">extend</span>: &#123;&#125;,<br>  <span class="hljs-attr">colors</span>: &#123;<br>   <span class="hljs-comment">// 将默认的颜色改为变量</span><br>   <span class="hljs-attr">white</span>: <span class="hljs-string">&quot;hzqTheme(--color-white)&quot;</span>,<br>   <span class="hljs-attr">black</span>: <span class="hljs-string">&quot;hzqTheme(--color-black)&quot;</span>,<br>   <span class="hljs-attr">gray</span>: &#123;<br>    <span class="hljs-number">50</span>: <span class="hljs-string">&quot;hzqTheme(--color-gray-50)&quot;</span>,<br>    <span class="hljs-number">100</span>: <span class="hljs-string">&quot;hzqTheme(--color-gray-100)&quot;</span>,<br>    <span class="hljs-number">200</span>: <span class="hljs-string">&quot;hzqTheme(--color-gray-200)&quot;</span>,<br>    <span class="hljs-number">300</span>: <span class="hljs-string">&quot;hzqTheme(--color-gray-300)&quot;</span>,<br>    <span class="hljs-number">400</span>: <span class="hljs-string">&quot;hzqTheme(--color-gray-400)&quot;</span>,<br>    <span class="hljs-number">500</span>: <span class="hljs-string">&quot;hzqTheme(--color-gray-500)&quot;</span>,<br>    <span class="hljs-number">600</span>: <span class="hljs-string">&quot;hzqTheme(--color-gray-600)&quot;</span>,<br>    <span class="hljs-number">700</span>: <span class="hljs-string">&quot;hzqTheme(--color-gray-700)&quot;</span>,<br>    <span class="hljs-number">800</span>: <span class="hljs-string">&quot;hzqTheme(--color-gray-800)&quot;</span>,<br>    <span class="hljs-number">900</span>: <span class="hljs-string">&quot;hzqTheme(--color-gray-900)&quot;</span>,<br>    <span class="hljs-number">950</span>: <span class="hljs-string">&quot;hzqTheme(--color-gray-950)&quot;</span>,<br>   &#125;,<br>  &#125;,<br> &#125;,<br> <span class="hljs-attr">plugins</span>: [],<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><img src="/img/images/2024/1710038767348-a75d55fb-4d7a-42a6-9ca3-8cbfdbe0e767.png" srcset="/img/loading.gif" lazyload></p>
<ol start="116">
<li>安装前置依赖：用于修改 css 代码的库</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add postcss-nested@^<span class="hljs-number">6.0</span><span class="hljs-number">.1</span> postcss-nesting@^<span class="hljs-number">10.2</span><span class="hljs-number">.0</span><br></code></pre></td></tr></table></figure>

<ol start="117">
<li>新建插件文件<code>themePlugin.js</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch themePlugin.<span class="hljs-property">js</span><br><br><span class="hljs-comment">// 写入代码：</span><br><span class="hljs-comment">// eslint-disable-next-line @typescript-eslint/no-var-requires</span><br><span class="hljs-keyword">const</span> postcss = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;postcss&quot;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = postcss.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">&quot;postcss-theme&quot;</span>, <span class="hljs-function">(<span class="hljs-params">options</span>) =&gt;</span> &#123;<br> <span class="hljs-keyword">const</span> defalutOpts = &#123;<br>  <span class="hljs-attr">functionName</span>: <span class="hljs-string">&quot;hzqTheme&quot;</span>,<br>  <span class="hljs-attr">themeGroup</span>: &#123;&#125;,<br>  <span class="hljs-attr">defaultTheme</span>: <span class="hljs-string">&quot;light&quot;</span>,<br>  <span class="hljs-attr">themeSelector</span>: <span class="hljs-string">&#x27;html[data-theme=&quot;$_$&quot;]&#x27;</span>,<br>  <span class="hljs-attr">nestingPlugin</span>: <span class="hljs-literal">null</span>,<br> &#125;;<br><br> <span class="hljs-comment">// 合并参数</span><br> options = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, defalutOpts, options);<br><br> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getColorByThemeGroup</span> = (<span class="hljs-params">color, theme</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> options.<span class="hljs-property">themeGroup</span>[theme][color];<br> &#125;;<br><br> <span class="hljs-comment">// 正则：获取 hzqTheme(--color-white) 括号中的值：--color-white</span><br> <span class="hljs-keyword">const</span> regColorValue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<br>  <span class="hljs-string">`\\b<span class="hljs-subst">$&#123;options.functionName&#125;</span>\\(([^)]+)\\)`</span>,<br>  <span class="hljs-string">&quot;g&quot;</span>,<br> );<br><br> <span class="hljs-comment">// 插件的入口函数</span><br> <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">style, result</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">hasPlugin</span> = (<span class="hljs-params">name</span>) =&gt;<br>   name.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^postcss-/</span>, <span class="hljs-string">&quot;&quot;</span>) === options.<span class="hljs-property">nestingPlugin</span> ||<br>   result.<span class="hljs-property">processor</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> p.<span class="hljs-property">postcssPlugin</span> === name);<br><br>  <span class="hljs-comment">// 获取 css 属性值，替换掉 hzqTheme(--color-gray-200)</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getColorValue</span> = (<span class="hljs-params">value, theme</span>) =&gt; &#123;<br>   <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">replace</span>(regColorValue, <span class="hljs-function">(<span class="hljs-params">match, color</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// match: hzqTheme(--color-gray-200)</span><br>    <span class="hljs-comment">// color: --color-gray-200</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">getColorByThemeGroup</span>(color, theme);<br>   &#125;);<br>  &#125;;<br><br>  style.<span class="hljs-title function_">walkDecls</span>(<span class="hljs-function">(<span class="hljs-params">decl</span>) =&gt;</span> &#123;<br>   <span class="hljs-comment">// decl 是每个 css 属性的对象，height: 10px 的 css ast &#123; prop: &quot;height&quot;, value: &quot;10px&quot; &#125;</span><br><br>   <span class="hljs-comment">// 每个 css 属性的具体值：height: 10px;</span><br>   <span class="hljs-keyword">const</span> value = decl.<span class="hljs-property">value</span>;<br><br>   <span class="hljs-keyword">if</span> (!value || !regColorValue.<span class="hljs-title function_">test</span>(value)) &#123;<br>    <span class="hljs-comment">// 如果没有匹配到，直接返回</span><br>    <span class="hljs-keyword">return</span>;<br>   &#125;<br><br>   <span class="hljs-comment">// 说明有匹配到值</span><br><br>   <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">let</span> defaultTheme;<br><br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(options.<span class="hljs-property">themeGroup</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> &#123;<br>     <span class="hljs-comment">// 处理各种模式</span><br>     <span class="hljs-keyword">const</span> themeColor = <span class="hljs-title function_">getColorValue</span>(value, key);<br>     <span class="hljs-keyword">const</span> themeSelector = options.<span class="hljs-property">themeSelector</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;$_$&quot;</span>, key);<br>     <span class="hljs-keyword">let</span> themeRule;<br>     <span class="hljs-comment">// 使用 nest 插件，生成 dark 的规则：html[data-theme=&quot;dark&quot;] &#123;...&#125;</span><br>     <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasPlugin</span>(<span class="hljs-string">&quot;postcss-nesting&quot;</span>)) &#123;<br>      themeRule = postcss.<span class="hljs-title function_">atRule</span>(&#123;<br>       <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;nest&quot;</span>,<br>       <span class="hljs-attr">params</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;themeSelector&#125;</span> &amp;`</span>,<br>      &#125;);<br>     &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasPlugin</span>(<span class="hljs-string">&quot;postcss-nested&quot;</span>)) &#123;<br>      themeRule = postcss.<span class="hljs-title function_">rule</span>(&#123;<br>       <span class="hljs-attr">params</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;themeSelector&#125;</span> &amp;`</span>,<br>      &#125;);<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;请安装 postcss-nesting 或者 postcss-nested 插件&quot;</span>);<br>     &#125;<br>     <span class="hljs-keyword">const</span> themeDecl = decl.<span class="hljs-title function_">clone</span>(&#123; <span class="hljs-attr">value</span>: themeColor &#125;);<br><br>     <span class="hljs-keyword">if</span> (themeRule) &#123;<br>      themeRule.<span class="hljs-title function_">append</span>(themeDecl);<br>      decl.<span class="hljs-title function_">after</span>(themeRule);<br>     &#125;<br><br>     <span class="hljs-keyword">if</span> (key === options.<span class="hljs-property">defaultTheme</span>) &#123;<br>      defaultTheme = themeDecl;<br>     &#125;<br>    &#125;);<br><br>    <span class="hljs-comment">// 处理为默认模式</span><br>    <span class="hljs-keyword">if</span> (defaultTheme) decl.<span class="hljs-title function_">replaceWith</span>(defaultTheme);<br>   &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    decl.<span class="hljs-title function_">warn</span>(result, error);<br>   &#125;<br>  &#125;);<br> &#125;;<br>&#125;);<br></code></pre></td></tr></table></figure>

<ol start="118">
<li>更改<code>.postcssrc.js</code>文件，加入对应插件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> &#123; themeGroup, defaultTheme &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./themeGroup&quot;</span>); <span class="hljs-comment">// ++++++</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br> <span class="hljs-attr">plugins</span>: [<br>  <span class="hljs-string">&quot;autoprefixer&quot;</span>, <span class="hljs-comment">// 自动添加浏览器前缀</span><br>  <span class="hljs-string">&quot;tailwindcss&quot;</span>,<br>  <span class="hljs-string">&quot;postcss-nested&quot;</span>, <span class="hljs-comment">// ++++++</span><br>  <span class="hljs-string">&quot;postcss-nesting&quot;</span>, <span class="hljs-comment">// ++++++</span><br>  <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./themePlugin&quot;</span>)(&#123; themeGroup, defaultTheme &#125;), <span class="hljs-comment">// ++++++</span><br> ],<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="119">
<li>重启项目，默认为绿色，切换后为黑色，再切换为白色</li>
</ol>
<p><img src="/img/images/2024/1710049853301-6701169c-cc19-4db5-9516-c96d592a8b12.png" srcset="/img/loading.gif" lazyload><img src="/img/images/2024/1710049860220-a317f8e4-053f-402f-b6a1-c5770b5a5434.png" srcset="/img/loading.gif" lazyload><img src="/img/images/2024/1710049867735-76295fbf-ca1b-45ff-b1cc-f279c158e3ea.png" srcset="/img/loading.gif" lazyload><br>打包之后，本地启动<code>index.html</code>也是一样的效果，这样就完成了主题切换的插件，本质是帮我们注入所有的主题 css 代码</p>
<h1 id="6、后端项目搭建（koa-框架）"><a href="#6、后端项目搭建（koa-框架）" class="headerlink" title="6、后端项目搭建（koa 框架）"></a>6、后端项目搭建（koa 框架）</h1><blockquote>
<p>nodejs 后端项目使用场景：BFF(backend-for-fontend 给前端用的后端)、内部小系统等</p>
</blockquote>
<h2 id="初始化配置"><a href="#初始化配置" class="headerlink" title="初始化配置"></a>初始化配置</h2><ol start="120">
<li>创建文件夹（react-actual-combat 下）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir packages/apps/back-end<br></code></pre></td></tr></table></figure>

<ol start="121">
<li>初始化项目</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">cd packages/apps/back-end &amp;&amp; pnpm init<br></code></pre></td></tr></table></figure>

<ol start="122">
<li>安装<code>devDependencies</code>依赖（apps&#x2F;back-end 下）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add @babel/core @babel/plugin-proposal-<span class="hljs-keyword">class</span>-properties @babel/plugin-proposal-decorators @babel/preset-env babelrc-rollup core-js rollup rollup-plugin-babel -D<br></code></pre></td></tr></table></figure>

<ol start="123">
<li>安装<code>dependencies</code>依赖（apps&#x2F;back-end 下）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pnpm add jsonwebtoken koa koa-bodyparser koa-router<br></code></pre></td></tr></table></figure>

<ol start="124">
<li>编写 Rollup 脚本</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch rollup.<span class="hljs-property">config</span>.<span class="hljs-property">js</span><br><br><span class="hljs-comment">// 写如下代码：</span><br><span class="hljs-keyword">const</span> babel = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;rollup-plugin-babel&quot;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br> <span class="hljs-attr">input</span>: <span class="hljs-string">&quot;./src/index.js&quot;</span>,<br> <span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;hzqServer&quot;</span>, <span class="hljs-comment">// 自定义命名</span><br>  <span class="hljs-attr">file</span>: <span class="hljs-string">&quot;./dist/bundle.js&quot;</span>,<br>  <span class="hljs-attr">format</span>: <span class="hljs-string">&quot;umd&quot;</span>,<br> &#125;,<br> <span class="hljs-attr">treeshake</span>: <span class="hljs-literal">false</span>,<br> <span class="hljs-attr">plugins</span>: [<br>  <span class="hljs-title function_">babel</span>(&#123;<br>   <span class="hljs-attr">runtimeHelpers</span>: <span class="hljs-literal">true</span>,<br>   <span class="hljs-attr">extensions</span>: [<span class="hljs-string">&quot;.js&quot;</span>, <span class="hljs-string">&quot;.ts&quot;</span>],<br>   <span class="hljs-attr">exclude</span>: <span class="hljs-string">&quot;node_modules/**&quot;</span>,<br>   <span class="hljs-attr">externalHelpers</span>: <span class="hljs-literal">true</span>,<br>  &#125;),<br> ],<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="125">
<li>编写 Babel 配置</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch .<span class="hljs-property">babelrc</span><br><br><span class="hljs-comment">// 写如下代码：</span><br>&#123;<br> <span class="hljs-string">&quot;presets&quot;</span>: [<br>  [<br>   <span class="hljs-string">&quot;@babel/preset-env&quot;</span>,<br>   &#123;<br>    <span class="hljs-string">&quot;modules&quot;</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-string">&quot;loose&quot;</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-string">&quot;targets&quot;</span>: <span class="hljs-string">&quot;node 16&quot;</span>,<br>    <span class="hljs-string">&quot;useBuiltIns&quot;</span>: <span class="hljs-string">&quot;usage&quot;</span>,<br>    <span class="hljs-string">&quot;corejs&quot;</span>: &#123;<br>     <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;3.36&quot;</span>, <span class="hljs-comment">// 跟 package.json 里面的 core-js 版本一致</span><br>     <span class="hljs-string">&quot;proposals&quot;</span>: <span class="hljs-literal">true</span><br>    &#125;<br>   &#125;<br>  ]<br> ],<br> <span class="hljs-string">&quot;plugins&quot;</span>: [<br>  [<span class="hljs-string">&quot;@babel/plugin-proposal-decorators&quot;</span>, &#123; <span class="hljs-string">&quot;legacy&quot;</span>: <span class="hljs-literal">true</span> &#125;],<br>  [<span class="hljs-string">&quot;@babel/plugin-proposal-class-properties&quot;</span>, &#123; <span class="hljs-string">&quot;loose&quot;</span>: <span class="hljs-literal">true</span> &#125;]<br> ]<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="126">
<li>新建入口文件<code>src/index.js</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src &amp;&amp; touch src/index.<span class="hljs-property">js</span><br><br><span class="hljs-comment">// 写如下代码：</span><br><span class="hljs-keyword">import</span> &#123; random &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./test&quot;</span>;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ hello word ] &gt;&quot;</span>, random);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> random;<br></code></pre></td></tr></table></figure>

<ol start="127">
<li>新建测试文件<code>src/test.js</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch src/test.<span class="hljs-property">js</span><br><br><span class="hljs-comment">// 写如下代码：</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> random = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>();<br></code></pre></td></tr></table></figure>

<ol start="128">
<li>本地运行下<code>src/index.js</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript">node src/index.<span class="hljs-property">js</span><br><br><span class="hljs-comment">// 会发现报错，因为代码里面写了 esm 的 import、export 语法</span><br><span class="hljs-comment">// 但我们的 node环境或 package.json 没有指定支持该语法，所以会报错</span><br></code></pre></td></tr></table></figure>

<ol start="129">
<li><code>package.json</code>新增<code>build</code>命令，然后运行<code>pnpm build</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  ......<br><br> <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,<br>    <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;rollup --config rollup.config.js&quot;</span> <span class="hljs-comment">// ++++++</span><br>  &#125;,<br><br>  ......<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="130">
<li>打包后的文件如下(<code>back-end/dist/bundle.js</code>)</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript">(<span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable language_">global</span>, factory</span>) &#123;<br> <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">exports</span> === <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">module</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span> ? <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">factory</span>() :<br> <span class="hljs-keyword">typeof</span> define === <span class="hljs-string">&#x27;function&#x27;</span> &amp;&amp; define.<span class="hljs-property">amd</span> ? <span class="hljs-title function_">define</span>(factory) :<br> (<span class="hljs-variable language_">global</span> = <span class="hljs-keyword">typeof</span> globalThis !== <span class="hljs-string">&#x27;undefined&#x27;</span> ? globalThis : <span class="hljs-variable language_">global</span> || self, <span class="hljs-variable language_">global</span>.<span class="hljs-property">hzqServer</span> = <span class="hljs-title function_">factory</span>());<br>&#125;)(<span class="hljs-variable language_">this</span>, (<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123; <span class="hljs-string">&#x27;use strict&#x27;</span>;<br><br> <span class="hljs-keyword">const</span> random = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>();<br><br> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ hello word ] &gt;&quot;</span>, random);<br><br> <span class="hljs-keyword">return</span> random;<br><br>&#125;));<br></code></pre></td></tr></table></figure>

<ol start="131">
<li>然后可以运行下<code>node dist/bundle.js</code></li>
</ol>
<p><img src="/img/images/2024/1710052075990-5e411011-e619-4c9c-9069-2ea9383b4dfd.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="本地环境搭建"><a href="#本地环境搭建" class="headerlink" title="本地环境搭建"></a>本地环境搭建</h2><p>初始化完项目后，可以发现构建产物是能直接运行的，那可以这样处理本地开发</p>
<ol start="132">
<li><code>package.json</code>新增<code>start</code>命令</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  ......<br><br> <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,<br>    <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;rollup --config rollup.config.js&quot;</span>,<br>    <span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-string">&quot;rollup --config rollup.config.js -w&quot;</span>, <span class="hljs-comment">// ++++++`</span><br>  &#125;,<br><br>  ......<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="133">
<li>运行<code>pnpm start</code>，这样每次更改代码后，就会自动打包</li>
<li>新起终端，运行<code>nodemon dist/bundle.js</code>，没有的话全局安装下<code>npm install -g nodemon</code>，这样每次变更时可自动运行<br><img src="/img/images/2024/1710052747718-52d2e1d6-bcec-4099-a76e-80a86e03d225.png" srcset="/img/loading.gif" lazyload></li>
<li><code>package.json</code>新增<code>dev</code>命令，以后本地开发就运行<code>pnpm dev</code>即可</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  ......<br><br>  <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;test&quot;</span>: <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,<br>    <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;rollup --config rollup.config.js&quot;</span>,<br>    <span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-string">&quot;rollup --config rollup.config.js -w&quot;</span>,<br>    <span class="hljs-string">&quot;dev&quot;</span>: <span class="hljs-string">&quot;pnpm start &amp; nodemon dist/bundle.js&quot;</span> <span class="hljs-comment">// ++++++</span><br>  &#125;,<br><br>  ......<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="练一下手"><a href="#练一下手" class="headerlink" title="练一下手"></a>练一下手</h2><ol start="136">
<li>删除之前的构建测试代码，新建空的入口文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">rm src/index.<span class="hljs-property">js</span> src/test.<span class="hljs-property">js</span> &amp;&amp; touch src/index.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="137">
<li>项目保持运行<code>pnpm dev</code>哦</li>
<li>先写个 <a target="_blank" rel="noopener" href="https://www.koajs.net/#hello-koa">Hello Koa</a>，练练手</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;koa&quot;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;koa-router&quot;</span>;<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();<br><br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();<br><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; &#123;<br> ctx.<span class="hljs-property">body</span> = <span class="hljs-string">&quot;hello koa 3&quot;</span>;<br>&#125;);<br><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/list&quot;</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; &#123;<br> ctx.<span class="hljs-property">body</span> = [<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>];<br>&#125;);<br><br>app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>());<br><br><span class="hljs-keyword">const</span> port = <span class="hljs-number">3001</span>;<br><br>app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> &#123;<br> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`server is running at http://localhost:<span class="hljs-subst">$&#123;port&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<ol start="139">
<li>命令行里面点击网址，可以看到页面</li>
</ol>
<p><img src="/img/images/2024/1710053407431-31dc7351-f187-4517-b839-d3cdaa62a37a.png" srcset="/img/loading.gif" lazyload><img src="/img/images/2024/1710053418337-d813c379-b507-49b5-b809-cfcbbd3e6c8a.png" srcset="/img/loading.gif" lazyload><br>访问 <a target="_blank" rel="noopener" href="http://localhost:3001/list">http://localhost:3001/list</a>，也能看到数据<br><img src="/img/images/2024/1710053779932-c4ae8a47-9ab5-4e36-976b-2608a72e2e1e.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="实际开发"><a href="#实际开发" class="headerlink" title="实际开发"></a>实际开发</h2><p>后端项目，一般是基于 MVC 形式来组织代码的<br><img src="/img/images/2024/1710055097023-438f5ca7-44e6-454c-80bc-44ef18870c0f.jpeg" srcset="/img/loading.gif" lazyload><br>所以我们的后端项目也会进行分层创建文件夹：controllers、services<br>核心技术：基于<code>TS 的装饰器</code>去组装我们的代码</p>
<ol start="140">
<li>新建<code>controllers</code>文件夹</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src/controllers &amp;&amp; touch src/controllers/book.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="141">
<li>新建辅助函数：装饰器等等</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src/utils &amp;&amp; touch src/utils/decorator.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="142">
<li><code>src/utils/decorator.js</code>写如下代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">RequestMethod</span> = &#123;<br> <span class="hljs-attr">GET</span>: <span class="hljs-string">&quot;get&quot;</span>,<br> <span class="hljs-attr">POST</span>: <span class="hljs-string">&quot;post&quot;</span>,<br> <span class="hljs-attr">PUT</span>: <span class="hljs-string">&quot;put&quot;</span>,<br> <span class="hljs-attr">DELETE</span>: <span class="hljs-string">&quot;delete&quot;</span>,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Controller</span>(<span class="hljs-params">perfix = <span class="hljs-string">&quot;&quot;</span></span>) &#123;&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RequestMapping</span>(<span class="hljs-params">method = <span class="hljs-string">&quot;&quot;</span>, url = <span class="hljs-string">&quot;&quot;</span></span>) &#123;&#125;<br></code></pre></td></tr></table></figure>

<ol start="143">
<li><code>src/controllers/book.js</code>写代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">RequestMapping</span>, <span class="hljs-title class_">RequestMethod</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../utils/decorator&quot;</span>;<br><br>@<span class="hljs-title class_">Controller</span>(<span class="hljs-string">&quot;/book&quot;</span>)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> &#123;<br> @<span class="hljs-title class_">RequestMapping</span>(<span class="hljs-title class_">RequestMethod</span>.<span class="hljs-property">GET</span>, <span class="hljs-string">&quot;/all&quot;</span>)<br> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAll</span>(<span class="hljs-params">ctx</span>) &#123;<br>  ctx.<span class="hljs-property">body</span> = [<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>];<br> &#125;<br>&#125;<br><br><span class="hljs-comment">// 我们期望这样写后，就能当做接口被调用，这需要处理成 router</span><br><span class="hljs-comment">// 比如：router.get(&#x27;/book/all&#x27;, ctx =&gt; ctx.body = [&quot;1&quot;, &quot;2&quot;])</span><br><span class="hljs-comment">// 核心为：方法(get)、地址(&#x27;/book/all&#x27;)、函数(ctx =&gt; ctx.body = [&quot;1&quot;, &quot;2&quot;])</span><br><span class="hljs-comment">// 所以只要想办法能根据配置生成对应的路由就行了，即 router[method](path, fn)</span><br><span class="hljs-comment">// 这一步其实也很简单，自己写个 JSON，有method、path、fn，然后循环 JSON，也能生成路由</span><br><br><span class="hljs-comment">// ⭐️ 但核心的在于如何实现达到更高的扩展性、稳定性</span><br></code></pre></td></tr></table></figure>

<ol start="144">
<li>完善<code>src/utils/decorator.js</code>代码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">RequestMethod</span> = &#123;<br> <span class="hljs-attr">GET</span>: <span class="hljs-string">&quot;get&quot;</span>,<br> <span class="hljs-attr">POST</span>: <span class="hljs-string">&quot;post&quot;</span>,<br> <span class="hljs-attr">PUT</span>: <span class="hljs-string">&quot;put&quot;</span>,<br> <span class="hljs-attr">DELETE</span>: <span class="hljs-string">&quot;delete&quot;</span>,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> controllers = [];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Controller</span>(<span class="hljs-params">prefix = <span class="hljs-string">&quot;&quot;</span></span>) &#123;<br> <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">constructor</span>) &#123;<br>  constructor.<span class="hljs-property">prefix</span> = prefix;<br> &#125;;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RequestMapping</span>(<span class="hljs-params">method = <span class="hljs-string">&quot;&quot;</span>, url = <span class="hljs-string">&quot;&quot;</span></span>) &#123;<br> <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target, propertyKey, decriptor</span>) &#123;<br>  <span class="hljs-keyword">let</span> path = url || <span class="hljs-string">`/<span class="hljs-subst">$&#123;propertyKey&#125;</span>`</span>;<br><br>  <span class="hljs-keyword">const</span> item = &#123;<br>   method,<br>   path,<br>   <span class="hljs-attr">handler</span>: decriptor.<span class="hljs-property">value</span>, <span class="hljs-comment">// 函数自身</span><br>   <span class="hljs-attr">constructor</span>: target.<span class="hljs-property">constructor</span>, <span class="hljs-comment">// 构造函数</span><br>  &#125;;<br><br>  controllers.<span class="hljs-title function_">push</span>(item);<br> &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="145">
<li>新建<code>src/controllers/index.js</code>，集中导出<code>controllers</code>下面的文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch src/controllers/index.<span class="hljs-property">js</span><br><br><span class="hljs-comment">// 写如下代码：</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">BookController</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./book.js&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [<span class="hljs-title class_">BookController</span>];<br></code></pre></td></tr></table></figure>

<ol start="146">
<li>现在这几个文件还毫无关系，所以我们简单点强行关联(import)，更改<code>src/index.js</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;koa&quot;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;koa-router&quot;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Routers</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./controllers/index&quot;</span>; <span class="hljs-comment">// 导入 controllers 作为路由</span><br><br><span class="hljs-keyword">import</span> &#123; controllers &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils/decorator.js&quot;</span>; <span class="hljs-comment">// 导入 controllers，里面有具体的 method, path, handler</span><br><br><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();<br><br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();<br><br><span class="hljs-keyword">const</span> allPath = [];<br><br><span class="hljs-title class_">Routers</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">route</span>) =&gt;</span> &#123;<br> <span class="hljs-keyword">const</span> currRoute = controllers.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">constructor</span> === route);<br><br> <span class="hljs-keyword">if</span> (!currRoute) <span class="hljs-keyword">return</span>;<br><br> <span class="hljs-keyword">let</span> &#123; method, path, handler &#125; = currRoute;<br><br> <span class="hljs-keyword">const</span> &#123; prefix &#125; = route;<br><br> <span class="hljs-keyword">if</span> (prefix) path = prefix + path;<br><br> allPath.<span class="hljs-title function_">push</span>(&#123; method, path &#125;);<br><br> router[method](path, handler);<br>&#125;);<br><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; &#123;<br> <span class="hljs-keyword">let</span> body = <span class="hljs-string">&quot;&quot;</span>;<br><br> allPath.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>  body += <span class="hljs-string">`&lt;a href=&#x27;<span class="hljs-subst">$&#123;item.path&#125;</span>&#x27;&gt;<span class="hljs-subst">$&#123;item.method&#125;</span>: <span class="hljs-subst">$&#123;item.path&#125;</span>&lt;/a&gt;&lt;br&gt;`</span>;<br> &#125;);<br><br> ctx.<span class="hljs-property">body</span> = body;<br>&#125;);<br><br>app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>());<br><br><span class="hljs-keyword">const</span> port = <span class="hljs-number">3001</span>;<br><br>app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> &#123;<br> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`server is running at http://localhost:<span class="hljs-subst">$&#123;port&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<ol start="147">
<li>页面效果如下：</li>
</ol>
<p><img src="/img/images/2024/1710059455864-b888bb47-acc7-4b59-a1a4-ea6fde4ff34a.png" srcset="/img/loading.gif" lazyload><img src="/img/images/2024/1710059462271-8497c6f7-7a35-44d0-b0c0-eaa3e5b8b028.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="处理跨域"><a href="#处理跨域" class="headerlink" title="处理跨域"></a>处理跨域</h3><p>首先跨域是<strong>浏览器限制</strong>的，为了网页的安全。<br>所以我们本地开发前端时，前端浏览器直接访问服务器会出现跨域，一般是本地加个 devServer 配置就能解决，那是因为服务端直接无跨域的说法。<br>当我们加了 devServer 后，浏览器就直接访问 devServer，然后 devServer 再去访问服务端，这样就走通了。<br>若我们是服务端，则可以通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS">cors</a>(跨源资源共享) 解决</p>
<ol start="148">
<li>更改<code>src/index.js</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//  找地方加上这一段手写代码，也可以使用 @koa/cors 库来处理跨域</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br> ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;Acess-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>); <span class="hljs-comment">// 允许与给定的来源（origin）共享。</span><br> ctx.<span class="hljs-title function_">set</span>(<br>  <span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>,<br>  <span class="hljs-string">&quot;Content-Type,Content-Length,Authorization,Accept,X-Requested-With&quot;</span>,<br> ); <span class="hljs-comment">// 允许的请求头。</span><br><br> ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="hljs-string">&quot;OPTIONS, GET, POST, PUT, DELETE&quot;</span>); <span class="hljs-comment">// 允许使用的方法或方法列表。</span><br><br> ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>); <span class="hljs-comment">// 设置响应的 Content-Type 头，与跨域无关，只是放在一起写了</span><br><br> <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">request</span>.<span class="hljs-property">method</span> === <span class="hljs-string">&quot;OPTIONS&quot;</span>) &#123;<br>  ctx.<span class="hljs-property">status</span> = <span class="hljs-number">200</span>; <span class="hljs-comment">// 状态码为 200，表示请求成功</span><br> &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="登录鉴权"><a href="#登录鉴权" class="headerlink" title="登录鉴权"></a>登录鉴权</h3><h4 id="JWT-是什么？"><a href="#JWT-是什么？" class="headerlink" title="JWT 是什么？"></a>JWT 是什么？</h4><p>JSON Web Token，由三段通过<code>.</code>连接组成：</p>
<ul>
<li>header：类型，通常是 jwt</li>
<li>payload：主体内容，可以包含一些用户信息等</li>
<li>signature：签名结果，一般是 header、payload 加密后的结果</li>
</ul>
<p>类似于：<code>eyJhbGciOiAiSFMyNTYiLCAidHlwIjogIkpXVCJ9.eyJzdWIiOiAiMTIzNDU2Nzg5MCIsICJuYW1lIjogIkpvaG4gRG9lIiwgImlhdCI6IDE1MTYyMzkwMjJ9.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</code></p>
<h4 id="模拟一下"><a href="#模拟一下" class="headerlink" title="模拟一下"></a>模拟一下</h4><p>本次通过模拟生成来演示</p>
<ol start="149">
<li>创建文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch src/utils/mockJWT.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="150">
<li><code>src/utils/mockJWT.js</code>编码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;crypto&quot;</span>);<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 生成JWT令牌</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> payload 令牌负载</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> salt 加密盐</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> 返回JWT令牌字符串</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">sign</span>(<span class="hljs-params">payload, salt</span>) &#123;<br> <span class="hljs-comment">// 定义头部信息</span><br> <span class="hljs-keyword">const</span> header = &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;JWT&quot;</span>, <span class="hljs-attr">alg</span>: <span class="hljs-string">&quot;HS256&quot;</span> &#125;;<br><br> <span class="hljs-comment">// 创建一个空数组用于存储令牌</span><br> <span class="hljs-keyword">const</span> tokenArr = [];<br><br> <span class="hljs-comment">// 第一段：将头部信息编码为Base64Url格式并添加到令牌数组中</span><br> tokenArr.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">base64UrlEncode</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(header)));<br><br> <span class="hljs-comment">// 第二段：将负载信息编码为Base64Url格式并添加到令牌数组中</span><br> tokenArr.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">base64UrlEncode</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(payload)));<br><br> <span class="hljs-comment">// 第三段：将前两段拼接后的字符串进行加密，并将加密结果添加到令牌数组中</span><br> tokenArr.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">encryption</span>(tokenArr.<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;.&quot;</span>), salt));<br><br> <span class="hljs-comment">// 将令牌数组中的元素用&quot;.&quot;连接并返回</span><br> <span class="hljs-keyword">return</span> tokenArr.<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;.&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 将字符串进行base64Url编码</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> str 待编码的字符串</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> 返回base64Url编码后的字符串</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">base64UrlEncode</span>(<span class="hljs-params">str</span>) &#123;<br> <span class="hljs-keyword">return</span> <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(str).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&quot;base64&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">encryption</span>(<span class="hljs-params">value, salt</span>) &#123;<br> <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">createHmac</span>(<span class="hljs-string">&quot;sha256&quot;</span>, salt).<span class="hljs-title function_">update</span>(value).<span class="hljs-title function_">digest</span>(<span class="hljs-string">&quot;base64&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 验证token是否有效</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> token 需要验证的token</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> salt 加密时使用的盐值</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> 返回布尔值，表示token是否有效</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">verify</span>(<span class="hljs-params">token, salt</span>) &#123;<br> <span class="hljs-comment">// 将token按&quot;.&quot;分割成header、payload和signature三部分</span><br> <span class="hljs-keyword">const</span> [header, payload, signature] = token.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;.&quot;</span>);<br> <span class="hljs-comment">// 将header和payload拼接成字符串，并使用salt进行加密</span><br> <span class="hljs-comment">// 返回加密后的结果是否与signature相等</span><br> <span class="hljs-keyword">return</span> <span class="hljs-title function_">encryption</span>([header, payload].<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;.&quot;</span>), salt) === signature;<br>&#125;<br><br><span class="hljs-keyword">const</span> salt = <span class="hljs-string">&quot;&lt;huangzq&gt;&quot;</span>;<br><span class="hljs-keyword">const</span> token = <span class="hljs-title function_">sign</span>(&#123; <span class="hljs-attr">user</span>: <span class="hljs-string">&quot;hzq&quot;</span> &#125;, salt);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ token ] &gt;&quot;</span>, token);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ verify() ] &gt;&quot;</span>, <span class="hljs-title function_">verify</span>(token, salt));<br><br><span class="hljs-comment">// 终端进入该文件夹，运行 node ./mockJWT.js</span><br><span class="hljs-comment">// 打印结果：</span><br><span class="hljs-comment">// [ token ] &gt; eyJ0eXBlIjoiSldUIiwiYWxnIjoiSFMyNTYifQ==.eyJ1c2VyIjoiaHpxIn0=.WOckAZBwACMtmAFXTBb3vRsY0J2Lef1S80WMU/RJUvg=</span><br><span class="hljs-comment">// [ verify() ] &gt; true</span><br></code></pre></td></tr></table></figure>

<h4 id="正式开搞"><a href="#正式开搞" class="headerlink" title="正式开搞"></a>正式开搞</h4><blockquote>
<p>基于三方库，完成 JWT 模块</p>
</blockquote>
<ol start="151">
<li>新建文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch src/utils/jwt.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="152">
<li><code>src/utils/jwt.js</code>编码，实现验证、加密逻辑</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> jwt <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;jsonwebtoken&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SALT</span> = <span class="hljs-string">&quot;&lt;Huangzq666&gt;&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">verify</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">token</span>) =&gt; &#123;<br> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (token) &#123;<br>   jwt.<span class="hljs-title function_">verify</span>(token, <span class="hljs-variable constant_">SALT</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>     <span class="hljs-keyword">if</span> (err.<span class="hljs-property">name</span> === <span class="hljs-string">&quot;TokenExpiredError&quot;</span>) &#123;<br>      <span class="hljs-title function_">resolve</span>(&#123;<br>       <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;failed&quot;</span>,<br>       <span class="hljs-attr">error</span>: <span class="hljs-string">&quot;token 已过期&quot;</span>,<br>      &#125;);<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">resolve</span>(&#123;<br>       <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;failed&quot;</span>,<br>       <span class="hljs-attr">error</span>: <span class="hljs-string">&quot; 认证失败&quot;</span>,<br>      &#125;);<br>     &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>     <span class="hljs-title function_">resolve</span>(&#123;<br>      <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;success&quot;</span>,<br>      data,<br>     &#125;);<br>    &#125;<br>   &#125;);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>   <span class="hljs-title function_">resolve</span>(&#123;<br>    <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;failed&quot;</span>,<br>    <span class="hljs-attr">error</span>: <span class="hljs-string">&quot;token 不能为空&quot;</span>,<br>   &#125;);<br>  &#125;<br> &#125;);<br>&#125;;<br><br><span class="hljs-comment">// 加密</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">signature</span> = (<span class="hljs-params">data</span>) =&gt; &#123;<br> <span class="hljs-keyword">return</span> jwt.<span class="hljs-title function_">sign</span>(data, <span class="hljs-variable constant_">SALT</span>, &#123;<br>  <span class="hljs-attr">expiresIn</span>: <span class="hljs-string">&quot;10h&quot;</span>, <span class="hljs-comment">// 秒</span><br> &#125;);<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">jwtVerify</span> =<br> (<span class="hljs-params">whiteList = []</span>) =&gt;<br> <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (whiteList.<span class="hljs-title function_">includes</span>(ctx.<span class="hljs-property">path</span>)) &#123;<br>   <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(ctx);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>   <span class="hljs-comment">// 不是白名单，则需要进行校验</span><br>   <span class="hljs-keyword">let</span> token;<br>   <span class="hljs-keyword">try</span> &#123;<br>    token = ctx.<span class="hljs-property">header</span>.<span class="hljs-property">authorization</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;Bearer &quot;</span>)[<span class="hljs-number">1</span>];<br>   &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    <span class="hljs-comment">// todo</span><br>   &#125;<br><br>   <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">verify</span>(token);<br><br>   <span class="hljs-keyword">if</span> (res.<span class="hljs-property">status</span> === <span class="hljs-string">&quot;success&quot;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(ctx);<br>   &#125; <span class="hljs-keyword">else</span> &#123;<br>    ctx.<span class="hljs-property">body</span> = &#123;<br>     ...res,<br>     <span class="hljs-attr">code</span>: <span class="hljs-number">401</span>,<br>    &#125;;<br>   &#125;<br>  &#125;<br> &#125;;<br></code></pre></td></tr></table></figure>

<ol start="153">
<li>在<code>index.js</code>里面进行<code>app.use</code>注册</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; jwtVerify &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./utils/jwt.js&quot;</span>;<br><br><br><span class="hljs-comment">// ......</span><br><br><br><span class="hljs-comment">// 使用 jwt 验证中间件</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">jwtVerify</span>([<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/api/user/login&quot;</span>, <span class="hljs-string">&quot;/api/user/register&quot;</span>]));<br></code></pre></td></tr></table></figure>

<ol start="154">
<li>刷新下页面，就能看到无法访问了，因为没带<code>token</code></li>
</ol>
<p><img src="/img/images/2024/1710071756990-4507cdff-32ef-4109-a832-3ba4e35477f8.png" srcset="/img/loading.gif" lazyload></p>
<ol start="155">
<li>新增<code>user</code>模块</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch src/controllers/user.<span class="hljs-property">js</span> &amp;&amp; mkdir src/services &amp;&amp; touch src/services/user.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<ol start="156">
<li><code>src/controllers/user.js</code>初始化编码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">RequestMapping</span>, <span class="hljs-title class_">RequestMethod</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../utils/decorator&quot;</span>;<br><br>@<span class="hljs-title class_">Controller</span>(<span class="hljs-string">&quot;/user&quot;</span>)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br> @<span class="hljs-title class_">RequestMapping</span>(<span class="hljs-title class_">RequestMethod</span>.<span class="hljs-property">POST</span>, <span class="hljs-string">&quot;/login&quot;</span>)<br> <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">ctx</span>) &#123;<br>  ctx.<span class="hljs-property">body</span> = <span class="hljs-string">&quot;登录成功&quot;</span>;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="157">
<li><code>src/services/user.js</code>初始化编码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;&#125;<br></code></pre></td></tr></table></figure>

<ol start="158">
<li><code>src/controllers/index.js</code>引入</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">BookController</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./book.js&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">UserController</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./user.js&quot;</span>; <span class="hljs-comment">// ++++++</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [<span class="hljs-title class_">BookController</span>, <span class="hljs-title class_">UserController</span>];<br></code></pre></td></tr></table></figure>

<ol start="159">
<li>因为是<code>post</code>请求，就只有打开<code>postman</code>调用，发现能调通</li>
</ol>
<p><img src="/img/images/2024/1710072895076-3496eca6-fc66-42fa-a94c-cfc63add6fb4.png" srcset="/img/loading.gif" lazyload></p>
<ol start="160">
<li><code>src/controllers/user.js</code>正式编码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../services/user&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">RequestMapping</span>, <span class="hljs-title class_">RequestMethod</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../utils/decorator&quot;</span>;<br><br>@<span class="hljs-title class_">Controller</span>(<span class="hljs-string">&quot;/user&quot;</span>)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br> @<span class="hljs-title class_">RequestMapping</span>(<span class="hljs-title class_">RequestMethod</span>.<span class="hljs-property">POST</span>, <span class="hljs-string">&quot;/login&quot;</span>)<br> <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">ctx</span>) &#123;<br>  <span class="hljs-keyword">const</span> userService = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();<br>  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> userService.<span class="hljs-title function_">validate</span>(ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span> || &#123;&#125;);<br>  ctx.<span class="hljs-property">body</span> = &#123; ...res &#125;;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="161">
<li><code>src/services/user.js</code>正式编码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; signature &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../utils/jwt&quot;</span>;<br><br><span class="hljs-keyword">const</span> mockUserTable = [<br> &#123; <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-attr">password</span>: <span class="hljs-string">&quot;123456&quot;</span> &#125;,<br> &#123; <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;lisi&quot;</span>, <span class="hljs-attr">password</span>: <span class="hljs-string">&quot;654321&quot;</span> &#125;,<br> &#123; <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-attr">password</span>: <span class="hljs-string">&quot;111111&quot;</span> &#125;,<br> &#123; <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;huangzq&quot;</span>, <span class="hljs-attr">password</span>: <span class="hljs-string">&quot;hzq666&quot;</span> &#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br> <span class="hljs-keyword">async</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params">&#123; username, password &#125;</span>) &#123;<br>  <span class="hljs-keyword">if</span> (username &amp;&amp; password) &#123;<br>   <span class="hljs-keyword">let</span> findValue = mockUserTable.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">username</span> === username);<br>   <span class="hljs-keyword">if</span> (findValue) &#123;<br>    <span class="hljs-keyword">let</span> findValue = mockUserTable.<span class="hljs-title function_">find</span>(<br>     <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">username</span> === username &amp;&amp; item.<span class="hljs-property">password</span> === password,<br>    );<br>    <span class="hljs-keyword">if</span> (findValue) &#123;<br>     <span class="hljs-comment">// 登录成功</span><br>     <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,<br>      <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;登录成功&quot;</span>,<br>      <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;success&quot;</span>,<br>      <span class="hljs-attr">data</span>: &#123; <span class="hljs-attr">token</span>: <span class="hljs-title function_">signature</span>(&#123; username &#125;) &#125;,<br>     &#125;;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>     <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,<br>      <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;密码错误&quot;</span>,<br>      <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;failed&quot;</span>,<br>      <span class="hljs-attr">data</span>: <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>,<br>     &#125;;<br>    &#125;<br>   &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>     <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,<br>     <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;用户名错误&quot;</span>,<br>     <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;failed&quot;</span>,<br>     <span class="hljs-attr">data</span>: <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>,<br>    &#125;;<br>   &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>   <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,<br>    <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;用户名或密码不能为空&quot;</span>,<br>    <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;failed&quot;</span>,<br>    <span class="hljs-attr">data</span>: <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>,<br>   &#125;;<br>  &#125;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="162">
<li>完善一下<code>index.js</code>，支持<code>body</code>参数的获取</li>
</ol>
<p><img src="/img/images/2024/1710076254112-11e55663-583d-470c-b082-40ebc5292bfe.png" srcset="/img/loading.gif" lazyload></p>
<ol start="163">
<li>重新启动下后端项目，然后用<code>postman</code>调用下，正常 ok 了</li>
</ol>
<p><img src="/img/images/2024/1710076322063-b154c016-2d09-4d0c-a54e-c380e2bd3d10.png" srcset="/img/loading.gif" lazyload><img src="/img/images/2024/1710076310443-0eeaf24f-6b16-4cd0-be06-b9d181c8388c.png" srcset="/img/loading.gif" lazyload></p>
<ol start="164">
<li>然后拿着这个 token，去调用其他接口</li>
</ol>
<p><img src="/img/images/2024/1710076707645-b1bac10a-ad7c-47e1-be03-96c3822653b7.png" srcset="/img/loading.gif" lazyload><br><img src="/img/images/2024/1710076716959-1c6e73fd-bf72-47dc-a7eb-c8c492a884a5.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="7、埋点实现（react-master-下）"><a href="#7、埋点实现（react-master-下）" class="headerlink" title="7、埋点实现（react-master 下）"></a>7、埋点实现（react-master 下）</h1><ol start="165">
<li>新建目录</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">mkdir src/utils/lib &amp;&amp; touch src/utils/lib/track.<span class="hljs-property">ts</span> &amp;&amp; touch src/utils/lib/<span class="hljs-keyword">async</span>-track-queue.<span class="hljs-property">ts</span><br></code></pre></td></tr></table></figure>

<ol start="166">
<li>安装依赖<code>pnpm add lodash</code></li>
<li><code>src/utils/lib/track.ts</code>编码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 这个是埋点 API</span><br><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AsyncTrackQueue</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./async-track-queue&quot;</span>;<br><br><span class="hljs-keyword">export</span> interface <span class="hljs-title class_">TrackQueue</span> &#123;<br> <span class="hljs-attr">seqId</span>: number;<br> <span class="hljs-attr">id</span>: number;<br> <span class="hljs-attr">timestamp</span>: number;<br>&#125;<br><br><span class="hljs-keyword">export</span> interface <span class="hljs-title class_">UserTrackData</span> &#123;<br> <span class="hljs-attr">type</span>: string;<br> <span class="hljs-attr">data</span>: any;<br>&#125;<br><br><span class="hljs-comment">// 思考 1：每次调用时是否立马发起请求？</span><br><span class="hljs-comment">// 答案 1：不一定，比如滚动了页面，那可能存在几十个埋点请求，所以应该先收集一波，然后统一发送。这样服务器的 QPS 会减少</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseTrack</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AsyncTrackQueue</span>&lt;<span class="hljs-title class_">TrackQueue</span>&gt; &#123;<br> private seq = <span class="hljs-number">0</span>;<br> <span class="hljs-comment">/**</span><br><span class="hljs-comment">  * 埋点请求收集</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> data 用户轨迹数据</span><br><span class="hljs-comment">  */</span><br> <span class="hljs-title function_">track</span>(<span class="hljs-params">data: UserTrackData</span>) &#123;<br>  <span class="hljs-comment">// 埋点请求收集</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addTask</span>(&#123;<br>   <span class="hljs-attr">id</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(),<br>   <span class="hljs-attr">seqId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">seq</span>++,<br>   <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),<br>   ...data,<br>  &#125;);<br> &#125;<br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment">  * 消费埋点请求任务队列</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> data 任务队列数据，类型为任意类型数组</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@returns</span> 返回一个 Promise，当 img 标签加载完成后 resolve 为 true</span><br><span class="hljs-comment">  */</span><br> <span class="hljs-title function_">comsumeTaskQuene</span>(<span class="hljs-params">data: <span class="hljs-built_in">Array</span>&lt;TrackQueue&gt;</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>   <span class="hljs-comment">// 通过构建一个 img 标签，然后设置 src 属性，来发送请求</span><br>   <span class="hljs-keyword">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();<br>   image.<span class="hljs-property">src</span> = <span class="hljs-string">&quot;http://localhost:3001/track?data=&quot;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data);<br><br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ comsumeTaskQuene data ] &gt;&quot;</span>, data);<br><br>   image.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);<br>   &#125;;<br>  &#125;);<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="168">
<li><code>src/utils/lib/sync-track-queue.ts</code>编码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 第二层：AsyncTrackQueue 是专门处理收集工作的</span><br><br><span class="hljs-keyword">import</span> &#123; debounce &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;lodash&quot;</span>;<br><br>interface <span class="hljs-title class_">RequiredData</span> &#123;<br> <span class="hljs-attr">timestamp</span>: number | string;<br>&#125;<br><br><span class="hljs-comment">// 思考 2：如何收集？收集多少？怎么发请求？</span><br><span class="hljs-keyword">export</span> abstract <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncTrackQueue</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RequiredData</span>&gt; &#123;<br> <span class="hljs-attr">_queueData</span>: <span class="hljs-title class_">Array</span>&lt;T&gt; = [];<br><br> <span class="hljs-comment">// 获取本次存储服务</span><br> private <span class="hljs-keyword">get</span> <span class="hljs-title function_">storageService</span>() &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">TaskQueueStorableHelper</span>.<span class="hljs-title function_">getInstance</span>();<br> &#125;<br><br> private <span class="hljs-keyword">get</span> <span class="hljs-title function_">queueData</span>(): <span class="hljs-title class_">Array</span>&lt;T&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageService</span>.<span class="hljs-property">queueData</span>;<br> &#125;<br><br> private <span class="hljs-keyword">set</span> <span class="hljs-title function_">queueData</span>(<span class="hljs-params">data: <span class="hljs-built_in">Array</span>&lt;T&gt;</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageService</span>.<span class="hljs-property">queueData</span> = data;<br><br>  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">length</span>) &#123;<br>   <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">debounceRun</span>();<br>  &#125;<br> &#125;<br><br> <span class="hljs-comment">// 添加任务</span><br> <span class="hljs-title function_">addTask</span>(<span class="hljs-params">data: T | <span class="hljs-built_in">Array</span>&lt;T&gt;</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">queueData</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">queueData</span>.<span class="hljs-title function_">concat</span>(data);<br> &#125;<br><br> <span class="hljs-comment">// 消费埋点请求任务队列，需要子类去实现</span><br> protected abstract <span class="hljs-title function_">comsumeTaskQuene</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">Array</span>&lt;T&gt;): <span class="hljs-title class_">Promise</span>&lt;unknown&gt;;<br><br> <span class="hljs-comment">// 上报策略：当一段时间内，没有新增的任务时，可以去上报一波</span><br> <span class="hljs-comment">// 通过 debounce 防抖，来控制上报频率</span><br> protected debounceRun = <span class="hljs-title function_">debounce</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">run</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-number">500</span>);<br><br> private <span class="hljs-title function_">run</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> currentDataList = <span class="hljs-variable language_">this</span>.<span class="hljs-property">queueData</span>;<br><br>  <span class="hljs-keyword">if</span> (currentDataList.<span class="hljs-property">length</span>) &#123;<br>   <span class="hljs-comment">// 清空任务</span><br>   <span class="hljs-variable language_">this</span>.<span class="hljs-property">queueData</span> = [];<br>   <span class="hljs-comment">// 执行任务</span><br>   <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">comsumeTaskQuene</span>(currentDataList);<br>  &#125;<br> &#125;<br>&#125;<br><br><span class="hljs-comment">// 思考 3：当还有数据未上报时，用户关闭了浏览器，那就会丢失一部分待上报的埋点数据，如何解决这个问题？</span><br><span class="hljs-comment">// 答案 3：使用 localStorage 存储，当用户关闭浏览器时，将数据存到 localStorage 中，下次打开浏览器时，再从 localStorage 中读取数据上报</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskQueueStorableHelper</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RequiredData</span> = any&gt; &#123;<br> <span class="hljs-comment">// 一个单例模式</span><br><br> private <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">TaskQueueStorableHelper</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;<br><br> <span class="hljs-keyword">static</span> getInstance&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RequiredData</span> = any&gt;() &#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">instance</span>) &#123;<br>   <span class="hljs-variable language_">this</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskQueueStorableHelper</span>();<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">instance</span>;<br> &#125;<br><br> private <span class="hljs-variable constant_">STORAGE_KEY</span> = <span class="hljs-string">&quot;track-queue&quot;</span>;<br><br> protected <span class="hljs-attr">store</span>: any = <span class="hljs-literal">null</span>;<br><br> <span class="hljs-comment">// 打开浏览器时，是要执行 constructor</span><br> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> localStorageVal = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">STORAGE_KEY</span>);<br><br>  <span class="hljs-keyword">if</span> (localStorageVal) &#123;<br>   <span class="hljs-comment">// 说明有待上报的数据，则存储一些</span><br>   <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(localStorageVal);<br>   &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: any) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(error);<br>   &#125;<br>  &#125;<br> &#125;<br><br> <span class="hljs-keyword">get</span> <span class="hljs-title function_">queueData</span>() &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span>?.<span class="hljs-property">queueData</span> || [];<br> &#125;<br><br> <span class="hljs-keyword">set</span> <span class="hljs-title function_">queueData</span>(<span class="hljs-params">data: <span class="hljs-built_in">Array</span>&lt;T&gt;</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span> = &#123;<br>   ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span>,<br>   <span class="hljs-attr">queueData</span>: data.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-title class_">Number</span>(a.<span class="hljs-property">timestamp</span>) - <span class="hljs-title class_">Number</span>(b.<span class="hljs-property">timestamp</span>)),<br>  &#125;;<br><br>  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">STORAGE_KEY</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span>));<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="169">
<li>新建上报文件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">touch src/utils/lib/apis.<span class="hljs-property">ts</span><br></code></pre></td></tr></table></figure>

<ol start="170">
<li><code>src/utils/lib/apis.ts</code>编码</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BaseTrack</span>, <span class="hljs-title class_">UserTrackData</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./track&quot;</span>;<br><br><span class="hljs-comment">// 性能上报</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Performance</span> &#123;<br> <span class="hljs-keyword">static</span> readonly timing = <span class="hljs-variable language_">window</span>.<span class="hljs-property">performance</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">performance</span>.<span class="hljs-property">timing</span>;<br><br> <span class="hljs-keyword">static</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">timing</span>) &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&quot;performance is not support&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;load&quot;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>   <span class="hljs-keyword">const</span> data = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getTiming</span>();<br><br>   <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseTrack</span>().<span class="hljs-title function_">track</span>(data);<br>  &#125;);<br> &#125;<br> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getTiming</span>(): <span class="hljs-title class_">UserTrackData</span> &#123;<br>  <span class="hljs-keyword">const</span> timing = <span class="hljs-variable language_">this</span>.<span class="hljs-property">timing</span>;<br><br>  <span class="hljs-keyword">return</span> &#123;<br>   <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;performance&quot;</span>,<br>   <span class="hljs-attr">data</span>: &#123;<br>    <span class="hljs-attr">loadTime</span>: timing.<span class="hljs-property">loadEventEnd</span> - timing.<span class="hljs-property">navigationStart</span>,<br>    <span class="hljs-attr">domReadyTime</span>: timing.<span class="hljs-property">domComplete</span> - timing.<span class="hljs-property">domLoading</span>,<br>    <span class="hljs-attr">readyTime</span>: timing.<span class="hljs-property">domContentLoadedEventEnd</span> - timing.<span class="hljs-property">navigationStart</span>,<br>    <span class="hljs-attr">requestTime</span>: timing.<span class="hljs-property">responseEnd</span> - timing.<span class="hljs-property">requestStart</span>,<br>   &#125;,<br>  &#125;;<br> &#125;<br>&#125;<br><span class="hljs-comment">// 主动上报</span><br><span class="hljs-keyword">const</span> t = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseTrack</span>();<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> sendLog = &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">data: T</span>) =&gt;</span> &#123;<br> t.<span class="hljs-title function_">track</span>(data <span class="hljs-keyword">as</span> T &amp; <span class="hljs-title class_">UserTrackData</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="171">
<li>找个地方使用下上报的，我在<code>react-master/src/pages/home/commandList/index.tsx</code>里面调用</li>
</ol>
<p><img src="/img/images/2024/1710082698618-8b51e012-68fa-47cb-ba4b-342bbc4acc69.png" srcset="/img/loading.gif" lazyload></p>
<ol start="172">
<li>再找个地方使用下上报的，我在<code>react-master/src/app.tsx</code>里面调用</li>
</ol>
<p><img src="/img/images/2024/1710084691663-dc9ce24f-8ef3-4a25-994e-25d3735e32f3.png" srcset="/img/loading.gif" lazyload><br><img src="/img/images/2024/1710084719595-0e30c53c-ddc1-4390-974f-2f1f47881ac8.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="8、总结"><a href="#8、总结" class="headerlink" title="8、总结"></a>8、总结</h1><p>本篇文章从项目搭建开始讲解，讲了前端 React 项目的环境搭建：Webpack 配置、Babel 配置等一系列真实开发可用的；然后手动搭建 React 的路由体系，并使用 tailwindcss 仿照知乎进行了代码书写；最后讲了一些业务“亮点”：use* API 的封装、极致的本地存储工具</p>
<p>之后深入组件库领域，基于 Rollup 自己搭建了一套构建逻辑</p>
<p>之后了解了前端微内核架构，并手写了 Webpack、Babel、postcss 插件</p>
<p>之后进入后端领域，基于 koa 手撸了一套装饰器模式的“MVC”架构，并且自己处理了项目打包，写了具有代表意义的登录鉴权的接口（其他接口自然也会了）</p>
<p>最后讲了前端埋点的一种实现方式，采用“分层设计”，讲了埋点收集、本地存储、埋点上报等逻辑</p>
<p>所以以上的内容，有很多是可以作为“亮点”去包装一下的</p>
<p>本项目的代码已全部上传 github：<a target="_blank" rel="noopener" href="https://github.com/MrHzq/react-actual-combat">https://github.com/MrHzq/react-actual-combat</a></p>
<h1 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h1><h2 id="什么是亮点？"><a href="#什么是亮点？" class="headerlink" title="什么是亮点？"></a>什么是亮点？</h2><blockquote>
<p>具备一定的思考、技术难度、并实际解决了关键问题的事情</p>
</blockquote>
<p>符合下面三个之一的可以称为“亮点”</p>
<ul>
<li>基于业务，封装公共能力，解决业务中的标准问题，并推广使用。<ul>
<li>为什么要封装？具体解决了什么问题？如何实现推广的？</li>
</ul>
</li>
<li>基于工程化手段，解决流程或研发问题<ul>
<li>比如：自研 Webpack 插件，解决 xxx 问题；提供 cli 脚手架解决项目创建问题等</li>
</ul>
</li>
<li>创造性的弄了一个东西(这个行业之前没有的)，并解决了某个问题</li>
</ul>
<p>若是：基于 axios、vueRouter、防抖、节流封装 xxx 组件，这种已经不算什么亮点了。</p>
<h2 id="构建知识"><a href="#构建知识" class="headerlink" title="构建知识"></a>构建知识</h2><p>在 Webpack 的前端项目中，我们一般如下引入依赖</p>
<blockquote>
<p>import A from “A”;<br>const A &#x3D; require(“A”);<br>那为什么可以这样写？为什么这两个写法都行？require 不是 node 端的写法吗？</p>
</blockquote>
<p>解答：是构建工具来决定你的语法，你在 Webpack 里面这样写，这里的 import、require 与 esm、cjs 没有任何的关系，这样写为了让你写的更方便、好记，并且也是沿用了大家熟悉的 esm、cjs 规范写法。</p>
<p>Webpack 的本质就是“翻译”，从你写的入口文件开始，找到所有的文件，每个不同类型的文件使用对应的“语言包”进行翻译，最后只输出一篇浏览器能看懂的文章。<br>常见“语言包”：less 翻译为 css、react 翻译为 js、图片地址(.&#x2F;xx.png)翻译为最终的地址((.&#x2F;public&#x2F;img&#x2F;xx.png).</p>
<p>所以 Webpack 强大在于插件，你需要特定翻译什么，就可以自己去开发对应的语言包，装到 Webpack 上就能用</p>
<p>一般 Webpack 的产物为：.html、.js、.css，用 html 去 script 加载 js，用 link 加载 css</p>
<h2 id="React-的闭包陷阱"><a href="#React-的闭包陷阱" class="headerlink" title="React 的闭包陷阱"></a>React 的闭包陷阱</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904193044512782?from=search-suggest">从 react hooks“闭包陷阱”切入，浅谈 react hooks - 掘金</a></p>
<h2 id="如何学习"><a href="#如何学习" class="headerlink" title="如何学习"></a>如何学习</h2><p>流派划分：连接主义、符号主义<br>连接主义：吸收到新知识时，会用老的知识去连接它，让新知识不那么容易遗忘<br>符号主义：通过自己的逻辑，将新知识变大，这样也不容易遗忘<br><img src="/img/images/2024/1709990631939-8eb470df-242f-4e74-b0e1-3325dbcd3f0c.jpeg" srcset="/img/loading.gif" lazyload><br>如何连接？<br><strong>输出：找别人讨论、写文章、教别人等等（费曼技巧）。</strong><br>在这个过程中，你会用你熟悉的知识(大球)去解释它(小球)</p>
<p>如何变大？<br><strong>总结：将关键词记下来，确保看到这几个关键词后就能解释清楚</strong><br>并且在不同的场合都温习一下（通勤、吃饭等）</p>
<blockquote>
<p>当你看到一个知识时，脑海有印象但就是想不起来，则说明这个知识正在和你的老知识在连接，但就还差一些。所以就立马去看，把连接建立起来</p>
</blockquote>
<p>结合运用：将新知识总结出关键词，自己能通过关键词解释清楚，让知识变大，然后去输出，用自己的语言描述一边，建立连接，最后时常温习关键词，记不清楚了则立马去看。</p>
<p>这样脑海里面的知识才能形成体系，否则只能死记硬背。</p>
<h2 id="如何串行-Promise？"><a href="#如何串行-Promise？" class="headerlink" title="如何串行 Promise？"></a>如何串行 Promise？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">PromiseArray</span> = [<br> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>),<br> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>),<br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>), <span class="hljs-number">1000</span>)),<br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">4</span>), <span class="hljs-number">2000</span>)),<br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">5</span>), <span class="hljs-number">1000</span>)),<br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">6</span>), <span class="hljs-number">1000</span>)),<br>];<br><br><span class="hljs-comment">// ⭐️ 核心代码在这</span><br><span class="hljs-keyword">const</span> lastPromise = <span class="hljs-title class_">PromiseArray</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">prev, next</span>) =&gt;</span><br> prev.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ prev promise res ] &gt;&quot;</span>, res);<br>  <span class="hljs-keyword">return</span> next;<br> &#125;),<br>);<br><br><span class="hljs-comment">// 最后一个的结果，需要等待所有 promise 都执行完然后自行 then</span><br>lastPromise.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[ last promise res ] &gt;&quot;</span>, res);<br>&#125;);<br><br><span class="hljs-comment">// 打印结果</span><br>[ prev promise res ] &gt; <span class="hljs-number">1</span><br>[ prev promise res ] &gt; <span class="hljs-number">2</span><br>[ prev promise res ] &gt; <span class="hljs-number">3</span><br>[ prev promise res ] &gt; <span class="hljs-number">4</span><br>[ prev promise res ] &gt; <span class="hljs-number">5</span><br>[ last promise res ] &gt; <span class="hljs-number">6</span><br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%89%8D%E7%AB%AF%E5%85%AB%E8%82%A1%E6%96%87/" class="category-chain-item">前端八股文</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E8%81%8C%E4%B8%9A%E4%B8%8A%E4%B8%80%E4%BA%8C%E4%BA%8B/" class="print-no-link">#职业上一二事</a>
      
        <a href="/tags/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95/" class="print-no-link">#前端面试</a>
      
        <a href="/tags/%E5%89%8D%E7%AB%AF%E5%85%AB%E8%82%A1%E6%96%87/" class="print-no-link">#前端八股文</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>5-1、React 实战之从零到一的项目搭建与开发</div>
      <div>https://mrhzq.github.io/职业上一二事/前端面试/前端八股文/5-1、React 实战之从零到一的项目搭建与开发/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>黄智强</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年1月13日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/%E8%81%8C%E4%B8%9A%E4%B8%8A%E4%B8%80%E4%BA%8C%E4%BA%8B/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95/%E5%89%8D%E7%AB%AF%E5%85%AB%E8%82%A1%E6%96%87/6-1%E3%80%81%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E6%88%98%E4%B9%8B%E5%89%8D%E7%AB%AF%E8%84%9A%E6%89%8B%E6%9E%B6/" title="6-1、工程化实战之前端脚手架">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">6-1、工程化实战之前端脚手架</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/%E8%81%8C%E4%B8%9A%E4%B8%8A%E4%B8%80%E4%BA%8C%E4%BA%8B/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95/%E5%89%8D%E7%AB%AF%E5%85%AB%E8%82%A1%E6%96%87/4-6%E3%80%81RN%20%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E6%88%98/" title="4-6、RN 入门与实战">
                        <span class="hidden-mobile">4-6、RN 入门与实战</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="/" rel="nofollow noopener"><span>黄智强</span></a> <i class="iconfont icon-love"></i> <a href="/about" rel="nofollow noopener"><span>关于我</span></a>
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  var relativeDate = function() {
    var updatedTime = document.getElementById('updated-time');
    if (updatedTime) {
      var text = updatedTime.textContent;
      var reg = /\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|[+-]\d{2}:\d{2})/;
      var matchs = text.match(reg);
      if (matchs) {
        var relativeTime = moment(matchs[0]).fromNow();
        updatedTime.textContent = text.replace(reg, relativeTime);
      }
      updatedTime.style.display = '';
    }
  };
  Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/moment.min.js', function() {
    if (!'zh-cn'.startsWith('en')) {
      Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/locale/zh-cn.min.js', function() {
        relativeDate();
      });
    } else {
      relativeDate();
    }
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/js/openVScode.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
